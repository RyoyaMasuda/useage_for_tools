# 7-3. 特殊な型

この章では、TypeScriptの特殊な型である「タプル（Tuple）」と「Enum（列挙）」について学びます。これらの型を理解することで、より厳密で保守しやすいコードを書けるようになります。

---

## 目次

- [タプル（Tuple）型](#タプルtuple型)
- [Enum（列挙）型](#enum列挙型)
- [まとめ](#まとめ)
- [演習問題](#演習問題)

---

## タプル（Tuple）型

### タプルとは
タプル（Tuple）は、**固定長の配列で、各要素の型を個別に指定できる**データ構造です。配列とは異なり、要素の数と型が厳密に決まっています。

### 日常生活での例
- **座標**: (x座標, y座標) → 2つの数値が必ず必要
- **日付と時刻**: (年, 月, 日, 時, 分) → 5つの数値が順番に必要
- **名前と年齢**: ("太郎", 25) → 文字列と数値の組み合わせ
- **RGB色**: (255, 128, 0) → 3つの数値が必ず必要

### タプルと配列の違い

| 特徴 | 配列 | タプル |
|------|------|--------|
| **要素数** | 可変 | 固定 |
| **型** | すべて同じ型 | 各要素で異なる型を指定可能 |
| **厳密性** | 緩い | 厳密 |

### タプルの基本構文

```typescript
// 基本的なタプル
let 変数名: [型1, 型2, 型3] = [値1, 値2, 値3];

// 読み取り専用タプル
let 変数名: readonly [型1, 型2] = [値1, 値2];
```

### 基本的なタプルの作成

```typescript
// 2要素のタプル（文字列と数値）
const person: [string, number] = ["太郎", 25];

// 3要素のタプル（RGB色）
const color: [number, number, number] = [255, 128, 0];

// 4要素のタプル（日付情報）
const date: [number, number, number, number] = [2024, 1, 15, 10];
```

### タプルの要素へのアクセス

```typescript
const person: [string, number] = ["太郎", 25];

console.log(person[0]); // "太郎"（名前）
console.log(person[1]); // 25（年齢）

// 分割代入も可能
const [name, age] = person;
console.log(name); // "太郎"
console.log(age);  // 25
```

### 実践例: タプルの基本

```typescript
// src/tuple-basics.ts
// 基本的なタプル
const person: [string, number] = ["太郎", 25];
console.log(`名前: ${person[0]}, 年齢: ${person[1]}歳`);

// RGB色のタプル
const red: [number, number, number] = [255, 0, 0];
const green: [number, number, number] = [0, 255, 0];
const blue: [number, number, number] = [0, 0, 255];
console.log(`赤: RGB(${red[0]}, ${red[1]}, ${red[2]})`);

// 座標のタプル
const point: [number, number] = [10, 20];
console.log(`座標: (${point[0]}, ${point[1]})`);

// 分割代入
const [x, y] = point;
console.log(`X座標: ${x}, Y座標: ${y}`);

// 日付と時刻のタプル
const datetime: [number, number, number, number, number] = [2024, 1, 15, 10, 30];
const [year, month, day, hour, minute] = datetime;
console.log(`${year}年${month}月${day}日 ${hour}時${minute}分`);

// 実践例: 関数の戻り値としてタプルを使用
function divide(a: number, b: number): [number, number] {
    const quotient = Math.floor(a / b);
    const remainder = a % b;
    return [quotient, remainder];
}

const [q, r] = divide(17, 5);
console.log(`17 ÷ 5 = ${q} 余り ${r}`); // 17 ÷ 5 = 3 余り 2

// 実践例: 複数の値を返す関数
function getUserInfo(): [string, number, boolean] {
    return ["花子", 30, true];
}

const [userName, userAge, isActive] = getUserInfo();
console.log(`ユーザー: ${userName}, ${userAge}歳, ${isActive ? "アクティブ" : "非アクティブ"}`);

// 実践例: エラーハンドリング
function parseNumber(str: string): [boolean, number] {
    const num = Number(str);
    if (isNaN(num)) {
        return [false, 0];
    }
    return [true, num];
}

const [success1, value1] = parseNumber("123");
console.log(`成功: ${success1}, 値: ${value1}`); // 成功: true, 値: 123

const [success2, value2] = parseNumber("abc");
console.log(`成功: ${success2}, 値: ${value2}`); // 成功: false, 値: 0
```

### オプショナルな要素を持つタプル

```typescript
// オプショナルな要素（?を使用）
const optionalTuple: [string, number?] = ["太郎"];
// または
const optionalTuple2: [string, number?] = ["太郎", 25];
```

### 実践例: オプショナルな要素

```typescript
// src/optional-tuple.ts
// オプショナルな要素を持つタプル
const user1: [string, number?] = ["太郎"];
const user2: [string, number?] = ["花子", 25];

console.log(`ユーザー1: ${user1[0]}, 年齢: ${user1[1] ?? "不明"}`);
console.log(`ユーザー2: ${user2[0]}, 年齢: ${user2[1] ?? "不明"}`);

// 実践例: 設定情報
const config1: [string, string?, number?] = ["localhost"];
const config2: [string, string?, number?] = ["localhost", "admin"];
const config3: [string, string?, number?] = ["localhost", "admin", 3000];

console.log(`設定1: ${config1[0]}`);
console.log(`設定2: ${config2[0]}, ユーザー: ${config2[1]}`);
console.log(`設定3: ${config3[0]}, ユーザー: ${config3[1]}, ポート: ${config3[2]}`);
```

### 可変長タプル（Rest要素）

```typescript
// Rest要素を使用したタプル
const tuple: [string, ...number[]] = ["数値", 1, 2, 3, 4, 5];
```

### 実践例: 可変長タプル

```typescript
// src/rest-tuple.ts
// Rest要素を使用したタプル
const scores: [string, ...number[]] = ["太郎", 85, 92, 78, 96, 88];
const [studentName, ...testScores] = scores;

console.log(`学生: ${studentName}`);
console.log(`点数: ${testScores}`);

// 平均点を計算
const average = testScores.reduce((sum: number, score: number): number => sum + score, 0) / testScores.length;
console.log(`平均点: ${average.toFixed(1)}`);

// 実践例: 複数の引数を受け取る関数
function sum(first: number, ...rest: number[]): number {
    return first + rest.reduce((acc: number, n: number): number => acc + n, 0);
}

console.log(`合計: ${sum(1, 2, 3, 4, 5)}`); // 15
```

### readonlyタプル

```typescript
// readonlyタプル（要素を変更できない）
const readonlyTuple: readonly [string, number] = ["太郎", 25];
// readonlyTuple[0] = "花子"; // エラー: readonlyタプルの要素は変更できない
```

### 実践例: readonlyタプル

```typescript
// src/readonly-tuple.ts
// readonlyタプル
const person: readonly [string, number] = ["太郎", 25];
console.log(`名前: ${person[0]}, 年齢: ${person[1]}歳`);

// 読み取りは可能
const [name, age] = person;
console.log(`名前: ${name}, 年齢: ${age}歳`);

// 変更は不可（エラーになる）
// person[0] = "花子"; // エラー: readonlyタプルの要素は変更できない
// person[1] = 30;     // エラー: readonlyタプルの要素は変更できない

// 実践例: 定数として使用
const RGB_RED: readonly [number, number, number] = [255, 0, 0];
const RGB_GREEN: readonly [number, number, number] = [0, 255, 0];
const RGB_BLUE: readonly [number, number, number] = [0, 0, 255];

console.log(`赤: RGB(${RGB_RED[0]}, ${RGB_RED[1]}, ${RGB_RED[2]})`);
console.log(`緑: RGB(${RGB_GREEN[0]}, ${RGB_GREEN[1]}, ${RGB_GREEN[2]})`);
console.log(`青: RGB(${RGB_BLUE[0]}, ${RGB_BLUE[1]}, ${RGB_BLUE[2]})`);

// 実践例: 関数の引数として使用
function displayColor(color: readonly [number, number, number]): void {
    console.log(`RGB(${color[0]}, ${color[1]}, ${color[2]})`);
}

displayColor(RGB_RED);   // RGB(255, 0, 0)
displayColor(RGB_GREEN); // RGB(0, 255, 0)
displayColor(RGB_BLUE);  // RGB(0, 0, 255)
```

### タプルの型エイリアス

```typescript
// タプルの型エイリアス
type Person = [string, number];
type Color = [number, number, number];
```

### 実践例: タプルの型エイリアス

```typescript
// src/tuple-type-alias.ts
// タプルの型エイリアス
type Person = [string, number];
type Color = [number, number, number];
type Point = [number, number];

// 型エイリアスを使用
const person: Person = ["太郎", 25];
const color: Color = [255, 128, 0];
const point: Point = [10, 20];

console.log(`人物: ${person[0]}, ${person[1]}歳`);
console.log(`色: RGB(${color[0]}, ${color[1]}, ${color[2]})`);
console.log(`座標: (${point[0]}, ${point[1]})`);

// 実践例: 関数の型定義
type DivideResult = [number, number];

function divide(a: number, b: number): DivideResult {
    return [Math.floor(a / b), a % b];
}

const [quotient, remainder] = divide(17, 5);
console.log(`商: ${quotient}, 余り: ${remainder}`);
```

---

## Enum（列挙）型

### Enumとは
Enum（列挙）は、**関連する定数をグループ化して管理する**機能です。数値や文字列の定数に名前を付けて、コードを読みやすくします。

### 日常生活での例
- **曜日**: 月曜日、火曜日、水曜日...（7つの定数）
- **季節**: 春、夏、秋、冬（4つの定数）
- **状態**: 待機中、処理中、完了、エラー（4つの定数）
- **サイズ**: S、M、L、XL（4つの定数）

### Enumの基本構文

```typescript
// 数値Enum（デフォルト）
enum Enum名 {
    メンバー1,
    メンバー2,
    メンバー3
}

// 文字列Enum
enum Enum名 {
    メンバー1 = "値1",
    メンバー2 = "値2"
}
```

### 数値Enum（Numeric Enum）

数値Enumは、**各メンバーに自動的に数値が割り当てられる**Enumです。最初のメンバーは0から始まり、1ずつ増加します。

```typescript
enum Direction {
    North,    // 0
    East,     // 1
    South,    // 2
    West      // 3
}
```

### 実践例: 数値Enum

```typescript
// src/numeric-enum.ts
// 基本的な数値Enum
enum Direction {
    North,    // 0
    East,     // 1
    South,     // 2
    West      // 3
}

console.log(Direction.North); // 0
console.log(Direction.East);  // 1
console.log(Direction.South); // 2
console.log(Direction.West);  // 3

// Enumの値を使用
const currentDirection: Direction = Direction.North;
console.log(`現在の方向: ${currentDirection}`); // 0

// 実践例: 曜日のEnum
enum DayOfWeek {
    Sunday,    // 0
    Monday,    // 1
    Tuesday,   // 2
    Wednesday, // 3
    Thursday,  // 4
    Friday,    // 5
    Saturday   // 6
}

function getDayName(day: DayOfWeek): string {
    const dayNames = ["日曜日", "月曜日", "火曜日", "水曜日", "木曜日", "金曜日", "土曜日"];
    return dayNames[day];
}

console.log(getDayName(DayOfWeek.Monday));  // 月曜日
console.log(getDayName(DayOfWeek.Friday));  // 金曜日

// 実践例: 状態のEnum
enum Status {
    Pending,   // 0: 待機中
    Processing, // 1: 処理中
    Completed,  // 2: 完了
    Error      // 3: エラー
}

function processTask(status: Status): void {
    switch (status) {
        case Status.Pending:
            console.log("タスクは待機中です");
            break;
        case Status.Processing:
            console.log("タスクを処理中です");
            break;
        case Status.Completed:
            console.log("タスクが完了しました");
            break;
        case Status.Error:
            console.log("エラーが発生しました");
            break;
    }
}

processTask(Status.Pending);    // タスクは待機中です
processTask(Status.Processing);  // タスクを処理中です
processTask(Status.Completed);   // タスクが完了しました
```

### 数値Enumの初期値指定

```typescript
// 初期値を指定
enum Status {
    Pending = 1,
    Processing,  // 2
    Completed,    // 3
    Error         // 4
}
```

### 実践例: 初期値指定

```typescript
// src/enum-initial-value.ts
// 初期値を指定したEnum
enum Status {
    Pending = 1,
    Processing,  // 2
    Completed,    // 3
    Error         // 4
}

console.log(Status.Pending);     // 1
console.log(Status.Processing);  // 2
console.log(Status.Completed);   // 3
console.log(Status.Error);       // 4

// 実践例: HTTPステータスコード
enum HttpStatus {
    OK = 200,
    BadRequest = 400,
    Unauthorized = 401,
    NotFound = 404,
    InternalServerError = 500
}

function handleResponse(status: HttpStatus): void {
    switch (status) {
        case HttpStatus.OK:
            console.log("リクエスト成功");
            break;
        case HttpStatus.BadRequest:
            console.log("不正なリクエスト");
            break;
        case HttpStatus.NotFound:
            console.log("リソースが見つかりません");
            break;
        case HttpStatus.InternalServerError:
            console.log("サーバーエラー");
            break;
    }
}

handleResponse(HttpStatus.OK);                    // リクエスト成功
handleResponse(HttpStatus.NotFound);              // リソースが見つかりません
handleResponse(HttpStatus.InternalServerError);   // サーバーエラー
```

### 文字列Enum（String Enum）

文字列Enumは、**各メンバーに文字列値を明示的に指定する**Enumです。数値Enumより明確で、デバッグしやすいです。

```typescript
enum Direction {
    North = "NORTH",
    East = "EAST",
    South = "SOUTH",
    West = "WEST"
}
```

### 実践例: 文字列Enum

```typescript
// src/string-enum.ts
// 基本的な文字列Enum
enum Direction {
    North = "NORTH",
    East = "EAST",
    South = "SOUTH",
    West = "WEST"
}

console.log(Direction.North); // "NORTH"
console.log(Direction.East);  // "EAST"

// 実践例: サイズのEnum
enum Size {
    Small = "S",
    Medium = "M",
    Large = "L",
    ExtraLarge = "XL"
}

function getSizeDescription(size: Size): string {
    switch (size) {
        case Size.Small:
            return "小さいサイズ";
        case Size.Medium:
            return "中サイズ";
        case Size.Large:
            return "大きいサイズ";
        case Size.ExtraLarge:
            return "特大サイズ";
    }
}

console.log(getSizeDescription(Size.Small));      // 小さいサイズ
console.log(getSizeDescription(Size.Large));      // 大きいサイズ

// 実践例: ログレベルのEnum
enum LogLevel {
    Debug = "DEBUG",
    Info = "INFO",
    Warning = "WARNING",
    Error = "ERROR"
}

function log(message: string, level: LogLevel): void {
    console.log(`[${level}] ${message}`);
}

log("アプリケーションを起動しました", LogLevel.Info);     // [INFO] アプリケーションを起動しました
log("エラーが発生しました", LogLevel.Error);              // [ERROR] エラーが発生しました
log("デバッグ情報", LogLevel.Debug);                      // [DEBUG] デバッグ情報
```

### 混合Enum（Heterogeneous Enum）

混合Enumは、**数値と文字列を混在させた**Enumです（非推奨）。

```typescript
enum Mixed {
    No = 0,
    Yes = "YES"
}
```

### const Enum

const Enumは、**コンパイル時にインライン展開される**Enumです。パフォーマンスが向上します。

```typescript
const enum Direction {
    North,
    East,
    South,
    West
}
```

### 実践例: const Enum

```typescript
// src/const-enum.ts
// const Enum
const enum Direction {
    North,
    East,
    South,
    West
}

// コンパイル時に値が直接展開される
const direction = Direction.North; // コンパイル後は 0 になる
console.log(direction); // 0

// 実践例: パフォーマンスが重要な場合
const enum Status {
    Pending = 1,
    Processing = 2,
    Completed = 3
}

function checkStatus(status: Status): boolean {
    return status === Status.Completed;
}

console.log(checkStatus(Status.Completed)); // true
```

### Enumの逆引き

数値Enumでは、**値から名前を取得できる**機能があります。

```typescript
enum Direction {
    North,
    East,
    South,
    West
}

console.log(Direction[0]); // "North"
console.log(Direction[1]); // "East"
```

### 実践例: Enumの逆引き

```typescript
// src/enum-reverse.ts
// 数値Enumの逆引き
enum Direction {
    North,
    East,
    South,
    West
}

console.log(Direction[0]); // "North"
console.log(Direction[1]); // "East"
console.log(Direction[2]); // "South"
console.log(Direction[3]); // "West"

// 実践例: 値から名前を取得
function getDirectionName(value: number): string {
    return Direction[value] || "不明";
}

console.log(getDirectionName(0)); // "North"
console.log(getDirectionName(2)); // "South"
console.log(getDirectionName(5)); // "不明"

// 注意: 文字列Enumでは逆引きはできない
enum StringDirection {
    North = "NORTH",
    East = "EAST"
}

// console.log(StringDirection["NORTH"]); // undefined（逆引きできない）
```

### Enumの型としての使用

```typescript
// Enumを型として使用
function move(direction: Direction): void {
    // 処理
}
```

### 実践例: Enumを型として使用

```typescript
// src/enum-as-type.ts
// Enumを型として使用
enum Status {
    Pending,
    Processing,
    Completed,
    Error
}

// 関数の引数の型として使用
function updateStatus(status: Status): void {
    console.log(`ステータスを更新: ${Status[status]}`);
}

updateStatus(Status.Pending);    // ステータスを更新: Pending
updateStatus(Status.Completed); // ステータスを更新: Completed

// 変数の型として使用
const currentStatus: Status = Status.Processing;
console.log(`現在のステータス: ${Status[currentStatus]}`); // 現在のステータス: Processing

// 実践例: オブジェクトのプロパティの型として使用
interface Task {
    id: number;
    title: string;
    status: Status;
}

const task: Task = {
    id: 1,
    title: "タスク1",
    status: Status.Pending
};

console.log(`タスク: ${task.title}, ステータス: ${Status[task.status]}`);
```

---

## まとめ

この章では、TypeScriptの特殊な型であるタプルとEnumについて学びました。

### 学んだこと
- **タプル（Tuple）**: 固定長の配列で、各要素の型を個別に指定できる
- **オプショナルな要素**: タプルで`?`を使って要素を省略可能にする
- **可変長タプル**: Rest要素を使って可変長のタプルを作成
- **readonlyタプル**: 要素を変更できないタプル
- **数値Enum**: 各メンバーに自動的に数値が割り当てられる
- **文字列Enum**: 各メンバーに文字列値を明示的に指定
- **const Enum**: コンパイル時にインライン展開されるEnum

### 重要なポイント
1. **タプル**: 要素数と型が厳密に決まっている配列
2. **分割代入**: タプルの要素を個別の変数に代入できる
3. **Enum**: 関連する定数をグループ化して管理
4. **数値Enum**: 自動的に数値が割り当てられる（0から開始）
5. **文字列Enum**: 明示的に文字列値を指定（デバッグしやすい）
6. **型として使用**: Enumを型として使用できる

### 使い分けの指針
- **タプル**: 固定長で、各要素の型が異なる場合（座標、RGB色など）
- **配列**: 可変長で、すべての要素が同じ型の場合
- **数値Enum**: 数値の定数が必要な場合（状態コード、インデックスなど）
- **文字列Enum**: 文字列の定数が必要な場合（サイズ、ログレベルなど）

### 次のステップ
次の章では、クラスとオブジェクト指向について詳しく学びます。

---

## 演習問題

### 問題1: タプルの基本
名前（文字列）と年齢（数値）のタプルを作成し、分割代入で表示してください。

<details>
<summary>解答例</summary>

```typescript
const person: [string, number] = ["太郎", 25];
const [name, age] = person;

console.log(`名前: ${name}, 年齢: ${age}歳`);
```
</details>

### 問題2: タプルを戻り値として使用
2つの数値を受け取り、商と余りをタプルで返す関数を作成してください。

<details>
<summary>解答例</summary>

```typescript
function divide(a: number, b: number): [number, number] {
    const quotient = Math.floor(a / b);
    const remainder = a % b;
    return [quotient, remainder];
}

const [q, r] = divide(17, 5);
console.log(`17 ÷ 5 = ${q} 余り ${r}`); // 17 ÷ 5 = 3 余り 2
```
</details>

### 問題3: 数値Enum
曜日を表す数値Enumを作成し、曜日名を表示する関数を作成してください。

<details>
<summary>解答例</summary>

```typescript
enum DayOfWeek {
    Sunday,
    Monday,
    Tuesday,
    Wednesday,
    Thursday,
    Friday,
    Saturday
}

function getDayName(day: DayOfWeek): string {
    const dayNames = ["日曜日", "月曜日", "火曜日", "水曜日", "木曜日", "金曜日", "土曜日"];
    return dayNames[day];
}

console.log(getDayName(DayOfWeek.Monday));  // 月曜日
console.log(getDayName(DayOfWeek.Friday));  // 金曜日
```
</details>

### 問題4: 文字列Enum
サイズを表す文字列Enumを作成し、サイズの説明を返す関数を作成してください。

<details>
<summary>解答例</summary>

```typescript
enum Size {
    Small = "S",
    Medium = "M",
    Large = "L",
    ExtraLarge = "XL"
}

function getSizeDescription(size: Size): string {
    switch (size) {
        case Size.Small:
            return "小さいサイズ";
        case Size.Medium:
            return "中サイズ";
        case Size.Large:
            return "大きいサイズ";
        case Size.ExtraLarge:
            return "特大サイズ";
    }
}

console.log(getSizeDescription(Size.Small));  // 小さいサイズ
console.log(getSizeDescription(Size.Large));  // 大きいサイズ
```
</details>

### 問題5: タプルとEnumの組み合わせ
状態を表すEnumと、状態とメッセージのタプルを使用して、状態に応じたメッセージを表示する関数を作成してください。

<details>
<summary>解答例</summary>

```typescript
enum Status {
    Pending,
    Processing,
    Completed,
    Error
}

function getStatusMessage(status: Status): [Status, string] {
    switch (status) {
        case Status.Pending:
            return [Status.Pending, "タスクは待機中です"];
        case Status.Processing:
            return [Status.Processing, "タスクを処理中です"];
        case Status.Completed:
            return [Status.Completed, "タスクが完了しました"];
        case Status.Error:
            return [Status.Error, "エラーが発生しました"];
    }
}

const [status, message] = getStatusMessage(Status.Pending);
console.log(`ステータス: ${Status[status]}, メッセージ: ${message}`);
// ステータス: Pending, メッセージ: タスクは待機中です
```
</details>

---

お疲れ様でした！次の章に進みましょう。

