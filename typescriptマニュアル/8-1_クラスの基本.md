# 8-1. クラスの基本

この章では、オブジェクト指向プログラミングの基礎となる「クラス」について学びます。TypeScriptでは、クラスの型を明示的に指定できるため、より安全なコードを書けます。クラスを理解することで、関連するデータと処理を整理して管理できるようになります。

---

## 目次

- [クラス宣言とインスタンス化](#クラス宣言とインスタンス化)
- [コンストラクタを使おう](#コンストラクタを使おう)
- [メソッドを使おう](#メソッドを使おう)
- [クラスの型について](#クラスの型について)
- [まとめ](#まとめ)
- [演習問題](#演習問題)

---

## クラス宣言とインスタンス化

### クラスとは
クラスは、**オブジェクトの設計図**のようなものです。同じ構造のオブジェクトを効率的に作成できます。

### オブジェクト指向プログラミングとは
オブジェクト指向プログラミング（OOP）は、**データと処理を1つにまとめて管理する**プログラミングの考え方です。

### 日常生活での例
- **自動車の設計図**: クラス（設計図）から、実際の車（インスタンス）を作る
- **家の設計図**: クラス（設計図）から、実際の家（インスタンス）を作る
- **レシピ**: クラス（レシピ）から、実際の料理（インスタンス）を作る

### クラス宣言の基本構文

```typescript
class クラス名 {
    プロパティ1: 型1;
    プロパティ2: 型2;
    
    constructor(引数1: 型1, 引数2: 型2) {
        this.プロパティ1 = 引数1;
        this.プロパティ2 = 引数2;
    }
}
```

### インスタンス化

```typescript
const インスタンス名 = new クラス名(引数1, 引数2);
```

### 実践例: クラス宣言とインスタンス化

```typescript
// src/class-declaration.ts
// 基本的なクラス宣言
class Person {
    name: string;
    age: number;
    
    constructor(name: string, age: number) {
        this.name = name;
        this.age = age;
    }
}

// インスタンス化
const person1 = new Person("太郎", 25);
const person2 = new Person("花子", 30);

console.log(`person1: ${person1.name}, ${person1.age}歳`);
console.log(`person2: ${person2.name}, ${person2.age}歳`);

// 実践例: 自動車クラス
class Car {
    brand: string;
    model: string;
    year: number;
    
    constructor(brand: string, model: string, year: number) {
        this.brand = brand;
        this.model = model;
        this.year = year;
    }
}

const car1 = new Car("トヨタ", "プリウス", 2020);
const car2 = new Car("ホンダ", "フィット", 2021);

console.log(`car1: ${car1.brand} ${car1.model} (${car1.year}年)`);
console.log(`car2: ${car2.brand} ${car2.model} (${car2.year}年)`);

// 実践例: 商品クラス
class Product {
    name: string;
    price: number;
    stock: number;
    
    constructor(name: string, price: number, stock: number) {
        this.name = name;
        this.price = price;
        this.stock = stock;
    }
}

const product1 = new Product("りんご", 100, 50);
const product2 = new Product("バナナ", 80, 30);

console.log(`商品1: ${product1.name} - ${product1.price}円 (在庫: ${product1.stock})`);
console.log(`商品2: ${product2.name} - ${product2.price}円 (在庫: ${product2.stock})`);

// 実践例: 学生クラス
class Student {
    studentId: string;
    name: string;
    grade: number;
    
    constructor(studentId: string, name: string, grade: number) {
        this.studentId = studentId;
        this.name = name;
        this.grade = grade;
    }
}

const student1 = new Student("S001", "太郎", 1);
const student2 = new Student("S002", "花子", 2);

console.log(`学生1: ${student1.studentId} - ${student1.name} (${student1.grade}年生)`);
console.log(`学生2: ${student2.studentId} - ${student2.name} (${student2.grade}年生)`);
```

---

## コンストラクタを使おう

### コンストラクタとは
コンストラクタは、**インスタンスが作成されるときに自動的に実行される特殊なメソッド**です。

### コンストラクタの特徴
- **自動実行**: インスタンス化時に自動的に実行される
- **初期化**: プロパティの初期値を設定する
- **引数を受け取る**: インスタンス化時に引数を渡せる
- **1つだけ**: 1つのクラスに1つだけ定義できる

### コンストラクタの基本構文

```typescript
class クラス名 {
    プロパティ1: 型1;
    プロパティ2: 型2;
    
    constructor(引数1: 型1, 引数2: 型2) {
        this.プロパティ1 = 引数1;
        this.プロパティ2 = 引数2;
    }
}
```

### 実践例: コンストラクタ

```typescript
// src/constructor.ts
// 基本的なコンストラクタ
class Person {
    name: string;
    age: number;
    
    constructor(name: string, age: number) {
        this.name = name;
        this.age = age;
        console.log(`${name}が作成されました`);
    }
}

const person1 = new Person("太郎", 25);
const person2 = new Person("花子", 30);

// 実践例: デフォルト値を持つコンストラクタ
class BankAccount {
    accountNumber: string;
    balance: number;
    owner: string;
    
    constructor(accountNumber: string, owner: string, balance: number = 0) {
        this.accountNumber = accountNumber;
        this.owner = owner;
        this.balance = balance;
    }
}

const account1 = new BankAccount("123456", "太郎", 1000);
const account2 = new BankAccount("789012", "花子"); // balanceは0で初期化

console.log(`口座1: ${account1.owner} - ${account1.balance}円`);
console.log(`口座2: ${account2.owner} - ${account2.balance}円`);

// 実践例: 複数のプロパティを初期化
class Rectangle {
    width: number;
    height: number;
    
    constructor(width: number, height: number) {
        this.width = width;
        this.height = height;
    }
    
    getArea(): number {
        return this.width * this.height;
    }
}

const rect1 = new Rectangle(10, 5);
const rect2 = new Rectangle(20, 15);

console.log(`rect1の面積: ${rect1.getArea()}`); // 50
console.log(`rect2の面積: ${rect2.getArea()}`); // 300

// 実践例: 計算を行うコンストラクタ
class Circle {
    radius: number;
    area: number;
    circumference: number;
    
    constructor(radius: number) {
        this.radius = radius;
        this.area = Math.PI * radius * radius;
        this.circumference = 2 * Math.PI * radius;
    }
}

const circle1 = new Circle(5);
console.log(`半径5の円 - 面積: ${circle1.area.toFixed(2)}, 円周: ${circle1.circumference.toFixed(2)}`);

// 実践例: オプショナルな引数
class User {
    username: string;
    email: string;
    isActive: boolean;
    
    constructor(username: string, email: string, isActive: boolean = true) {
        this.username = username;
        this.email = email;
        this.isActive = isActive;
    }
}

const user1 = new User("taro", "taro@example.com");
const user2 = new User("hanako", "hanako@example.com", false);

console.log(`user1: ${user1.username} - アクティブ: ${user1.isActive}`);
console.log(`user2: ${user2.username} - アクティブ: ${user2.isActive}`);

// 実践例: バリデーションを含むコンストラクタ
class Book {
    title: string;
    author: string;
    pages: number;
    
    constructor(title: string, author: string, pages: number) {
        if (pages <= 0) {
            throw new Error("ページ数は1以上である必要があります");
        }
        
        this.title = title;
        this.author = author;
        this.pages = pages;
    }
}

const book1 = new Book("TypeScript入門", "山田太郎", 300);
console.log(`書籍: ${book1.title} - ${book1.author} (${book1.pages}ページ)`);

// エラー例（コメントアウト）
// const book2 = new Book("無効な本", "著者", 0); // エラーが発生
```

---

## メソッドを使おう

### メソッドとは
メソッドは、**クラス内で定義される関数**です。インスタンスの動作を定義します。

### メソッドの基本構文

```typescript
class クラス名 {
    メソッド名(): 戻り値の型 {
        // 処理
        return 戻り値;
    }
}
```

### thisキーワード
`this`は、**現在のインスタンス**を指します。メソッド内でインスタンスのプロパティやメソッドにアクセスする際に使用します。

### 実践例: メソッド

```typescript
// src/methods.ts
// 基本的なメソッド
class Person {
    name: string;
    age: number;
    
    constructor(name: string, age: number) {
        this.name = name;
        this.age = age;
    }
    
    greet(): string {
        return `こんにちは、${this.name}です。${this.age}歳です。`;
    }
    
    getAge(): number {
        return this.age;
    }
    
    setAge(newAge: number): void {
        if (newAge >= 0) {
            this.age = newAge;
        }
    }
}

const person = new Person("太郎", 25);
console.log(person.greet());        // こんにちは、太郎です。25歳です。
console.log(`年齢: ${person.getAge()}`); // 25
person.setAge(30);
console.log(`新しい年齢: ${person.getAge()}`); // 30

// 実践例: 計算メソッド
class Calculator {
    value: number;
    
    constructor(initialValue: number = 0) {
        this.value = initialValue;
    }
    
    add(num: number): void {
        this.value += num;
    }
    
    subtract(num: number): void {
        this.value -= num;
    }
    
    multiply(num: number): void {
        this.value *= num;
    }
    
    divide(num: number): void {
        if (num !== 0) {
            this.value /= num;
        } else {
            console.log("0で割ることはできません");
        }
    }
    
    getValue(): number {
        return this.value;
    }
    
    reset(): void {
        this.value = 0;
    }
}

const calc = new Calculator(10);
calc.add(5);
console.log(`加算後: ${calc.getValue()}`); // 15

calc.subtract(3);
console.log(`減算後: ${calc.getValue()}`); // 12

calc.multiply(2);
console.log(`乗算後: ${calc.getValue()}`); // 24

calc.divide(4);
console.log(`除算後: ${calc.getValue()}`); // 6

// 実践例: 銀行口座クラス
class BankAccount {
    accountNumber: string;
    balance: number;
    owner: string;
    
    constructor(accountNumber: string, owner: string, balance: number = 0) {
        this.accountNumber = accountNumber;
        this.owner = owner;
        this.balance = balance;
    }
    
    deposit(amount: number): void {
        if (amount > 0) {
            this.balance += amount;
            console.log(`${amount}円を預け入れました。残高: ${this.balance}円`);
        } else {
            console.log("預入額は0より大きい必要があります");
        }
    }
    
    withdraw(amount: number): boolean {
        if (amount > 0 && amount <= this.balance) {
            this.balance -= amount;
            console.log(`${amount}円を引き出しました。残高: ${this.balance}円`);
            return true;
        } else {
            console.log("引き出しに失敗しました");
            return false;
        }
    }
    
    getBalance(): number {
        return this.balance;
    }
    
    getAccountInfo(): string {
        return `口座番号: ${this.accountNumber}, 名義: ${this.owner}, 残高: ${this.balance}円`;
    }
}

const account = new BankAccount("123456", "太郎", 1000);
console.log(account.getAccountInfo());

account.deposit(500);
account.withdraw(200);
account.withdraw(2000); // 失敗

// 実践例: 図形クラス
class Rectangle {
    width: number;
    height: number;
    
    constructor(width: number, height: number) {
        this.width = width;
        this.height = height;
    }
    
    getArea(): number {
        return this.width * this.height;
    }
    
    getPerimeter(): number {
        return 2 * (this.width + this.height);
    }
    
    isSquare(): boolean {
        return this.width === this.height;
    }
    
    scale(factor: number): void {
        this.width *= factor;
        this.height *= factor;
    }
}

const rect = new Rectangle(10, 5);
console.log(`面積: ${rect.getArea()}`);        // 50
console.log(`周囲: ${rect.getPerimeter()}`);   // 30
console.log(`正方形: ${rect.isSquare()}`);     // false

rect.scale(2);
console.log(`拡大後 - 幅: ${rect.width}, 高さ: ${rect.height}`); // 20, 10

// 実践例: 商品クラス
class Product {
    name: string;
    price: number;
    stock: number;
    
    constructor(name: string, price: number, stock: number) {
        this.name = name;
        this.price = price;
        this.stock = stock;
    }
    
    purchase(quantity: number): boolean {
        if (quantity > 0 && quantity <= this.stock) {
            this.stock -= quantity;
            const total = this.price * quantity;
            console.log(`${this.name}を${quantity}個購入しました。合計: ${total}円`);
            return true;
        } else {
            console.log("購入に失敗しました");
            return false;
        }
    }
    
    restock(quantity: number): void {
        if (quantity > 0) {
            this.stock += quantity;
            console.log(`${this.name}を${quantity}個入荷しました。在庫: ${this.stock}`);
        }
    }
    
    getTotalValue(): number {
        return this.price * this.stock;
    }
    
    isAvailable(): boolean {
        return this.stock > 0;
    }
}

const product = new Product("りんご", 100, 50);
console.log(`商品: ${product.name} - ${product.price}円 (在庫: ${product.stock})`);
console.log(`在庫総額: ${product.getTotalValue()}円`);

product.purchase(10);
product.restock(20);
console.log(`在庫: ${product.stock}`);
```

---

## クラスの型について

### クラスの型とは
TypeScriptでは、クラスは**型としても使用できる**という特徴があります。

### クラスを型として使用

```typescript
// クラスを型として使用
const 変数名: クラス名 = new クラス名();
```

### クラス型の特徴
- **型チェック**: インスタンスがクラスの型と一致するかチェックできる
- **型推論**: TypeScriptが自動的に型を推論する
- **インターフェースとの違い**: クラスは値としても型としても使用できる

### 実践例: クラスの型

```typescript
// src/class-types.ts
// 基本的なクラス型
class Person {
    name: string;
    age: number;
    
    constructor(name: string, age: number) {
        this.name = name;
        this.age = age;
    }
}

// クラスを型として使用
const person1: Person = new Person("太郎", 25);
const person2: Person = new Person("花子", 30);

// 型推論も可能
const person3 = new Person("次郎", 20); // Person型と推論される

// 実践例: 関数の引数としてクラス型を使用
function greetPerson(person: Person): void {
    console.log(`こんにちは、${person.name}さん（${person.age}歳）`);
}

greetPerson(person1); // こんにちは、太郎さん（25歳）
greetPerson(person2); // こんにちは、花子さん（30歳）

// 実践例: 関数の戻り値としてクラス型を使用
function createPerson(name: string, age: number): Person {
    return new Person(name, age);
}

const person4: Person = createPerson("三郎", 35);
console.log(`作成された人物: ${person4.name}`);

// 実践例: 配列の型としてクラス型を使用
const people: Person[] = [
    new Person("太郎", 25),
    new Person("花子", 30),
    new Person("次郎", 20)
];

people.forEach((person: Person): void => {
    console.log(`${person.name}: ${person.age}歳`);
});

// 実践例: 複数のクラス型
class Car {
    brand: string;
    model: string;
    
    constructor(brand: string, model: string) {
        this.brand = brand;
        this.model = model;
    }
    
    getInfo(): string {
        return `${this.brand} ${this.model}`;
    }
}

class Motorcycle {
    brand: string;
    model: string;
    
    constructor(brand: string, model: string) {
        this.brand = brand;
        this.model = model;
    }
    
    getInfo(): string {
        return `${this.brand} ${this.model}`;
    }
}

// 異なるクラス型の配列
const vehicles: (Car | Motorcycle)[] = [
    new Car("トヨタ", "プリウス"),
    new Motorcycle("ホンダ", "CB400"),
    new Car("日産", "リーフ")
];

vehicles.forEach((vehicle: Car | Motorcycle): void => {
    console.log(vehicle.getInfo());
});

// 実践例: 型ガード
function isCar(vehicle: Car | Motorcycle): vehicle is Car {
    return vehicle instanceof Car;
}

vehicles.forEach((vehicle: Car | Motorcycle): void => {
    if (isCar(vehicle)) {
        console.log(`車: ${vehicle.getInfo()}`);
    } else {
        console.log(`バイク: ${vehicle.getInfo()}`);
    }
});

// 実践例: クラス型の比較
class Point {
    x: number;
    y: number;
    
    constructor(x: number, y: number) {
        this.x = x;
        this.y = y;
    }
    
    equals(other: Point): boolean {
        return this.x === other.x && this.y === other.y;
    }
}

const point1 = new Point(10, 20);
const point2 = new Point(10, 20);
const point3 = new Point(5, 15);

console.log(`point1とpoint2は等しい: ${point1.equals(point2)}`); // true
console.log(`point1とpoint3は等しい: ${point1.equals(point3)}`); // false

// 実践例: クラス型の継承（後の章で詳しく学びます）
class Animal {
    name: string;
    
    constructor(name: string) {
        this.name = name;
    }
    
    speak(): void {
        console.log(`${this.name}が鳴いています`);
    }
}

class Dog extends Animal {
    breed: string;
    
    constructor(name: string, breed: string) {
        super(name);
        this.breed = breed;
    }
}

// 親クラスの型として使用可能
const dog: Animal = new Dog("ポチ", "柴犬");
dog.speak(); // ポチが鳴いています
```

---

## まとめ

この章では、TypeScriptのクラスの基本について学びました。

### 学んだこと
- クラス宣言とインスタンス化: オブジェクトの設計図を作成
- コンストラクタ: インスタンス作成時の初期化処理
- メソッド: クラス内で定義される関数
- クラスの型: クラスを型として使用

### 重要なポイント
1. **クラス**: オブジェクトの設計図
2. **インスタンス**: クラスから作成された実際のオブジェクト
3. **コンストラクタ**: インスタンス化時に自動実行される
4. **メソッド**: インスタンスの動作を定義
5. **this**: 現在のインスタンスを指す
6. **型としてのクラス**: TypeScriptではクラスを型としても使用できる

### 次のステップ
次の章では、アクセス修飾子とカプセル化について詳しく学びます。

---

## 演習問題

### 問題1: クラス宣言とインスタンス化
名前と年齢を持つ`Person`クラスを作成し、インスタンスを2つ作成してください。

<details>
<summary>解答例</summary>

```typescript
class Person {
    name: string;
    age: number;
    
    constructor(name: string, age: number) {
        this.name = name;
        this.age = age;
    }
}

const person1 = new Person("太郎", 25);
const person2 = new Person("花子", 30);

console.log(`person1: ${person1.name}, ${person1.age}歳`);
console.log(`person2: ${person2.name}, ${person2.age}歳`);
```
</details>

### 問題2: コンストラクタ
幅と高さを持つ`Rectangle`クラスを作成し、コンストラクタで初期化してください。

<details>
<summary>解答例</summary>

```typescript
class Rectangle {
    width: number;
    height: number;
    
    constructor(width: number, height: number) {
        this.width = width;
        this.height = height;
    }
}

const rect = new Rectangle(10, 5);
console.log(`幅: ${rect.width}, 高さ: ${rect.height}`);
```
</details>

### 問題3: メソッド
`Rectangle`クラスに面積を計算する`getArea`メソッドを追加してください。

<details>
<summary>解答例</summary>

```typescript
class Rectangle {
    width: number;
    height: number;
    
    constructor(width: number, height: number) {
        this.width = width;
        this.height = height;
    }
    
    getArea(): number {
        return this.width * this.height;
    }
}

const rect = new Rectangle(10, 5);
console.log(`面積: ${rect.getArea()}`); // 50
```
</details>

### 問題4: 複数のメソッド
`BankAccount`クラスに`deposit`（預金）と`withdraw`（引き出し）メソッドを追加してください。

<details>
<summary>解答例</summary>

```typescript
class BankAccount {
    balance: number;
    
    constructor(initialBalance: number = 0) {
        this.balance = initialBalance;
    }
    
    deposit(amount: number): void {
        this.balance += amount;
    }
    
    withdraw(amount: number): boolean {
        if (amount <= this.balance) {
            this.balance -= amount;
            return true;
        }
        return false;
    }
    
    getBalance(): number {
        return this.balance;
    }
}

const account = new BankAccount(1000);
account.deposit(500);
account.withdraw(200);
console.log(`残高: ${account.getBalance()}円`); // 1300円
```
</details>

### 問題5: クラスの型
`Person`クラスを型として使用し、配列を作成してください。

<details>
<summary>解答例</summary>

```typescript
class Person {
    name: string;
    age: number;
    
    constructor(name: string, age: number) {
        this.name = name;
        this.age = age;
    }
}

const people: Person[] = [
    new Person("太郎", 25),
    new Person("花子", 30),
    new Person("次郎", 20)
];

people.forEach((person: Person): void => {
    console.log(`${person.name}: ${person.age}歳`);
});
```
</details>

---

お疲れ様でした！次の章に進みましょう。

