# 7-2. データ構造（オブジェクト）

この章では、複数の値をまとめて管理する「オブジェクト」について学びます。オブジェクトを理解することで、関連するデータを効率的に管理し、より実践的なプログラムを作成できるようになります。

---

## 目次

- [オブジェクト（連想配列）の基本](#オブジェクト連想配列の基本)
- [オブジェクト型の定義](#オブジェクト型の定義)
- [オプショナルなプロパティ（?）](#オプショナルなプロパティ)
- [まとめ](#まとめ)
- [演習問題](#演習問題)

---

## オブジェクト（連想配列）の基本

### オブジェクトとは
オブジェクトは、**複数の値を「キー（名前）」と「値」のペアで管理する**データ構造です。連想配列や辞書とも呼ばれます。

### 日常生活での例
- **名刺**: 名前、電話番号、メールアドレスなど、関連する情報を1枚にまとめる
- **住所録**: 名前と住所を対応付けて管理する
- **商品カタログ**: 商品名と価格を対応付けて管理する

### プログラミングでの例

```typescript
// ユーザー情報をオブジェクトで管理
const user = {
    name: "太郎",
    age: 25,
    email: "taro@example.com"
};

// 各情報にアクセス
console.log(user.name);   // "太郎"
console.log(user.age);    // 25
console.log(user.email);  // "taro@example.com"
```

### オブジェクトの基本構文

```typescript
// オブジェクトの作成
const オブジェクト名 = {
    キー1: 値1,
    キー2: 値2,
    キー3: 値3
};

// 値へのアクセス
オブジェクト名.キー名
// または
オブジェクト名["キー名"]
```

### オブジェクトの特徴
1. **キーと値のペア**: 各データに名前（キー）を付けて管理できる
2. **異なる型を混在可能**: 文字列、数値、真偽値など、異なる型を1つのオブジェクトに含められる
3. **柔軟な構造**: 必要な情報だけを含めることができる
4. **型安全性**: TypeScriptでは型を定義することで、エラーを事前に発見できる

### 実践例: オブジェクトの基本

```typescript
// src/object-basics.ts
// ユーザー情報をオブジェクトで管理
const user1 = {
    name: "太郎",
    age: 25,
    email: "taro@example.com",
    isActive: true
};

console.log(`名前: ${user1.name}`);
console.log(`年齢: ${user1.age}`);
console.log(`メール: ${user1.email}`);
console.log(`アクティブ: ${user1.isActive}`);

// 商品情報をオブジェクトで管理
const product = {
    id: 1,
    name: "ノートパソコン",
    price: 98000,
    inStock: true
};

console.log(`商品名: ${product.name}`);
console.log(`価格: ${product.price}円`);

// オブジェクトの値の変更
product.price = 95000;
console.log(`新価格: ${product.price}円`);

// ドット記法とブラケット記法
const key = "name";
console.log(user1.name);        // ドット記法
console.log(user1["name"]);     // ブラケット記法
console.log(user1[key]);        // ブラケット記法（変数を使用）
```

### オブジェクトの操作

```typescript
// src/object-operations.ts
const person = {
    name: "花子",
    age: 30
};

// プロパティの追加
person.email = "hanako@example.com";
console.log(person); // { name: "花子", age: 30, email: "hanako@example.com" }

// プロパティの削除
delete person.email;
console.log(person); // { name: "花子", age: 30 }

// プロパティの存在確認
if ("name" in person) {
    console.log("nameプロパティが存在します");
}

// オブジェクトのコピー
const personCopy = { ...person };
personCopy.age = 31;
console.log(person.age);      // 30（元のオブジェクトは変更されない）
console.log(personCopy.age); // 31（コピーは独立している）
```

### ネストしたオブジェクト

```typescript
// src/nested-object.ts
// オブジェクトの中にオブジェクトを含める
const user = {
    name: "太郎",
    age: 25,
    address: {
        prefecture: "東京都",
        city: "渋谷区",
        zipCode: "150-0001"
    },
    contact: {
        email: "taro@example.com",
        phone: "03-1234-5678"
    }
};

console.log(user.name);                    // "太郎"
console.log(user.address.prefecture);      // "東京都"
console.log(user.address.city);            // "渋谷区"
console.log(user.contact.email);          // "taro@example.com"
```

---

## オブジェクト型の定義

### オブジェクト型とは
TypeScriptでは、**オブジェクトの構造を型として定義**できます。これにより、型安全性が向上し、エラーを事前に発見できます。

### オブジェクト型の基本構文

```typescript
// オブジェクト型の定義
const 変数名: {
    キー1: 型1;
    キー2: 型2;
    キー3: 型3;
} = {
    キー1: 値1,
    キー2: 値2,
    キー3: 値3
};
```

### 型注釈を使ったオブジェクト

```typescript
// オブジェクト型を明示的に指定
const user: {
    name: string;
    age: number;
    email: string;
} = {
    name: "太郎",
    age: 25,
    email: "taro@example.com"
};

// 型エラーが発生する例
// const user2: { name: string; age: number } = {
//     name: "花子",
//     age: "30"  // エラー: 数値型が期待されているが文字列型が指定されている
// };
```

### 実践例: オブジェクト型の定義

```typescript
// src/object-type-definition.ts
// ユーザー情報の型定義
const user: {
    id: number;
    name: string;
    age: number;
    email: string;
    isActive: boolean;
} = {
    id: 1,
    name: "太郎",
    age: 25,
    email: "taro@example.com",
    isActive: true
};

console.log(`ユーザーID: ${user.id}`);
console.log(`ユーザー名: ${user.name}`);

// 商品情報の型定義
const product: {
    id: number;
    name: string;
    price: number;
    category: string;
    inStock: boolean;
} = {
    id: 1001,
    name: "ノートパソコン",
    price: 98000,
    category: "電子機器",
    inStock: true
};

console.log(`商品名: ${product.name}`);
console.log(`価格: ${product.price}円`);

// 型推論を使った場合（型注釈を省略）
const book = {
    title: "TypeScript入門",
    author: "山田太郎",
    pages: 300,
    published: 2024
};

// TypeScriptが自動的に型を推論する
// book.title は string型
// book.pages は number型
console.log(`タイトル: ${book.title}, ページ数: ${book.pages}`);
```

### 型エイリアスを使ったオブジェクト型定義

```typescript
// src/object-type-alias.ts
// 型エイリアスでオブジェクト型を定義（後の章で詳しく学びます）
type User = {
    id: number;
    name: string;
    age: number;
    email: string;
};

// 型エイリアスを使用
const user1: User = {
    id: 1,
    name: "太郎",
    age: 25,
    email: "taro@example.com"
};

const user2: User = {
    id: 2,
    name: "花子",
    age: 30,
    email: "hanako@example.com"
};

// 同じ型を複数のオブジェクトで再利用できる
console.log(user1.name); // "太郎"
console.log(user2.name); // "花子"
```

### 関数の引数としてオブジェクトを使う

```typescript
// src/object-as-parameter.ts
// オブジェクトを引数として受け取る関数
function displayUser(user: {
    name: string;
    age: number;
    email: string;
}): void {
    console.log(`名前: ${user.name}`);
    console.log(`年齢: ${user.age}`);
    console.log(`メール: ${user.email}`);
}

const user = {
    name: "太郎",
    age: 25,
    email: "taro@example.com"
};

displayUser(user);

// 実践例: オブジェクトを返す関数
function createUser(
    name: string,
    age: number,
    email: string
): {
    name: string;
    age: number;
    email: string;
} {
    return {
        name: name,
        age: age,
        email: email
    };
}

const newUser = createUser("花子", 30, "hanako@example.com");
console.log(newUser);
```

### readonly修飾子を使ったオブジェクト型

```typescript
// src/readonly-object.ts
// readonly修飾子でプロパティを読み取り専用にする
const config: {
    readonly apiUrl: string;
    readonly version: string;
    timeout: number;
} = {
    apiUrl: "https://api.example.com",
    version: "1.0.0",
    timeout: 5000
};

console.log(config.apiUrl);  // OK: 読み取りは可能
// config.apiUrl = "https://new-api.example.com";  // エラー: 読み取り専用プロパティは変更できない

config.timeout = 10000;      // OK: timeoutは読み取り専用ではない
console.log(config.timeout); // 10000
```

---

## オプショナルなプロパティ（?）

### オプショナルプロパティとは
オプショナルプロパティは、**オブジェクトに含まれていても、含まれていなくてもよいプロパティ**です。`?`（クエスチョンマーク）を使って定義します。

### オプショナルプロパティの基本構文

```typescript
const 変数名: {
    必須プロパティ: 型;
    オプショナルプロパティ?: 型;
} = {
    必須プロパティ: 値
    // オプショナルプロパティは省略可能
};
```

### オプショナルプロパティの使用例

```typescript
// オプショナルプロパティの定義
const user: {
    name: string;
    age: number;
    email?: string;  // オプショナルプロパティ
} = {
    name: "太郎",
    age: 25
    // emailは省略可能
};

// emailが存在する場合としない場合
const user1: {
    name: string;
    age: number;
    email?: string;
} = {
    name: "太郎",
    age: 25
    // emailなし
};

const user2: {
    name: string;
    age: number;
    email?: string;
} = {
    name: "花子",
    age: 30,
    email: "hanako@example.com"  // emailあり
};
```

### 実践例: オプショナルプロパティ

```typescript
// src/optional-property.ts
// ユーザー情報（メールアドレスは任意）
const user1: {
    id: number;
    name: string;
    email?: string;  // オプショナル
} = {
    id: 1,
    name: "太郎"
    // emailは省略
};

const user2: {
    id: number;
    name: string;
    email?: string;
} = {
    id: 2,
    name: "花子",
    email: "hanako@example.com"  // emailを指定
};

console.log(user1.name);  // "太郎"
console.log(user2.name);  // "花子"
console.log(user2.email); // "hanako@example.com"

// オプショナルプロパティの存在確認
function displayUser(user: {
    name: string;
    email?: string;
}): void {
    console.log(`名前: ${user.name}`);
    if (user.email) {
        console.log(`メール: ${user.email}`);
    } else {
        console.log("メールアドレスは登録されていません");
    }
}

displayUser(user1); // メールアドレスは登録されていません
displayUser(user2); // メール: hanako@example.com
```

### 複数のオプショナルプロパティ

```typescript
// src/multiple-optional-properties.ts
// 複数のオプショナルプロパティを持つオブジェクト
const product: {
    id: number;
    name: string;
    price: number;
    description?: string;  // オプショナル
    imageUrl?: string;     // オプショナル
    category?: string;     // オプショナル
} = {
    id: 1001,
    name: "ノートパソコン",
    price: 98000
    // 他のプロパティは省略可能
};

// すべてのオプショナルプロパティを含む場合
const product2: {
    id: number;
    name: string;
    price: number;
    description?: string;
    imageUrl?: string;
    category?: string;
} = {
    id: 1002,
    name: "マウス",
    price: 2500,
    description: "ワイヤレスマウス",
    imageUrl: "https://example.com/mouse.jpg",
    category: "アクセサリ"
};

console.log(product.name);
console.log(product2.name);
console.log(product2.description);
```

### オプショナルプロパティと条件分岐

```typescript
// src/optional-property-conditional.ts
// オプショナルプロパティを安全に扱う
function getUserInfo(user: {
    name: string;
    age: number;
    email?: string;
    phone?: string;
}): string {
    let info = `名前: ${user.name}, 年齢: ${user.age}`;
    
    // オプショナルプロパティの存在確認
    if (user.email) {
        info += `, メール: ${user.email}`;
    }
    
    if (user.phone) {
        info += `, 電話: ${user.phone}`;
    }
    
    return info;
}

const user1 = {
    name: "太郎",
    age: 25
};

const user2 = {
    name: "花子",
    age: 30,
    email: "hanako@example.com",
    phone: "03-1234-5678"
};

console.log(getUserInfo(user1));
// 名前: 太郎, 年齢: 25

console.log(getUserInfo(user2));
// 名前: 花子, 年齢: 30, メール: hanako@example.com, 電話: 03-1234-5678
```

### オプショナルチェーン演算子（?.）

```typescript
// src/optional-chaining.ts
// オプショナルチェーン演算子で安全にアクセス
const user: {
    name: string;
    contact?: {
        email?: string;
        phone?: string;
    };
} = {
    name: "太郎"
    // contactは省略可能
};

// オプショナルチェーン演算子を使わない場合（エラーになる可能性）
// console.log(user.contact.email);  // エラー: contactがundefinedの可能性がある

// オプショナルチェーン演算子を使う場合（安全）
console.log(user.contact?.email);     // undefined（エラーにならない）
console.log(user.contact?.phone);     // undefined（エラーにならない）

// contactがある場合
const user2: {
    name: string;
    contact?: {
        email?: string;
        phone?: string;
    };
} = {
    name: "花子",
    contact: {
        email: "hanako@example.com"
    }
};

console.log(user2.contact?.email);    // "hanako@example.com"
console.log(user2.contact?.phone);    // undefined
```

### 実践例: 設定オブジェクト

```typescript
// src/config-object.ts
// 設定オブジェクトでオプショナルプロパティを活用
function createConfig(config: {
    apiUrl: string;
    timeout?: number;
    retryCount?: number;
    debug?: boolean;
}): {
    apiUrl: string;
    timeout: number;
    retryCount: number;
    debug: boolean;
} {
    return {
        apiUrl: config.apiUrl,
        timeout: config.timeout ?? 5000,      // デフォルト値: 5000
        retryCount: config.retryCount ?? 3,   // デフォルト値: 3
        debug: config.debug ?? false          // デフォルト値: false
    };
}

// 最小限の設定
const config1 = createConfig({
    apiUrl: "https://api.example.com"
});

// すべての設定を指定
const config2 = createConfig({
    apiUrl: "https://api.example.com",
    timeout: 10000,
    retryCount: 5,
    debug: true
});

console.log(config1);
// { apiUrl: "https://api.example.com", timeout: 5000, retryCount: 3, debug: false }

console.log(config2);
// { apiUrl: "https://api.example.com", timeout: 10000, retryCount: 5, debug: true }
```

---

## まとめ

この章では、オブジェクトについて以下のことを学びました。

### オブジェクトの基本
- オブジェクトは、キーと値のペアで複数のデータを管理するデータ構造
- ドット記法（`object.key`）とブラケット記法（`object["key"]`）で値にアクセスできる
- 異なる型の値を1つのオブジェクトに含めることができる
- オブジェクトの中にオブジェクトを含める（ネスト）こともできる

### オブジェクト型の定義
- TypeScriptでは、オブジェクトの構造を型として定義できる
- 型注釈を使うことで、型安全性が向上し、エラーを事前に発見できる
- 型推論により、型注釈を省略しても自動的に型が推論される
- `readonly`修飾子でプロパティを読み取り専用にできる

### オプショナルプロパティ
- `?`（クエスチョンマーク）を使って、オプショナルプロパティを定義できる
- オプショナルプロパティは、オブジェクトに含まれていても、含まれていなくてもよい
- オプショナルチェーン演算子（`?.`）で、安全にプロパティにアクセスできる
- オプショナルプロパティは、設定オブジェクトなどでよく使われる

### オブジェクトの活用場面
- ユーザー情報、商品情報など、関連するデータをまとめて管理する
- 関数の引数として、複数の値をまとめて渡す
- 設定オブジェクトとして、オプショナルな設定を柔軟に指定する

### 次のステップ
オブジェクトを理解したら、次のトピックに進みましょう：
- 配列（7-1）
- タプル型（7-3）
- クラスとオブジェクト指向（8章）

---

## 演習問題

以下の問題を解いて、オブジェクトの理解を深めましょう。

### 問題1: オブジェクトの基本
ユーザー情報を表すオブジェクトを作成し、名前、年齢、メールアドレスを表示してください。

<details>
<summary>解答例</summary>

```typescript
const user: {
    name: string;
    age: number;
    email: string;
} = {
    name: "太郎",
    age: 25,
    email: "taro@example.com"
};

console.log(`名前: ${user.name}`);
console.log(`年齢: ${user.age}`);
console.log(`メール: ${user.email}`);
```
</details>

### 問題2: オブジェクト型の定義
商品情報を表すオブジェクト型を定義し、商品名、価格、在庫数を表示する関数を作成してください。

<details>
<summary>解答例</summary>

```typescript
function displayProduct(product: {
    name: string;
    price: number;
    stock: number;
}): void {
    console.log(`商品名: ${product.name}`);
    console.log(`価格: ${product.price}円`);
    console.log(`在庫数: ${product.stock}個`);
}

const product = {
    name: "ノートパソコン",
    price: 98000,
    stock: 10
};

displayProduct(product);
```
</details>

### 問題3: オプショナルプロパティ
ユーザー情報を表すオブジェクトを作成し、メールアドレスはオプショナルにしてください。メールアドレスがある場合は表示し、ない場合は「メールアドレスは登録されていません」と表示してください。

<details>
<summary>解答例</summary>

```typescript
function displayUser(user: {
    name: string;
    age: number;
    email?: string;
}): void {
    console.log(`名前: ${user.name}`);
    console.log(`年齢: ${user.age}`);
    if (user.email) {
        console.log(`メール: ${user.email}`);
    } else {
        console.log("メールアドレスは登録されていません");
    }
}

const user1 = {
    name: "太郎",
    age: 25
};

const user2 = {
    name: "花子",
    age: 30,
    email: "hanako@example.com"
};

displayUser(user1);
displayUser(user2);
```
</details>

### 問題4: ネストしたオブジェクト
住所情報を含むユーザー情報を表すオブジェクトを作成し、都道府県と市区町村を表示してください。

<details>
<summary>解答例</summary>

```typescript
const user: {
    name: string;
    age: number;
    address: {
        prefecture: string;
        city: string;
        zipCode: string;
    };
} = {
    name: "太郎",
    age: 25,
    address: {
        prefecture: "東京都",
        city: "渋谷区",
        zipCode: "150-0001"
    }
};

console.log(`名前: ${user.name}`);
console.log(`都道府県: ${user.address.prefecture}`);
console.log(`市区町村: ${user.address.city}`);
```
</details>

### 問題5: オブジェクトを返す関数
名前、年齢、メールアドレスを受け取り、ユーザー情報オブジェクトを返す関数を作成してください。

<details>
<summary>解答例</summary>

```typescript
function createUser(
    name: string,
    age: number,
    email: string
): {
    name: string;
    age: number;
    email: string;
} {
    return {
        name: name,
        age: age,
        email: email
    };
}

const user = createUser("太郎", 25, "taro@example.com");
console.log(user);
```
</details>

---

お疲れ様でした！次の章に進みましょう。

