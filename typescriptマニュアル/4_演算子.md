# 4. 演算子

この章では、TypeScriptで計算や比較を行うための「演算子」について学びます。演算子を理解することで、様々な計算や条件判定ができるようになります。

---

## 目次

- [基本的な演算子を使おう](#基本的な演算子を使おう)
- [複合代入演算子を使おう](#複合代入演算子を使おう)
- [インクリメントとデクリメントを使おう](#インクリメントとデクリメントを使おう)
- [演算子の優先順位を理解しよう](#演算子の優先順位を理解しよう)
- [NaN / Infinity](#nan--infinity)
- [まとめ](#まとめ)
- [演習問題](#演習問題)

---

## 基本的な演算子を使おう

### 演算子とは
演算子は、**値に対して計算や比較を行う記号**です。

### 算術演算子

#### 加算（+）
```typescript
let sum = 10 + 5;
console.log(sum); // 15
```

#### 減算（-）
```typescript
let difference = 10 - 5;
console.log(difference); // 5
```

#### 乗算（*）
```typescript
let product = 10 * 5;
console.log(product); // 50
```

#### 除算（/）
```typescript
let quotient = 10 / 5;
console.log(quotient); // 2
```

#### 剰余（%）
```typescript
let remainder = 10 % 3;
console.log(remainder); // 1（10を3で割った余り）
```

#### べき乗（**）
```typescript
let power = 2 ** 3;
console.log(power); // 8（2の3乗）
```

### 比較演算子

#### 等価（==, ===）
```typescript
let a = 10;
let b = 10;

console.log(a == b);  // true（値が等しい）
console.log(a === b); // true（値と型が等しい）

// == と === の違い
console.log(10 == "10");  // true（型変換される）
console.log(10 === "10"); // false（型が異なる）
```

#### 不等価（!=, !==）
```typescript
let a = 10;
let b = 20;

console.log(a != b);  // true
console.log(a !== b); // true
```

#### 大小比較（<, >, <=, >=）
```typescript
let a = 10;
let b = 20;

console.log(a < b);  // true
console.log(a > b);  // false
console.log(a <= b); // true
console.log(a >= b); // false
```

### 論理演算子

#### AND（&&）
```typescript
let isActive = true;
let isVerified = true;

console.log(isActive && isVerified); // true（両方ともtrue）
```

#### OR（||）
```typescript
let isStudent = false;
let isTeacher = true;

console.log(isStudent || isTeacher); // true（どちらかがtrue）
```

#### NOT（!）
```typescript
let isActive = true;

console.log(!isActive); // false
```

### 実践例: 基本的な演算子

```typescript
// src/basic-operators.ts
// 算術演算子
let a = 10;
let b = 5;

console.log(`加算: ${a} + ${b} = ${a + b}`);      // 15
console.log(`減算: ${a} - ${b} = ${a - b}`);      // 5
console.log(`乗算: ${a} * ${b} = ${a * b}`);      // 50
console.log(`除算: ${a} / ${b} = ${a / b}`);      // 2
console.log(`剰余: ${a} % ${b} = ${a % b}`);      // 0
console.log(`べき乗: ${a} ** ${b} = ${a ** b}`);  // 100000

// 比較演算子
let x = 10;
let y = 20;

console.log(`${x} == ${y}: ${x == y}`);   // false
console.log(`${x} === ${y}: ${x === y}`); // false
console.log(`${x} != ${y}: ${x != y}`);    // true
console.log(`${x} < ${y}: ${x < y}`);     // true
console.log(`${x} > ${y}: ${x > y}`);     // false
console.log(`${x} <= ${y}: ${x <= y}`);   // true
console.log(`${x} >= ${y}: ${x >= y}`);   // false

// 論理演算子
let isActive = true;
let isVerified = true;
let isStudent = false;

console.log(`isActive && isVerified: ${isActive && isVerified}`); // true
console.log(`isActive || isStudent: ${isActive || isStudent}`);   // true
console.log(`!isActive: ${!isActive}`);                            // false

// 実践例: 計算機
function calculate(operation: string, a: number, b: number): number {
    switch (operation) {
        case "add":
            return a + b;
        case "subtract":
            return a - b;
        case "multiply":
            return a * b;
        case "divide":
            return a / b;
        default:
            return 0;
    }
}

console.log(`10 + 5 = ${calculate("add", 10, 5)}`);
console.log(`10 - 5 = ${calculate("subtract", 10, 5)}`);
console.log(`10 * 5 = ${calculate("multiply", 10, 5)}`);
console.log(`10 / 5 = ${calculate("divide", 10, 5)}`);
```

---

## 複合代入演算子を使おう

### 複合代入演算子とは
複合代入演算子は、**変数に値を代入しながら計算を行う**演算子です。

### 主な複合代入演算子

#### +=（加算代入）
```typescript
let count = 10;
count += 5;  // count = count + 5 と同じ
console.log(count); // 15
```

#### -=（減算代入）
```typescript
let count = 10;
count -= 3;  // count = count - 3 と同じ
console.log(count); // 7
```

#### *=（乗算代入）
```typescript
let count = 10;
count *= 2;  // count = count * 2 と同じ
console.log(count); // 20
```

#### /=（除算代入）
```typescript
let count = 10;
count /= 2;  // count = count / 2 と同じ
console.log(count); // 5
```

#### %=（剰余代入）
```typescript
let count = 10;
count %= 3;  // count = count % 3 と同じ
console.log(count); // 1
```

### 実践例: 複合代入演算子

```typescript
// src/compound-assignment.ts
// 加算代入
let total = 0;
total += 10;
total += 20;
total += 30;
console.log(`合計: ${total}`); // 60

// 減算代入
let balance = 100;
balance -= 30;
balance -= 20;
console.log(`残高: ${balance}`); // 50

// 乗算代入
let price = 100;
price *= 1.1;  // 10%増
console.log(`価格: ${price}`); // 110

// 除算代入
let quantity = 100;
quantity /= 2;
console.log(`数量: ${quantity}`); // 50

// 剰余代入
let remainder = 10;
remainder %= 3;
console.log(`余り: ${remainder}`); // 1

// 実践例: ショッピングカート
let cartTotal = 0;

// 商品を追加
cartTotal += 100;  // 商品1: 100円
cartTotal += 200;  // 商品2: 200円
cartTotal += 150;  // 商品3: 150円

console.log(`カート合計: ${cartTotal}円`); // 450円

// 割引を適用
cartTotal *= 0.9;  // 10%割引
console.log(`割引後: ${cartTotal}円`); // 405円

// 実践例: カウンター
let counter = 0;
counter += 1;
counter += 1;
counter += 1;
console.log(`カウンター: ${counter}`); // 3
```

---

## インクリメントとデクリメントを使おう

### インクリメントとは
インクリメントは、**変数の値を1増やす**演算子です。

### デクリメントとは
デクリメントは、**変数の値を1減らす**演算子です。

### 前置と後置の違い

#### 前置インクリメント（++変数）
```typescript
let count = 10;
let result = ++count;  // countを先に増やしてから代入
console.log(count);    // 11
console.log(result);   // 11
```

#### 後置インクリメント（変数++）
```typescript
let count = 10;
let result = count++;  // 代入してからcountを増やす
console.log(count);    // 11
console.log(result);   // 10
```

#### 前置デクリメント（--変数）
```typescript
let count = 10;
let result = --count;  // countを先に減らしてから代入
console.log(count);    // 9
console.log(result);   // 9
```

#### 後置デクリメント（変数--）
```typescript
let count = 10;
let result = count--;  // 代入してからcountを減らす
console.log(count);    // 9
console.log(result);   // 10
```

### 実践例: インクリメントとデクリメント

```typescript
// src/increment-decrement.ts
// 前置インクリメント
let count1 = 10;
let result1 = ++count1;
console.log(`count1: ${count1}, result1: ${result1}`); // count1: 11, result1: 11

// 後置インクリメント
let count2 = 10;
let result2 = count2++;
console.log(`count2: ${count2}, result2: ${result2}`); // count2: 11, result2: 10

// 前置デクリメント
let count3 = 10;
let result3 = --count3;
console.log(`count3: ${count3}, result3: ${result3}`); // count3: 9, result3: 9

// 後置デクリメント
let count4 = 10;
let result4 = count4--;
console.log(`count4: ${count4}, result4: ${result4}`); // count4: 9, result4: 10

// 実践例: ループでの使用
console.log("前置インクリメント:");
for (let i = 0; i < 5; ++i) {
    console.log(i); // 0, 1, 2, 3, 4
}

console.log("後置インクリメント:");
for (let i = 0; i < 5; i++) {
    console.log(i); // 0, 1, 2, 3, 4
}

// 実践例: カウンター
let counter = 0;
counter++;  // 1
counter++;  // 2
counter++;  // 3
console.log(`カウンター: ${counter}`); // 3

counter--;  // 2
counter--;  // 1
console.log(`カウンター: ${counter}`); // 1
```

---

## 演算子の優先順位を理解しよう

### 優先順位とは
優先順位は、**演算子が実行される順序**です。数学の計算順序と同じように、TypeScriptにも優先順位があります。

### 主な優先順位（高い順）

1. **括弧（()）**
2. **べき乗（**）**
3. **乗算、除算、剰余（*, /, %）**
4. **加算、減算（+, -）**
5. **比較演算子（<, >, <=, >=）**
6. **等価演算子（==, ===, !=, !==）**
7. **論理AND（&&）**
8. **論理OR（||）**

### 優先順位の例

```typescript
// 括弧が最優先
let result1 = (10 + 5) * 2;  // 30（括弧内が先に計算される）
let result2 = 10 + 5 * 2;    // 20（乗算が先に計算される）

// べき乗が優先
let result3 = 2 ** 3 + 1;     // 9（2の3乗が先に計算される）

// 乗算・除算が加算・減算より優先
let result4 = 10 + 5 * 2;     // 20
let result5 = 10 - 5 / 2;     // 7.5

// 論理演算子の優先順位
let result6 = true || false && false;  // true（&&が先に評価される）
```

### 実践例: 演算子の優先順位

```typescript
// src/operator-precedence.ts
// 括弧の優先順位
let result1 = (10 + 5) * 2;
console.log(`(10 + 5) * 2 = ${result1}`); // 30

let result2 = 10 + 5 * 2;
console.log(`10 + 5 * 2 = ${result2}`); // 20

// べき乗の優先順位
let result3 = 2 ** 3 + 1;
console.log(`2 ** 3 + 1 = ${result3}`); // 9

let result4 = 2 ** (3 + 1);
console.log(`2 ** (3 + 1) = ${result4}`); // 16

// 乗算・除算の優先順位
let result5 = 10 + 5 * 2 - 3;
console.log(`10 + 5 * 2 - 3 = ${result5}`); // 17

let result6 = (10 + 5) * (2 - 3);
console.log(`(10 + 5) * (2 - 3) = ${result6}`); // -15

// 論理演算子の優先順位
let result7 = true || false && false;
console.log(`true || false && false = ${result7}`); // true

let result8 = (true || false) && false;
console.log(`(true || false) && false = ${result8}`); // false

// 実践例: 計算式
function calculateTotal(price: number, quantity: number, discount: number): number {
    // 括弧を使って意図を明確にする
    return (price * quantity) * (1 - discount);
}

const total = calculateTotal(100, 3, 0.1); // 100 * 3 * 0.9 = 270
console.log(`合計: ${total}円`);

// 実践例: 条件式
let age = 20;
let hasLicense = true;
let hasInsurance = false;

// 優先順位を理解して括弧を使う
let canDrive = (age >= 18) && (hasLicense || hasInsurance);
console.log(`運転可能: ${canDrive}`); // true
```

---

## NaN / Infinity

### NaNとは
NaN（Not a Number）は、**数値でないことを表す特殊な値**です。計算結果が数値でない場合に返されます。

### Infinityとは
Infinityは、**無限大を表す特殊な値**です。数値を0で割った場合などに返されます。

### NaNの例

```typescript
// 数値に変換できない文字列を数値演算
let result1 = Number("abc") + 10;
console.log(result1); // NaN

// 0を0で割る
let result2 = 0 / 0;
console.log(result2); // NaN

// NaNとの演算
let result3 = NaN + 10;
console.log(result3); // NaN
```

### Infinityの例

```typescript
// 正の数を0で割る
let result1 = 10 / 0;
console.log(result1); // Infinity

// 負の数を0で割る
let result2 = -10 / 0;
console.log(result2); // -Infinity

// Infinityとの演算
let result3 = Infinity + 10;
console.log(result3); // Infinity
```

### NaNとInfinityの判定

#### isNaN()
```typescript
let value = NaN;
console.log(isNaN(value)); // true

let value2 = 10;
console.log(isNaN(value2)); // false
```

#### isFinite()
```typescript
let value1 = Infinity;
console.log(isFinite(value1)); // false

let value2 = 10;
console.log(isFinite(value2)); // true
```

#### Number.isNaN()
```typescript
let value = NaN;
console.log(Number.isNaN(value)); // true

let value2 = "abc";
console.log(Number.isNaN(value2)); // false（文字列はNaNではない）
```

### 実践例: NaNとInfinity

```typescript
// src/nan-infinity.ts
// NaNの例
let result1 = Number("abc") + 10;
console.log(`Number("abc") + 10 = ${result1}`); // NaN

let result2 = 0 / 0;
console.log(`0 / 0 = ${result2}`); // NaN

let result3 = Math.sqrt(-1);
console.log(`Math.sqrt(-1) = ${result3}`); // NaN

// Infinityの例
let result4 = 10 / 0;
console.log(`10 / 0 = ${result4}`); // Infinity

let result5 = -10 / 0;
console.log(`-10 / 0 = ${result5}`); // -Infinity

let result6 = Infinity + 10;
console.log(`Infinity + 10 = ${result6}`); // Infinity

// NaNとInfinityの判定
console.log(`isNaN(NaN): ${isNaN(NaN)}`); // true
console.log(`isNaN(10): ${isNaN(10)}`); // false
console.log(`isNaN("abc"): ${isNaN("abc")}`); // true（文字列はNaNに変換される）

console.log(`Number.isNaN(NaN): ${Number.isNaN(NaN)}`); // true
console.log(`Number.isNaN("abc"): ${Number.isNaN("abc")}`); // false

console.log(`isFinite(Infinity): ${isFinite(Infinity)}`); // false
console.log(`isFinite(10): ${isFinite(10)}`); // true
console.log(`isFinite(NaN): ${isFinite(NaN)}`); // false

// 実践例: 安全な数値計算
function safeDivide(a: number, b: number): number {
    if (b === 0) {
        return Infinity; // またはエラーを投げる
    }
    return a / b;
}

let result7 = safeDivide(10, 0);
console.log(`safeDivide(10, 0) = ${result7}`); // Infinity

let result8 = safeDivide(10, 2);
console.log(`safeDivide(10, 2) = ${result8}`); // 5

// 実践例: 数値の検証
function isValidNumber(value: number): boolean {
    return !isNaN(value) && isFinite(value);
}

console.log(`isValidNumber(10): ${isValidNumber(10)}`); // true
console.log(`isValidNumber(NaN): ${isValidNumber(NaN)}`); // false
console.log(`isValidNumber(Infinity): ${isValidNumber(Infinity)}`); // false
```

---

## まとめ

この章では、TypeScriptの演算子について学びました。

### 学んだこと
- 基本的な演算子（算術、比較、論理）
- 複合代入演算子（+=, -=, *=, /=, %=）
- インクリメントとデクリメント（++, --）
- 演算子の優先順位
- NaNとInfinity

### 重要なポイント
1. **算術演算子**: 加算、減算、乗算、除算、剰余、べき乗
2. **比較演算子**: 等価、不等価、大小比較
3. **論理演算子**: AND、OR、NOT
4. **複合代入**: 計算と代入を同時に行う
5. **優先順位**: 括弧を使って意図を明確にする

### 次のステップ
次の章では、制御構文（条件分岐とループ）について詳しく学びます。

---

## 演習問題

### 問題1: 基本的な演算子
2つの数値（10と5）に対して、加算、減算、乗算、除算、剰余の結果を表示してください。

<details>
<summary>解答例</summary>

```typescript
let a = 10;
let b = 5;

console.log(`加算: ${a + b}`);      // 15
console.log(`減算: ${a - b}`);      // 5
console.log(`乗算: ${a * b}`);      // 50
console.log(`除算: ${a / b}`);      // 2
console.log(`剰余: ${a % b}`);      // 0
```
</details>

### 問題2: 複合代入演算子
変数`total`を0で初期化し、複合代入演算子を使って10、20、30を順番に加算してください。

<details>
<summary>解答例</summary>

```typescript
let total = 0;
total += 10;
total += 20;
total += 30;
console.log(`合計: ${total}`); // 60
```
</details>

### 問題3: インクリメントとデクリメント
変数`count`を10で初期化し、インクリメントとデクリメントを使って値を変更してください。

<details>
<summary>解答例</summary>

```typescript
let count = 10;
count++;  // 11
count++;  // 12
count--;  // 11
console.log(`カウンター: ${count}`); // 11
```
</details>

### 問題4: 演算子の優先順位
括弧を使って、`(10 + 5) * 2`の計算結果を表示してください。

<details>
<summary>解答例</summary>

```typescript
let result = (10 + 5) * 2;
console.log(`(10 + 5) * 2 = ${result}`); // 30
```
</details>

### 問題5: NaNとInfinity
`Number.isNaN()`と`isFinite()`を使って、NaNとInfinityを判定してください。

<details>
<summary>解答例</summary>

```typescript
let nanValue = NaN;
let infinityValue = Infinity;
let normalValue = 10;

console.log(`NaN判定: ${Number.isNaN(nanValue)}`); // true
console.log(`Infinity判定: ${!isFinite(infinityValue)}`); // true
console.log(`通常の数値判定: ${isFinite(normalValue)}`); // true
```
</details>

---

お疲れ様でした！次の章に進みましょう。

