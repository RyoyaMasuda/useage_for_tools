# 1. 環境構築とコンパイル設定

この章では、TypeScriptを学習するための環境構築とコンパイル設定について学びます。環境を正しく構築することで、効率的にTypeScriptを学習できるようになります。

---

## 目次

- [TypeScriptとは](#typescriptとは)
- [nvmとNode.jsについて / インストールとバージョンについて](#nvmとnodejsについて--インストールとバージョンについて)
- [npmの基礎知識](#npmの基礎知識)
- [VSCode の基本設定](#vscode-の基本設定)
- [TypeScript のプロジェクト準備とインストール](#typescript-のプロジェクト準備とインストール)
- [学習用プロジェクト構成の設定](#学習用プロジェクト構成の設定)
- [はじめてのTypeScriptプログラムを実行しよう（Playground / VSC）](#はじめてのtypescriptプログラムを実行しようplayground--vsc)
- [コンパイル設定の詳細](#コンパイル設定の詳細)
- [コンパイルを自動で実行しよう（watchモード）](#コンパイルを自動で実行しようwatchモード)
- [コンパイルとページリロードを自動で実行しよう](#コンパイルとページリロードを自動で実行しよう)
- [ソースコードの保存場所と出力先を設定しよう](#ソースコードの保存場所と出力先を設定しよう)
- [Source Mapを使おう](#source-mapを使おう)
- [TypeScriptコンパイラ（tsc）](#typescriptコンパイラtsc)
- [トラブルシューティング（学習環境準備）](#トラブルシューティング学習環境準備)
- [まとめ](#まとめ)
- [演習問題](#演習問題)

---

## TypeScriptとは

### TypeScriptの概念
TypeScriptは、**Microsoftが開発したJavaScriptに型システムを追加したプログラミング言語**です。

### TypeScriptの特徴
1. **型安全性**: コンパイル時にエラーを検出できる
2. **JavaScriptの上位互換**: JavaScriptのコードはそのまま使える
3. **コンパイル**: TypeScriptコードはJavaScriptにコンパイルされる
4. **大規模開発に適している**: 型があることで、大規模なプロジェクトでも管理しやすい

### TypeScriptとJavaScriptの関係

```
TypeScript (.ts)
    ↓ コンパイル
JavaScript (.js)
    ↓ 実行
ブラウザ/Node.js
```

### 実践例: TypeScriptとは

```typescript
// TypeScriptの例
function greet(name: string): string {
    return `こんにちは、${name}さん`;
}

const message = greet('太郎');
console.log(message); // 'こんにちは、太郎さん'

// 型エラーが発生する例（コンパイル時に検出）
// const error = greet(123); // エラー: 数値は文字列ではない
```

### TypeScriptのメリット
- **エラーの早期発見**: コンパイル時に型エラーを検出
- **コード補完**: エディタが型情報を元に補完を提供
- **リファクタリング**: 型情報があるため、安全にコードを変更できる
- **ドキュメント**: 型がそのままドキュメントになる

---

## nvmとNode.jsについて / インストールとバージョンについて

### Node.jsとは
Node.jsは、**JavaScriptをサーバーサイドで実行できる環境**です。TypeScriptのコンパイルにも必要です。

### nvmとは
nvm（Node Version Manager）は、**Node.jsのバージョンを管理するツール**です。複数のバージョンを切り替えて使えます。

### nvmのインストール（Linux/Mac）

```bash
# nvmのインストール
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# ターミナルを再起動後、バージョンを確認
nvm --version
```

### Node.jsのインストール

```bash
# 最新のLTS版をインストール
nvm install --lts

# インストールしたバージョンを使用
nvm use --lts

# インストール済みのバージョンを確認
nvm list

# 現在のNode.jsバージョンを確認
node --version
```

### 実践例: Node.jsのバージョン管理

```bash
# 特定のバージョンをインストール
nvm install 18.17.0

# 特定のバージョンを使用
nvm use 18.17.0

# デフォルトのバージョンを設定
nvm alias default 18.17.0
```

### 注意点
- **LTS版を推奨**: 長期サポート版（LTS）を使用することを推奨
- **バージョン管理**: プロジェクトごとに異なるバージョンを使う場合、nvmが便利

---

## npmの基礎知識

### npmとは
npm（Node Package Manager）は、**Node.jsのパッケージ管理ツール**です。TypeScriptやその他のライブラリをインストールするのに使います。

### npmの基本コマンド

#### パッケージのインストール
```bash
# プロジェクトにパッケージをインストール
npm install パッケージ名

# 短縮形
npm i パッケージ名

# 開発用依存関係としてインストール
npm install --save-dev パッケージ名
npm i -D パッケージ名
```

#### package.jsonの作成
```bash
# package.jsonを作成
npm init

# 質問に答えずに作成（デフォルト値を使用）
npm init -y
```

#### パッケージの確認
```bash
# インストール済みのパッケージを確認
npm list

# グローバルにインストールされたパッケージを確認
npm list -g
```

### package.jsonとは
`package.json`は、**プロジェクトの設定ファイル**です。依存関係やスクリプトを管理します。

```json
{
  "name": "my-typescript-project",
  "version": "1.0.0",
  "scripts": {
    "build": "tsc",
    "watch": "tsc --watch"
  },
  "devDependencies": {
    "typescript": "^5.0.0"
  }
}
```

### 実践例: npmの使い方

```bash
# 1. プロジェクトディレクトリを作成
mkdir my-typescript-project
cd my-typescript-project

# 2. package.jsonを作成
npm init -y

# 3. TypeScriptを開発用依存関係としてインストール
npm install --save-dev typescript

# 4. インストールを確認
npm list
```

---

## VSCode の基本設定

### VSCodeとは
VSCode（Visual Studio Code）は、**Microsoftが開発した無料のコードエディタ**です。TypeScript開発に適しています。

### VSCodeのインストール
1. [VSCode公式サイト](https://code.visualstudio.com/)からダウンロード
2. インストーラーを実行
3. インストール完了

### 推奨拡張機能

#### TypeScript関連
- **TypeScript and JavaScript Language Features**: 標準で含まれている
- **ESLint**: コードの品質チェック
- **Prettier**: コードフォーマッター

#### その他
- **Japanese Language Pack**: 日本語化
- **GitLens**: Git機能の強化

### VSCodeの基本設定

#### settings.jsonの編集
```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "typescript.tsdk": "node_modules/typescript/lib",
  "typescript.enablePromptUseWorkspaceTsdk": true
}
```

### 実践例: VSCodeの設定

1. **設定を開く**: `Ctrl + ,`（Windows/Linux）または `Cmd + ,`（Mac）
2. **settings.jsonを編集**: `Ctrl + Shift + P` → "Preferences: Open User Settings (JSON)"
3. **推奨設定を追加**: 上記の設定を追加

---

## TypeScript のプロジェクト準備とインストール

### プロジェクトの準備手順

#### 1. プロジェクトディレクトリの作成
```bash
mkdir my-typescript-project
cd my-typescript-project
```

#### 2. package.jsonの作成
```bash
npm init -y
```

#### 3. TypeScriptのインストール
```bash
npm install --save-dev typescript
```

#### 4. tsconfig.jsonの作成
```bash
npx tsc --init
```

### tsconfig.jsonとは
`tsconfig.json`は、**TypeScriptのコンパイル設定ファイル**です。

### 基本的なtsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules"]
}
```

### 実践例: プロジェクトの準備

```bash
# 1. プロジェクトディレクトリを作成
mkdir typescript-learning
cd typescript-learning

# 2. package.jsonを作成
npm init -y

# 3. TypeScriptをインストール
npm install --save-dev typescript

# 4. tsconfig.jsonを作成
npx tsc --init

# 5. ディレクトリ構造を作成
mkdir src
mkdir dist

# 6. 最初のTypeScriptファイルを作成
echo 'console.log("Hello, TypeScript!");' > src/index.ts
```

---

## 学習用プロジェクト構成の設定

### 推奨ディレクトリ構造

```
my-typescript-project/
├── src/              # TypeScriptのソースコード
│   └── index.ts
├── dist/             # コンパイル後のJavaScript
│   └── index.js
├── node_modules/     # インストールされたパッケージ
├── package.json      # プロジェクトの設定
└── tsconfig.json     # TypeScriptの設定
```

### package.jsonの設定例

```json
{
  "name": "typescript-learning",
  "version": "1.0.0",
  "scripts": {
    "build": "tsc",
    "watch": "tsc --watch",
    "start": "node dist/index.js"
  },
  "devDependencies": {
    "typescript": "^5.0.0"
  }
}
```

### 実践例: プロジェクト構成の設定

```bash
# ディレクトリ構造を作成
mkdir -p src dist

# package.jsonにスクリプトを追加（手動で編集）
# "scripts": {
#   "build": "tsc",
#   "watch": "tsc --watch",
#   "start": "node dist/index.js"
# }

# 最初のTypeScriptファイルを作成
cat > src/index.ts << 'EOF'
function greet(name: string): string {
    return `こんにちは、${name}さん`;
}

console.log(greet('TypeScript'));
EOF

# コンパイル
npm run build

# 実行
npm start
```

---

## はじめてのTypeScriptプログラムを実行しよう（Playground / VSC）

### TypeScript Playgroundとは
TypeScript Playgroundは、**ブラウザでTypeScriptを試せる環境**です。インストール不要で使えます。

### Playgroundの使い方
1. [TypeScript Playground](https://www.typescriptlang.org/play)にアクセス
2. コードを入力
3. 右側にコンパイル結果が表示される

### 実践例: Playgroundで試す

```typescript
// TypeScript Playgroundで試すコード
function add(a: number, b: number): number {
    return a + b;
}

const result = add(10, 20);
console.log(result); // 30

// 型エラーの例（右側にエラーが表示される）
// const error = add("10", "20"); // エラー
```

### VSCodeで実行する

#### 1. ファイルを作成
`src/index.ts`を作成

```typescript
function greet(name: string): string {
    return `こんにちは、${name}さん`;
}

const message = greet('TypeScript');
console.log(message);
```

#### 2. コンパイル
```bash
npm run build
```

#### 3. 実行
```bash
npm start
```

### 実践例: VSCodeでの実行

```bash
# 1. プロジェクトを準備（既に作成済みの場合）
cd my-typescript-project

# 2. src/index.tsを作成（VSCodeで編集）
# 上記のコードを入力

# 3. コンパイル
npm run build

# 4. 実行
npm start
# 出力: こんにちは、TypeScriptさん
```

---

## コンパイル設定の詳細

### tsconfig.jsonの主要な設定項目

#### target
コンパイル後のJavaScriptのバージョンを指定

```json
{
  "compilerOptions": {
    "target": "ES2020"  // ES5, ES2015, ES2020など
  }
}
```

#### module
モジュールシステムを指定

```json
{
  "compilerOptions": {
    "module": "commonjs"  // commonjs, ES2015, ES2020など
  }
}
```

#### outDir
コンパイル後のファイルの出力先

```json
{
  "compilerOptions": {
    "outDir": "./dist"
  }
}
```

#### rootDir
ソースコードのルートディレクトリ

```json
{
  "compilerOptions": {
    "rootDir": "./src"
  }
}
```

#### strict
厳格な型チェックを有効化

```json
{
  "compilerOptions": {
    "strict": true
  }
}
```

### 実践例: コンパイル設定

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

---

## コンパイルを自動で実行しよう（watchモード）

### watchモードとは
watchモードは、**ファイルの変更を監視し、自動的にコンパイルする機能**です。

### watchモードの使い方

#### コマンドラインで実行
```bash
tsc --watch
```

#### package.jsonのスクリプトで実行
```json
{
  "scripts": {
    "watch": "tsc --watch"
  }
}
```

```bash
npm run watch
```

### 実践例: watchモードの使用

```bash
# 1. watchモードを開始
npm run watch

# 2. src/index.tsを編集して保存
# 自動的にコンパイルが実行される

# 3. 停止する場合は Ctrl + C
```

### watchモードのメリット
- **自動コンパイル**: ファイルを保存するたびに自動的にコンパイル
- **開発効率向上**: 手動でコンパイルする必要がない
- **リアルタイム**: 変更がすぐに反映される

---

## コンパイルとページリロードを自動で実行しよう

### 開発サーバーの設定

#### 必要なパッケージのインストール
```bash
npm install --save-dev concurrently nodemon
```

#### package.jsonの設定
```json
{
  "scripts": {
    "build": "tsc",
    "watch": "tsc --watch",
    "start": "node dist/index.js",
    "dev": "concurrently \"tsc --watch\" \"nodemon dist/index.js\""
  }
}
```

### 実践例: 自動リロードの設定

```bash
# 1. 必要なパッケージをインストール
npm install --save-dev concurrently nodemon

# 2. package.jsonを編集（上記の設定を追加）

# 3. nodemon.jsonを作成（オプション）
cat > nodemon.json << 'EOF'
{
  "watch": ["dist"],
  "ext": "js",
  "ignore": ["node_modules"],
  "exec": "node dist/index.js"
}
EOF

# 4. 開発モードで実行
npm run dev
```

### ブラウザでの自動リロード（HTMLの場合）

#### Live Server拡張機能を使用
1. VSCodeで「Live Server」拡張機能をインストール
2. HTMLファイルを右クリック → "Open with Live Server"

---

## ソースコードの保存場所と出力先を設定しよう

### ディレクトリ構造の設定

#### 推奨構造
```
project/
├── src/          # ソースコード（TypeScript）
│   ├── index.ts
│   └── utils.ts
├── dist/         # 出力先（JavaScript）
│   ├── index.js
│   └── utils.js
└── tsconfig.json
```

### tsconfig.jsonの設定

```json
{
  "compilerOptions": {
    "outDir": "./dist",      // 出力先
    "rootDir": "./src"        // ソースコードのルート
  },
  "include": ["src/**/*"],   // コンパイル対象
  "exclude": ["node_modules", "dist"]  // 除外
}
```

### 実践例: ディレクトリ設定

```bash
# 1. ディレクトリ構造を作成
mkdir -p src dist

# 2. tsconfig.jsonを設定
# {
#   "compilerOptions": {
#     "outDir": "./dist",
#     "rootDir": "./src"
#   },
#   "include": ["src/**/*"],
#   "exclude": ["node_modules", "dist"]
# }

# 3. ソースコードを作成
echo 'export const message = "Hello, TypeScript!";' > src/index.ts

# 4. コンパイル
npm run build

# 5. 出力を確認
ls dist/
# index.js が生成される
```

---

## Source Mapを使おう

### Source Mapとは
Source Mapは、**コンパイル後のJavaScriptと元のTypeScriptを対応付けるファイル**です。デバッグ時に便利です。

### Source Mapの有効化

#### tsconfig.jsonの設定
```json
{
  "compilerOptions": {
    "sourceMap": true
  }
}
```

### Source Mapのメリット
- **デバッグ**: ブラウザの開発者ツールでTypeScriptコードを直接見られる
- **エラー追跡**: エラーが発生した場所を正確に特定できる
- **開発効率**: デバッグが容易になる

### 実践例: Source Mapの使用

```json
{
  "compilerOptions": {
    "sourceMap": true,
    "outDir": "./dist",
    "rootDir": "./src"
  }
}
```

```bash
# 1. tsconfig.jsonでsourceMapを有効化

# 2. コンパイル
npm run build

# 3. 出力を確認
ls dist/
# index.js と index.js.map が生成される
```

### ブラウザでの確認
1. ブラウザの開発者ツールを開く
2. SourcesタブでTypeScriptファイル（.ts）が表示される
3. ブレークポイントを設定してデバッグ可能

---

## TypeScriptコンパイラ（tsc）

### tscとは
tsc（TypeScript Compiler）は、**TypeScriptをJavaScriptにコンパイルするツール**です。

### tscの基本的な使い方

#### 単一ファイルのコンパイル
```bash
tsc index.ts
```

#### プロジェクト全体のコンパイル
```bash
tsc
```

#### tsconfig.jsonを使用してコンパイル
```bash
tsc
# tsconfig.jsonの設定が適用される
```

### tscの主要なオプション

```bash
# watchモード
tsc --watch

# 特定のファイルをコンパイル
tsc src/index.ts

# 出力先を指定
tsc --outDir dist

# 厳格モードを有効化
tsc --strict
```

### 実践例: tscの使用

```bash
# 1. グローバルにTypeScriptをインストール（オプション）
npm install -g typescript

# 2. バージョンを確認
tsc --version

# 3. プロジェクトをコンパイル
tsc

# 4. watchモードでコンパイル
tsc --watch

# 5. ヘルプを表示
tsc --help
```

---

## トラブルシューティング（学習環境準備）

### よくある問題と解決方法

#### 問題1: tscコマンドが見つからない
```bash
# 解決方法: TypeScriptをインストール
npm install --save-dev typescript

# または、npxを使用
npx tsc --version
```

#### 問題2: コンパイルエラーが発生する
```bash
# 解決方法: エラーメッセージを確認
tsc

# エラーの詳細を確認
# 型エラーの場合は、型注釈を追加
```

#### 問題3: node_modulesが見つからない
```bash
# 解決方法: パッケージを再インストール
rm -rf node_modules package-lock.json
npm install
```

#### 問題4: バージョンの不一致
```bash
# 解決方法: バージョンを確認
node --version
npm --version
tsc --version

# 必要に応じて更新
nvm install --lts
nvm use --lts
```

#### 問題5: パスの問題
```bash
# 解決方法: 絶対パスを使用
# または、tsconfig.jsonでパスを設定
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  }
}
```

### 実践例: トラブルシューティング

```bash
# 1. 環境を確認
node --version
npm --version

# 2. プロジェクトを再構築
rm -rf node_modules dist
npm install
npm run build

# 3. エラーを確認
npm run build 2>&1 | tee build.log

# 4. VSCodeを再起動
# 5. TypeScriptのバージョンを確認
npx tsc --version
```

---

## まとめ

この章では、TypeScriptの環境構築とコンパイル設定について学びました。

### 学んだこと
- TypeScriptの概念と特徴
- Node.jsとnvmのインストール
- npmの基礎知識
- VSCodeの基本設定
- TypeScriptプロジェクトの準備
- コンパイル設定の詳細
- watchモードと自動リロード
- Source Mapの使用
- トラブルシューティング

### 重要なポイント
1. **TypeScript**: JavaScriptに型システムを追加した言語
2. **Node.js**: TypeScriptのコンパイルに必要
3. **npm**: パッケージ管理ツール
4. **tsconfig.json**: TypeScriptの設定ファイル
5. **watchモード**: 自動コンパイル機能

### 次のステップ
次の章では、TypeScriptの文法・変数の基礎について詳しく学びます。

---

## 演習問題

### 問題1: TypeScriptプロジェクトの作成
新しいTypeScriptプロジェクトを作成し、`src/index.ts`に「Hello, TypeScript!」を出力するコードを書いてください。

<details>
<summary>解答例</summary>

```bash
# 1. プロジェクトディレクトリを作成
mkdir my-project
cd my-project

# 2. package.jsonを作成
npm init -y

# 3. TypeScriptをインストール
npm install --save-dev typescript

# 4. tsconfig.jsonを作成
npx tsc --init

# 5. src/index.tsを作成
echo 'console.log("Hello, TypeScript!");' > src/index.ts

# 6. コンパイル
npm run build

# 7. 実行
node dist/index.js
```
</details>

### 問題2: watchモードの設定
package.jsonにwatchモードのスクリプトを追加してください。

<details>
<summary>解答例</summary>

```json
{
  "scripts": {
    "build": "tsc",
    "watch": "tsc --watch"
  }
}
```

```bash
npm run watch
```
</details>

### 問題3: tsconfig.jsonの設定
tsconfig.jsonで、出力先を`dist`、ソースコードのルートを`src`に設定してください。

<details>
<summary>解答例</summary>

```json
{
  "compilerOptions": {
    "outDir": "./dist",
    "rootDir": "./src"
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```
</details>

### 問題4: Source Mapの有効化
tsconfig.jsonでSource Mapを有効化してください。

<details>
<summary>解答例</summary>

```json
{
  "compilerOptions": {
    "sourceMap": true
  }
}
```
</details>

### 問題5: エラーの確認
意図的に型エラーを含むコードを書き、コンパイル時にエラーが表示されることを確認してください。

<details>
<summary>解答例</summary>

```typescript
// src/index.ts
function greet(name: string): string {
    return `こんにちは、${name}さん`;
}

// 型エラーが発生する
const message = greet(123); // エラー: 数値は文字列ではない
```

```bash
npm run build
# エラーが表示される
```
</details>

---

お疲れ様でした！次の章に進みましょう。



