# 3. 型システムの基礎

この章では、TypeScriptの最も重要な特徴である「型システム」について学びます。型を理解することで、より安全で保守しやすいコードを書けるようになります。

---

## 目次

- [データ型について知ろう（プリミティブ型）](#データ型について知ろうプリミティブ型)
- [変数の型注釈（Type Annotation）の基本](#変数の型注釈type-annotationの基本)
- [型推論（Type Inference）の仕組み](#型推論type-inferenceの仕組み)
- [型推論と明示的型注釈の使い分け](#型推論と明示的型注釈の使い分け)
- [JavaScriptの「型の自由さ」とTypeScriptが解決する問題](#javascriptの型の自由さとtypescriptが解決する問題)
- [TypeScriptエラーメッセージの価値](#typescriptエラーメッセージの価値)
- [nullとundefinedを理解しよう](#nullとundefinedを理解しよう)
- [any型](#any型)
- [unknown型：anyより安全な選択肢](#unknown型anyより安全な選択肢)
- [まとめ](#まとめ)
- [演習問題](#演習問題)

---

## データ型について知ろう（プリミティブ型）

### プリミティブ型とは
プリミティブ型は、**基本的なデータ型**です。TypeScriptでは以下の型が用意されています。

### 主なプリミティブ型

#### 1. string（文字列型）
```typescript
let name: string = "太郎";
let message: string = 'こんにちは';
let template: string = `Hello, ${name}`;
```

#### 2. number（数値型）
```typescript
let age: number = 25;
let price: number = 99.99;
let count: number = -10;
let largeNumber: number = 1e6; // 1000000
```

#### 3. boolean（真偽値型）
```typescript
let isActive: boolean = true;
let isDisabled: boolean = false;
```

#### 4. null（null型）
```typescript
let value: null = null;
```

#### 5. undefined（undefined型）
```typescript
let value: undefined = undefined;
```

### 実践例: プリミティブ型

```typescript
// src/primitive-types.ts
// string型
let userName: string = "太郎";
let greeting: string = `こんにちは、${userName}さん`;
console.log(greeting);

// number型
let age: number = 25;
let height: number = 175.5;
let score: number = 100;
let temperature: number = -10;
console.log(`年齢: ${age}, 身長: ${height}cm, スコア: ${score}, 気温: ${temperature}℃`);

// boolean型
let isStudent: boolean = true;
let isWorking: boolean = false;
console.log(`学生: ${isStudent}, 働いている: ${isWorking}`);

// null型
let emptyValue: null = null;
console.log(emptyValue); // null

// undefined型
let notDefined: undefined = undefined;
console.log(notDefined); // undefined

// 実践例: ユーザー情報
let userId: number = 1;
let userName2: string = "花子";
let isVerified: boolean = true;
let email: string | null = null; // 後で学ぶUnion型

console.log(`ユーザーID: ${userId}`);
console.log(`ユーザー名: ${userName2}`);
console.log(`認証済み: ${isVerified}`);
console.log(`メール: ${email}`);
```

---

## 変数の型注釈（Type Annotation）の基本

### 型注釈とは
型注釈は、**変数や関数に型を明示的に指定する**ことです。`:`（コロン）を使って記述します。

### 基本的な型注釈

```typescript
// 変数の型注釈
let name: string = "太郎";
let age: number = 25;
let isActive: boolean = true;

// 関数の型注釈
function greet(name: string): string {
    return `こんにちは、${name}さん`;
}

// 引数と戻り値の型注釈
function add(a: number, b: number): number {
    return a + b;
}
```

### 型注釈の構文

```typescript
// 変数名: 型 = 値
let variableName: type = value;

// 関数名(引数名: 引数の型): 戻り値の型
function functionName(param: type): returnType {
    // 処理
}
```

### 実践例: 型注釈

```typescript
// src/type-annotation.ts
// 変数の型注釈
let userName: string = "太郎";
let userAge: number = 25;
let isLoggedIn: boolean = true;
let score: number = 100.5;

// 関数の型注釈
function calculateTotal(price: number, quantity: number): number {
    return price * quantity;
}

const total = calculateTotal(100, 3);
console.log(`合計: ${total}円`);

// 複数の引数を持つ関数
function createUser(name: string, age: number, isActive: boolean): string {
    return `${name} (${age}歳) - ${isActive ? 'アクティブ' : '非アクティブ'}`;
}

const userInfo = createUser("花子", 30, true);
console.log(userInfo);

// 戻り値がない関数（void型）
function logMessage(message: string): void {
    console.log(message);
}

logMessage("ログメッセージです");
```

---

## 型推論（Type Inference）の仕組み

### 型推論とは
型推論は、**TypeScriptが自動的に型を推測する機能**です。型注釈を省略しても、初期値から型が推論されます。

### 型推論の例

```typescript
// 型注釈なし（型推論）
let name = "太郎";        // string型と推論される
let age = 25;            // number型と推論される
let isActive = true;     // boolean型と推論される

// 型注釈あり（明示的）
let name2: string = "太郎";
let age2: number = 25;
let isActive2: boolean = true;
```

### 型推論の動作

```typescript
// 初期値から型が推論される
let message = "Hello";    // string型
let count = 10;          // number型
let flag = true;         // boolean型

// 型が推論された後は、異なる型を代入できない
// message = 123;        // エラー: string型にnumber型は代入できない
// count = "10";         // エラー: number型にstring型は代入できない
```

### 実践例: 型推論

```typescript
// src/type-inference.ts
// 型推論の例
let userName = "太郎";        // string型と推論
let userAge = 25;            // number型と推論
let isStudent = true;        // boolean型と推論

console.log(typeof userName);  // "string"
console.log(typeof userAge);   // "number"
console.log(typeof isStudent); // "boolean"

// 関数の戻り値の型推論
function multiply(a: number, b: number) {
    return a * b;  // number型と推論される
}

const result = multiply(10, 5);
console.log(result); // 50

// 配列の型推論
let numbers = [1, 2, 3];  // number[]型と推論される
let names = ["太郎", "花子"];  // string[]型と推論される

// オブジェクトの型推論
let user = {
    name: "太郎",
    age: 25
};  // { name: string, age: number }型と推論される

console.log(user.name); // "太郎"
console.log(user.age);  // 25
```

---

## 型推論と明示的型注釈の使い分け

### 使い分けの指針

#### 型推論を使う場合（推奨）
- **初期値がある場合**: 型が明確に推論できる
- **シンプルな変数**: 型が自明な場合

```typescript
// 型推論を使う（推奨）
let name = "太郎";        // string型は明らか
let age = 25;            // number型は明らか
let isActive = true;     // boolean型は明らか
```

#### 明示的型注釈を使う場合
- **初期値がない場合**: 後で値を代入する
- **複雑な型**: 型が推論しにくい場合
- **意図を明確にしたい場合**: コードの可読性を上げる

```typescript
// 明示的型注釈を使う
let userName: string;     // 後で代入する
let userAge: number;      // 後で代入する

userName = "太郎";
userAge = 25;

// 関数の戻り値（明示的に書くことが多い）
function calculateTotal(price: number, quantity: number): number {
    return price * quantity;
}
```

### 実践例: 使い分け

```typescript
// src/type-usage.ts
// 型推論を使う（推奨）
let message = "Hello, TypeScript!";  // string型と推論
let count = 10;                      // number型と推論
let isActive = true;                 // boolean型と推論

// 明示的型注釈を使う
let userName: string;  // 後で代入するため、型を明示
let userAge: number;   // 後で代入するため、型を明示

userName = "太郎";
userAge = 25;

// 関数の戻り値は明示的に書くことが多い
function greet(name: string): string {
    return `こんにちは、${name}さん`;
}

// 複雑な型は明示的に書く
let user: {
    name: string;
    age: number;
    isActive: boolean;
} = {
    name: "花子",
    age: 30,
    isActive: true
};

console.log(user);
```

---

## JavaScriptの「型の自由さ」とTypeScriptが解決する問題

### JavaScriptの問題点

#### 1. 実行時までエラーが分からない
```javascript
// JavaScript（実行時エラー）
function add(a, b) {
    return a + b;
}

add("10", "20");  // "1020"（文字列結合）意図しない結果
add(10, 20);      // 30（正しい結果）
```

#### 2. 型の不一致が検出できない
```javascript
// JavaScript（実行時エラー）
let userName = "太郎";
userName = 123;  // エラーにならない（問題）
```

### TypeScriptが解決する問題

#### 1. コンパイル時にエラーを検出
```typescript
// TypeScript（コンパイル時エラー）
function add(a: number, b: number): number {
    return a + b;
}

add("10", "20");  // エラー: 文字列は数値ではない
add(10, 20);      // OK: 30
```

#### 2. 型の不一致を検出
```typescript
// TypeScript（コンパイル時エラー）
let userName: string = "太郎";
userName = 123;  // エラー: string型にnumber型は代入できない
```

### 実践例: JavaScriptとTypeScriptの比較

```typescript
// src/js-vs-ts.ts
// JavaScriptの問題点を再現
// function add(a, b) {
//     return a + b;
// }
// add("10", "20");  // "1020"（意図しない結果）

// TypeScriptで解決
function add(a: number, b: number): number {
    return a + b;
}

// add("10", "20");  // エラー: コンパイル時に検出
console.log(add(10, 20));  // 30（正しい結果）

// JavaScriptの問題点
// let userName = "太郎";
// userName = 123;  // エラーにならない（問題）

// TypeScriptで解決
let userName: string = "太郎";
// userName = 123;  // エラー: コンパイル時に検出

// 実践例: 型安全性のメリット
function calculateTotal(price: number, quantity: number): number {
    return price * quantity;
}

// calculateTotal("100", "3");  // エラー: コンパイル時に検出
const total = calculateTotal(100, 3);
console.log(`合計: ${total}円`);  // 合計: 300円
```

---

## TypeScriptエラーメッセージの価値

### エラーメッセージの重要性
TypeScriptのエラーメッセージは、**問題を早期に発見し、修正を支援する**重要な情報源です。

### エラーメッセージの例

#### 型エラー
```typescript
let name: string = "太郎";
name = 123;  // エラー: Type 'number' is not assignable to type 'string'
```

#### 引数の型エラー
```typescript
function greet(name: string): string {
    return `こんにちは、${name}さん`;
}

greet(123);  // エラー: Argument of type 'number' is not assignable to parameter of type 'string'
```

### エラーメッセージの読み方

```
エラーの場所: ファイル名:行番号:列番号
エラーの種類: エラーメッセージ
```

### 実践例: エラーメッセージの活用

```typescript
// src/error-messages.ts
// 型エラーの例
let userName: string = "太郎";
// userName = 123;  // エラー: Type 'number' is not assignable to type 'string'

// 引数の型エラーの例
function calculateArea(width: number, height: number): number {
    return width * height;
}

// calculateArea("10", "20");  // エラー: Argument of type 'string' is not assignable to parameter of type 'number'
const area = calculateArea(10, 20);
console.log(`面積: ${area}`);

// 戻り値の型エラーの例
function getMessage(): string {
    // return 123;  // エラー: Type 'number' is not assignable to type 'string'
    return "メッセージ";
}

console.log(getMessage());

// エラーメッセージから学ぶ
// 1. エラーの場所が分かる（ファイル名、行番号）
// 2. エラーの種類が分かる（型エラー、構文エラーなど）
// 3. 修正方法が分かる（期待される型と実際の型）
```

---

## nullとundefinedを理解しよう

### nullとundefinedの違い

#### null
- **意図的に「値がない」ことを表す**
- 明示的に`null`を代入する

#### undefined
- **値が定義されていないことを表す**
- 変数が初期化されていない、またはプロパティが存在しない

### nullとundefinedの使い方

```typescript
// nullの例
let userName: string | null = null;  // 後で値を設定する
userName = "太郎";

// undefinedの例
let userAge: number | undefined;  // 初期化されていない
userAge = 25;
```

### 実践例: nullとundefined

```typescript
// src/null-undefined.ts
// nullの例
let email: string | null = null;  // まだメールアドレスが設定されていない

// 後で値を設定
email = "taro@example.com";
console.log(`メール: ${email}`);

// undefinedの例
let userAge: number | undefined;  // 初期化されていない
console.log(userAge);  // undefined

userAge = 25;
console.log(`年齢: ${userAge}`);

// オプショナルなプロパティ
let user: {
    name: string;
    age: number;
    email?: string;  // オプショナル（undefinedの可能性がある）
} = {
    name: "太郎",
    age: 25
    // emailは省略可能
};

console.log(user.email);  // undefined

// nullチェック
function displayEmail(email: string | null): void {
    if (email === null) {
        console.log("メールアドレスが設定されていません");
    } else {
        console.log(`メール: ${email}`);
    }
}

displayEmail(null);           // メールアドレスが設定されていません
displayEmail("taro@example.com");  // メール: taro@example.com
```

---

## any型

### any型とは
`any`型は、**あらゆる型を受け入れる型**です。型チェックを無効化します。

### any型の使い方

```typescript
let value: any = "Hello";
value = 123;        // OK
value = true;       // OK
value = {};         // OK
```

### any型の問題点

#### 1. 型安全性が失われる
```typescript
let data: any = "Hello";
let length = data.length;  // OK（文字列の場合）
data = 123;
let length2 = data.length;  // 実行時エラー（数値にはlengthプロパティがない）
```

#### 2. エディタの補完が効かない
```typescript
let user: any = {
    name: "太郎",
    age: 25
};

// user. と入力しても、補完が表示されない
```

### any型を使うべきでない場合
- **通常の開発**: 型を明示する方が安全
- **新しいコード**: 適切な型を定義する

### any型を使うべき場合
- **既存のJavaScriptコード**: 段階的に型を追加する過程
- **外部ライブラリ**: 型定義がない場合の一時的な対処

### 実践例: any型

```typescript
// src/any-type.ts
// any型の例（非推奨）
let data: any = "Hello";
console.log(data);

data = 123;
console.log(data);

data = true;
console.log(data);

// any型の問題点
let value: any = "Hello";
let length = value.length;  // OK
console.log(length);  // 5

value = 123;
// let length2 = value.length;  // 実行時エラー（数値にはlengthプロパティがない）

// 型を明示する方が安全（推奨）
let userName: string = "太郎";
let userAge: number = 25;
let isActive: boolean = true;

console.log(`名前: ${userName}, 年齢: ${userAge}, アクティブ: ${isActive}`);
```

---

## unknown型：anyより安全な選択肢

### unknown型とは
`unknown`型は、**型が不明な値を安全に扱うための型**です。`any`より安全です。

### unknown型の特徴
1. **型チェックが必要**: `unknown`型の値は、型を確認してから使う必要がある
2. **型安全性**: 型を確認しないと使えないため、`any`より安全

### unknown型の使い方

```typescript
let value: unknown = "Hello";

// 型を確認してから使用
if (typeof value === "string") {
    console.log(value.toUpperCase());  // OK
}

// 型を確認せずに使用するとエラー
// console.log(value.toUpperCase());  // エラー
```

### anyとunknownの比較

| 項目 | any | unknown |
|------|-----|---------|
| **型チェック** | 不要 | 必要 |
| **安全性** | 低い | 高い |
| **補完** | 効かない | 型確認後は効く |

### 実践例: unknown型

```typescript
// src/unknown-type.ts
// unknown型の例
let userInput: unknown;

userInput = "Hello";
userInput = 123;
userInput = true;

// 型を確認してから使用（安全）
if (typeof userInput === "string") {
    console.log(userInput.toUpperCase());  // OK
}

if (typeof userInput === "number") {
    console.log(userInput.toFixed(2));  // OK
}

// 型ガード関数
function isString(value: unknown): value is string {
    return typeof value === "string";
}

function processValue(value: unknown): void {
    if (isString(value)) {
        console.log(`文字列: ${value.toUpperCase()}`);
    } else if (typeof value === "number") {
        console.log(`数値: ${value.toFixed(2)}`);
    } else {
        console.log(`その他の型: ${typeof value}`);
    }
}

processValue("Hello");     // 文字列: HELLO
processValue(123.456);    // 数値: 123.46
processValue(true);        // その他の型: boolean

// 実践例: APIからのデータ
function handleApiResponse(data: unknown): void {
    if (typeof data === "object" && data !== null) {
        const obj = data as { message?: string };
        if (typeof obj.message === "string") {
            console.log(`メッセージ: ${obj.message}`);
        }
    }
}

handleApiResponse({ message: "成功しました" });
```

---

## まとめ

この章では、TypeScriptの型システムの基礎について学びました。

### 学んだこと
- プリミティブ型（string, number, boolean, null, undefined）
- 型注釈（Type Annotation）
- 型推論（Type Inference）
- 型推論と明示的型注釈の使い分け
- JavaScriptの問題点とTypeScriptの解決策
- TypeScriptエラーメッセージの価値
- nullとundefined
- any型（非推奨）
- unknown型（anyより安全）

### 重要なポイント
1. **型注釈**: 変数や関数に型を明示的に指定
2. **型推論**: TypeScriptが自動的に型を推測
3. **型安全性**: コンパイル時にエラーを検出できる
4. **unknown型**: any型より安全な選択肢

### 次のステップ
次の章では、演算子について詳しく学びます。

---

## 演習問題

### 問題1: 型注釈
変数`name`（文字列型）と`age`（数値型）を型注釈付きで宣言してください。

<details>
<summary>解答例</summary>

```typescript
let name: string = "太郎";
let age: number = 25;

console.log(`名前: ${name}, 年齢: ${age}歳`);
```
</details>

### 問題2: 型推論
型注釈を省略して、型推論で変数を宣言してください。

<details>
<summary>解答例</summary>

```typescript
let name = "太郎";  // string型と推論
let age = 25;       // number型と推論
let isActive = true;  // boolean型と推論

console.log(`名前: ${name}, 年齢: ${age}, アクティブ: ${isActive}`);
```
</details>

### 問題3: 関数の型注釈
2つの数値を足し算する関数に、引数と戻り値の型注釈を追加してください。

<details>
<summary>解答例</summary>

```typescript
function add(a: number, b: number): number {
    return a + b;
}

const result = add(10, 20);
console.log(result); // 30
```
</details>

### 問題4: nullとundefined
`email`変数を`string | null`型で宣言し、初期値を`null`に設定してください。

<details>
<summary>解答例</summary>

```typescript
let email: string | null = null;

// 後で値を設定
email = "taro@example.com";
console.log(`メール: ${email}`);
```
</details>

### 問題5: unknown型
`unknown`型の変数を受け取り、型を確認してから処理する関数を作成してください。

<details>
<summary>解答例</summary>

```typescript
function processValue(value: unknown): void {
    if (typeof value === "string") {
        console.log(`文字列: ${value.toUpperCase()}`);
    } else if (typeof value === "number") {
        console.log(`数値: ${value.toFixed(2)}`);
    } else {
        console.log(`その他の型: ${typeof value}`);
    }
}

processValue("Hello");  // 文字列: HELLO
processValue(123.456);  // 数値: 123.46
processValue(true);     // その他の型: boolean
```
</details>

---

お疲れ様でした！次の章に進みましょう。



