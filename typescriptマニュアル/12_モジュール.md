# 12. モジュール

この章では、コードを複数のファイルに分割して管理する「モジュール」について学びます。モジュールを理解することで、大規模なプログラムを効率的に開発できるようになります。

---

## 目次

- [モジュールの基本的な使い方](#モジュールの基本的な使い方)
- [import宣言とexport宣言を利用しよう](#import宣言とexport宣言を利用しよう)
- [関数・クラスをexportしよう](#関数クラスをexportしよう)
- [まとめ](#まとめ)
- [演習問題](#演習問題)

---

## モジュールの基本的な使い方

### モジュールとは
モジュールは、**コードを複数のファイルに分割して管理する**仕組みです。

### 日常生活での例
- **本の章立て**: 長い本を複数の章に分けて、読みやすく整理する
- **レシピの分類**: 料理のレシピを「和食」「洋食」「中華」などに分類して管理する
- **会社の部署**: 会社を営業部、開発部、経理部などに分けて、役割を明確にする

### プログラミングでの例

```typescript
// math.ts（計算機能をまとめたファイル）
export function add(a: number, b: number): number {
    return a + b;
}

// main.ts（メインのファイル）
import { add } from './math';
console.log(add(10, 5)); // 15
```

### モジュールを使う理由
1. **コードの整理**: 関連するコードを1つのファイルにまとめられる
2. **再利用性**: 他のファイルで同じコードを使い回せる
3. **保守性**: 修正箇所が明確になり、管理しやすくなる
4. **名前の衝突を防ぐ**: 各モジュールで独立したスコープを持つ
5. **型安全性**: TypeScriptの型情報を活用できる

### exportとimport
- **export**: 他のファイルで使えるように公開する
- **import**: 他のファイルから読み込む

### モジュールの基本構文

```typescript
// エクスポート側（他のファイルで使えるように公開）
export function 関数名(): void {
    // 処理
}

export const 定数名 = 値;

// インポート側（他のファイルから読み込む）
import { 関数名, 定数名 } from './ファイル名';
```

### モジュールの基本構造

```typescript
// math.ts（エクスポート側）
export function add(a: number, b: number): number {
    return a + b;
}

// main.ts（インポート側）
import { add } from './math';
console.log(add(10, 5)); // 15
```

### 実践例: モジュールの基本的な使い方

```typescript
// src/math.ts
// 基本的な関数をエクスポート
export function add(a: number, b: number): number {
    return a + b;
}

export function subtract(a: number, b: number): number {
    return a - b;
}

export function multiply(a: number, b: number): number {
    return a * b;
}

export function divide(a: number, b: number): number {
    if (b === 0) {
        throw new Error("0で割ることはできません");
    }
    return a / b;
}

// src/main.ts
// 関数をインポートして使用
import { add, subtract, multiply, divide } from './math';

console.log(`10 + 5 = ${add(10, 5)}`);        // 15
console.log(`10 - 5 = ${subtract(10, 5)}`);  // 5
console.log(`10 * 5 = ${multiply(10, 5)}`);  // 50
console.log(`10 / 5 = ${divide(10, 5)}`);   // 2

// 実践例: 定数のエクスポート
// src/constants.ts
export const PI = 3.14159;
export const E = 2.71828;
export const MAX_SIZE = 1000;

// src/main.ts
import { PI, E, MAX_SIZE } from './constants';

console.log(`円周率: ${PI}`);
console.log(`自然対数の底: ${E}`);
console.log(`最大サイズ: ${MAX_SIZE}`);

// 実践例: 型定義のエクスポート
// src/types.ts
export interface User {
    id: number;
    name: string;
    email: string;
}

export type Status = "active" | "inactive" | "pending";

// src/main.ts
import { User, Status } from './types';

const user: User = {
    id: 1,
    name: "太郎",
    email: "taro@example.com"
};

const status: Status = "active";
```

---

## import宣言とexport宣言を利用しよう

### exportとimportとは
`export`と`import`は、**モジュール間でコードを共有する**ための宣言です。`export`で公開し、`import`で読み込みます。

### 日常生活での例
- **図書館**: 本（export）を貸し出し、他の人が借りる（import）
- **レストランのメニュー**: 提供できる料理（export）をメニューに載せ、お客様が注文する（import）
- **会社の組織**: 各部署が提供するサービス（export）を、他の部署が利用する（import）

### export宣言の種類

#### 1. Named Export（名前付きエクスポート）

```typescript
// 個別にエクスポート
export function add(a: number, b: number): number {
    return a + b;
}

export const PI = 3.14159;

// まとめてエクスポート
function subtract(a: number, b: number): number {
    return a - b;
}

const E = 2.71828;

export { subtract, E };
```

#### 2. Default Export（デフォルトエクスポート）

```typescript
// デフォルトエクスポート（1つのファイルに1つだけ）
export default function multiply(a: number, b: number): number {
    return a * b;
}
```

### import宣言の種類

#### 1. Named Import（名前付きインポート）

```typescript
// 個別にインポート
import { add, subtract } from './math';

// すべてをインポート（名前空間として）
import * as Math from './math';
console.log(Math.add(10, 5));

// 別名でインポート
import { add as addition } from './math';
```

#### 2. Default Import（デフォルトインポート）

```typescript
// デフォルトエクスポートをインポート
import multiply from './math';

// 名前付きとデフォルトを同時にインポート
import multiply, { add, subtract } from './math';
```

### 実践例: import宣言とexport宣言

```typescript
// src/utils.ts
// Named Exportの例
export function formatDate(date: Date): string {
    return date.toLocaleDateString('ja-JP');
}

export function formatCurrency(amount: number): string {
    return `¥${amount.toLocaleString()}`;
}

export const APP_NAME = "MyApp";
export const VERSION = "1.0.0";

// まとめてエクスポート
function validateEmail(email: string): boolean {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

function validatePhone(phone: string): boolean {
    return /^[0-9]{10,11}$/.test(phone);
}

export { validateEmail, validatePhone };

// src/main.ts
// 個別にインポート
import { formatDate, formatCurrency, APP_NAME, VERSION } from './utils';

const today = new Date();
console.log(formatDate(today));
console.log(formatCurrency(1000));

// すべてをインポート（名前空間として）
import * as Utils from './utils';
console.log(Utils.formatDate(today));
console.log(Utils.APP_NAME);

// 別名でインポート
import { formatDate as format, validateEmail as isValidEmail } from './utils';
console.log(format(today));
console.log(isValidEmail("test@example.com"));

// 実践例: Default Export
// src/calculator.ts
class Calculator {
    add(a: number, b: number): number {
        return a + b;
    }
    
    subtract(a: number, b: number): number {
        return a - b;
    }
}

export default Calculator;

// src/main.ts
// デフォルトエクスポートをインポート
import Calculator from './calculator';

const calc = new Calculator();
console.log(calc.add(10, 5));

// 別名でインポート
import Calc from './calculator';
const calculator = new Calc();

// 実践例: 名前付きとデフォルトの組み合わせ
// src/math.ts
export function add(a: number, b: number): number {
    return a + b;
}

export function subtract(a: number, b: number): number {
    return a - b;
}

export default function multiply(a: number, b: number): number {
    return a * b;
}

// src/main.ts
// デフォルトと名前付きを同時にインポート
import multiply, { add, subtract } from './math';

console.log(multiply(10, 5));  // デフォルト
console.log(add(10, 5));       // 名前付き
console.log(subtract(10, 5));  // 名前付き

// 実践例: 再エクスポート
// src/math.ts
export function add(a: number, b: number): number {
    return a + b;
}

// src/advanced-math.ts
export function power(a: number, b: number): number {
    return Math.pow(a, b);
}

// src/index.ts（すべてを再エクスポート）
export { add } from './math';
export { power } from './advanced-math';

// src/main.ts
// index.tsからすべてをインポート
import { add, power } from './index';
console.log(add(10, 5));
console.log(power(2, 3));
```

---

## 関数・クラスをexportしよう

### 関数とクラスのエクスポートとは
関数やクラスを`export`することで、**他のファイルから使えるように**できます。これにより、コードを再利用しやすくなります。

### 日常生活での例
- **工具の貸し出し**: 電動ドリル（関数）を隣人に貸す（export）ことで、他の人も使える
- **レシピの共有**: 料理のレシピ（クラス）を友達に教える（export）ことで、他の人も同じ料理を作れる
- **サービスの提供**: 会社が提供するサービス（関数・クラス）を、顧客が利用する（import）

### 関数のエクスポート

```typescript
// 個別にエクスポート
export function greet(name: string): string {
    return `こんにちは、${name}さん`;
}

// まとめてエクスポート
function sayGoodbye(name: string): string {
    return `さようなら、${name}さん`;
}

export { sayGoodbye };
```

### クラスのエクスポート

```typescript
// クラスをエクスポート
export class User {
    constructor(public name: string, public age: number) {}
    
    greet(): string {
        return `こんにちは、${this.name}さん`;
    }
}

// デフォルトエクスポート
export default class Admin {
    constructor(public name: string) {}
}
```

### 実践例: 関数・クラスをexport

```typescript
// src/string-utils.ts
// 関数のエクスポート
export function capitalize(str: string): string {
    return str.charAt(0).toUpperCase() + str.slice(1);
}

export function reverse(str: string): string {
    return str.split('').reverse().join('');
}

export function truncate(str: string, length: number): string {
    if (str.length <= length) {
        return str;
    }
    return str.slice(0, length) + '...';
}

// まとめてエクスポート
function toUpperCase(str: string): string {
    return str.toUpperCase();
}

function toLowerCase(str: string): string {
    return str.toLowerCase();
}

export { toUpperCase, toLowerCase };

// src/main.ts
import { capitalize, reverse, truncate, toUpperCase, toLowerCase } from './string-utils';

console.log(capitalize("hello"));      // Hello
console.log(reverse("world"));         // dlrow
console.log(truncate("長い文字列", 3)); // 長い文...

// 実践例: クラスのエクスポート
// src/user.ts
export class User {
    constructor(
        public id: number,
        public name: string,
        public email: string
    ) {}
    
    greet(): string {
        return `こんにちは、${this.name}さん`;
    }
    
    getInfo(): string {
        return `${this.name} (${this.email})`;
    }
}

// デフォルトエクスポート
export default class Admin {
    constructor(
        public id: number,
        public name: string,
        public permissions: string[]
    ) {}
    
    hasPermission(permission: string): boolean {
        return this.permissions.includes(permission);
    }
}

// src/main.ts
import User, { User as UserClass } from './user';
import Admin from './user';

const user = new UserClass(1, "太郎", "taro@example.com");
console.log(user.greet());

const admin = new Admin(1, "管理者", ["read", "write", "delete"]);
console.log(admin.hasPermission("write"));

// 実践例: 複数のクラスをエクスポート
// src/shapes.ts
export class Circle {
    constructor(public radius: number) {}
    
    area(): number {
        return Math.PI * this.radius ** 2;
    }
    
    circumference(): number {
        return 2 * Math.PI * this.radius;
    }
}

export class Rectangle {
    constructor(
        public width: number,
        public height: number
    ) {}
    
    area(): number {
        return this.width * this.height;
    }
    
    perimeter(): number {
        return 2 * (this.width + this.height);
    }
}

export class Triangle {
    constructor(
        public base: number,
        public height: number
    ) {}
    
    area(): number {
        return (this.base * this.height) / 2;
    }
}

// src/main.ts
import { Circle, Rectangle, Triangle } from './shapes';

const circle = new Circle(5);
console.log(`円の面積: ${circle.area()}`);

const rectangle = new Rectangle(10, 5);
console.log(`長方形の面積: ${rectangle.area()}`);

const triangle = new Triangle(10, 5);
console.log(`三角形の面積: ${triangle.area()}`);

// 実践例: インターフェースとクラスの組み合わせ
// src/interfaces.ts
export interface Animal {
    name: string;
    age: number;
    makeSound(): void;
}

// src/animals.ts
import { Animal } from './interfaces';

export class Dog implements Animal {
    constructor(public name: string, public age: number) {}
    
    makeSound(): void {
        console.log("ワンワン");
    }
}

export class Cat implements Animal {
    constructor(public name: string, public age: number) {}
    
    makeSound(): void {
        console.log("ニャーニャー");
    }
}

// src/main.ts
import { Dog, Cat } from './animals';
import { Animal } from './interfaces';

const dog = new Dog("ポチ", 3);
const cat = new Cat("タマ", 2);

dog.makeSound();
cat.makeSound();

// 実践例: 型定義とクラスの組み合わせ
// src/types.ts
export type Status = "pending" | "approved" | "rejected";

export interface Task {
    id: number;
    title: string;
    status: Status;
}

// src/task-manager.ts
import { Task, Status } from './types';

export class TaskManager {
    private tasks: Task[] = [];
    
    addTask(title: string): void {
        const task: Task = {
            id: this.tasks.length + 1,
            title,
            status: "pending"
        };
        this.tasks.push(task);
    }
    
    updateStatus(id: number, status: Status): void {
        const task = this.tasks.find(t => t.id === id);
        if (task) {
            task.status = status;
        }
    }
    
    getTasks(): Task[] {
        return this.tasks;
    }
}

// src/main.ts
import { TaskManager } from './task-manager';
import { Status } from './types';

const manager = new TaskManager();
manager.addTask("タスク1");
manager.addTask("タスク2");
manager.updateStatus(1, "approved");
console.log(manager.getTasks());
```

---

## まとめ

この章では、モジュールについて以下のことを学びました。

### モジュールの基本
- モジュールは、コードを複数のファイルに分割して管理する仕組み
- `export`で他のファイルに公開し、`import`で他のファイルから読み込む
- コードの整理、再利用性、保守性が向上する
- 名前の衝突を防ぎ、型安全性を確保できる

### export宣言とimport宣言
- **Named Export**: 複数の関数やクラスを個別にエクスポート
- **Default Export**: 1つのファイルに1つだけのデフォルトエクスポート
- **Named Import**: 個別にインポート、名前空間としてインポート、別名でインポート
- **Default Import**: デフォルトエクスポートをインポート
- 複数のインポート方法を組み合わせて使用できる

### 関数とクラスのエクスポート
- 関数を`export`することで、他のファイルから使用できる
- クラスを`export`することで、他のファイルからインスタンス化できる
- インターフェースや型定義もエクスポートできる
- デフォルトエクスポートと名前付きエクスポートを使い分ける

### モジュールの活用場面
- 大規模なアプリケーションの開発
- コードの再利用と整理
- チーム開発でのコード共有
- 型安全性を保ちながらコードを分割する

### 次のステップ
モジュールを理解したら、実際のプロジェクトで積極的に活用してみましょう。大規模なアプリケーションを効率的に開発できるようになります。

---

## 演習問題

### 問題1: 関数のエクスポート
`calculate.ts`ファイルを作成し、`add`、`subtract`、`multiply`、`divide`関数をエクスポートしてください。`main.ts`でそれらをインポートして使用してください。

<details>
<summary>解答例</summary>

```typescript
// calculate.ts
export function add(a: number, b: number): number {
    return a + b;
}

export function subtract(a: number, b: number): number {
    return a - b;
}

export function multiply(a: number, b: number): number {
    return a * b;
}

export function divide(a: number, b: number): number {
    if (b === 0) {
        throw new Error("0で割ることはできません");
    }
    return a / b;
}

// main.ts
import { add, subtract, multiply, divide } from './calculate';

console.log(add(10, 5));        // 15
console.log(subtract(10, 5));   // 5
console.log(multiply(10, 5));   // 50
console.log(divide(10, 5));    // 2
```
</details>

### 問題2: クラスのエクスポート
`person.ts`ファイルを作成し、`Person`クラスをエクスポートしてください。`main.ts`でインポートして使用してください。

<details>
<summary>解答例</summary>

```typescript
// person.ts
export class Person {
    constructor(
        public name: string,
        public age: number
    ) {}
    
    greet(): string {
        return `こんにちは、${this.name}さん（${this.age}歳）`;
    }
}

// main.ts
import { Person } from './person';

const person = new Person("太郎", 25);
console.log(person.greet()); // こんにちは、太郎さん（25歳）
```
</details>

### 問題3: Default Export
`calculator.ts`ファイルを作成し、`Calculator`クラスをデフォルトエクスポートしてください。`main.ts`でインポートして使用してください。

<details>
<summary>解答例</summary>

```typescript
// calculator.ts
export default class Calculator {
    add(a: number, b: number): number {
        return a + b;
    }
    
    subtract(a: number, b: number): number {
        return a - b;
    }
}

// main.ts
import Calculator from './calculator';

const calc = new Calculator();
console.log(calc.add(10, 5));      // 15
console.log(calc.subtract(10, 5)); // 5
```
</details>

### 問題4: 型定義のエクスポート
`types.ts`ファイルを作成し、`User`インターフェースと`Status`型をエクスポートしてください。`user.ts`でそれらを使用して`User`クラスを作成してください。

<details>
<summary>解答例</summary>

```typescript
// types.ts
export interface User {
    id: number;
    name: string;
    email: string;
}

export type Status = "active" | "inactive";

// user.ts
import { User, Status } from './types';

export class UserManager {
    private users: User[] = [];
    
    addUser(user: User): void {
        this.users.push(user);
    }
    
    getUsers(): User[] {
        return this.users;
    }
}

// main.ts
import { UserManager } from './user';
import { User } from './types';

const manager = new UserManager();
const user: User = {
    id: 1,
    name: "太郎",
    email: "taro@example.com"
};
manager.addUser(user);
console.log(manager.getUsers());
```
</details>

### 問題5: 名前空間インポート
`math.ts`ファイルに複数の関数をエクスポートし、`main.ts`で名前空間としてインポートして使用してください。

<details>
<summary>解答例</summary>

```typescript
// math.ts
export function add(a: number, b: number): number {
    return a + b;
}

export function subtract(a: number, b: number): number {
    return a - b;
}

export function multiply(a: number, b: number): number {
    return a * b;
}

// main.ts
import * as Math from './math';

console.log(Math.add(10, 5));        // 15
console.log(Math.subtract(10, 5));   // 5
console.log(Math.multiply(10, 5));   // 50
```
</details>

---

お疲れ様でした！TypeScriptマニュアルの学習、お疲れ様でした！

