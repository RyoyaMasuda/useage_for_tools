# 5-2. 制御構文（繰り返し処理）

この章では、同じ処理を繰り返し実行する「繰り返し処理（ループ）」について学びます。ループを理解することで、効率的にプログラムを作成できるようになります。

---

## 目次

- [繰り返し処理forを使おう](#繰り返し処理forを使おう)
- [ループの入れ子を使おう](#ループの入れ子を使おう)
- [繰り返し処理whileを使おう](#繰り返し処理whileを使おう)
- [繰り返し処理do whileを使おう](#繰り返し処理do-whileを使おう)
- [繰り返し処理for...ofを使おう](#繰り返し処理forofを使おう)
- [continueとbreak](#continueとbreak)
- [まとめ](#まとめ)
- [演習問題](#演習問題)

---

## 繰り返し処理forを使おう

### 繰り返し処理とは
繰り返し処理は、**同じ処理を何度も実行する**機能です。

### for文の基本構文

```typescript
for (初期化; 条件; 更新) {
    // 繰り返し実行される処理
}
```

### for文の動作の流れ

1. **初期化**: ループ変数を初期化（最初に1回だけ実行）
2. **条件**: 条件をチェック（各ループの開始時に実行）
3. **処理**: 条件がtrueの場合、処理を実行
4. **更新**: ループ変数を更新（各ループの終了時に実行）
5. **条件**: 再度条件をチェック
6. 条件がfalseになるまで2-5を繰り返す

### 基本的なfor文

```typescript
// 0から9まで表示
for (let i = 0; i < 10; i++) {
    console.log(i);
}
```

### 実践例: for文

```typescript
// src/for-loop.ts
// 基本的なfor文
console.log("=== 0から9まで ===");
for (let i = 0; i < 10; i++) {
    console.log(i);
}

// 1から10まで表示
console.log("\n=== 1から10まで ===");
for (let i = 1; i <= 10; i++) {
    console.log(i);
}

// 10から1まで逆順に表示
console.log("\n=== 10から1まで ===");
for (let i = 10; i >= 1; i--) {
    console.log(i);
}

// 2ずつ増やす（偶数を表示）
console.log("\n=== 0から20までの偶数 ===");
for (let i = 0; i <= 20; i += 2) {
    console.log(i);
}

// 5ずつ増やす
console.log("\n=== 0から50まで5ずつ ===");
for (let i = 0; i <= 50; i += 5) {
    console.log(i);
}

// 配列の要素を順番に処理
console.log("\n=== 配列の要素を表示 ===");
const fruits = ["りんご", "バナナ", "オレンジ", "ぶどう"];
for (let i = 0; i < fruits.length; i++) {
    console.log(`${i + 1}番目: ${fruits[i]}`);
}

// 実践例: 合計を計算
function sumNumbers(n: number): number {
    let sum = 0;
    for (let i = 1; i <= n; i++) {
        sum += i;
    }
    return sum;
}

console.log(`1から10までの合計: ${sumNumbers(10)}`); // 55
console.log(`1から100までの合計: ${sumNumbers(100)}`); // 5050

// 実践例: 階乗を計算
function factorial(n: number): number {
    let result = 1;
    for (let i = 1; i <= n; i++) {
        result *= i;
    }
    return result;
}

console.log(`5の階乗: ${factorial(5)}`);   // 120
console.log(`10の階乗: ${factorial(10)}`); // 3628800

// 実践例: 配列の最大値を求める
function findMax(numbers: number[]): number {
    if (numbers.length === 0) {
        throw new Error("配列が空です");
    }
    
    let max = numbers[0];
    for (let i = 1; i < numbers.length; i++) {
        if (numbers[i] > max) {
            max = numbers[i];
        }
    }
    return max;
}

const scores = [85, 92, 78, 96, 88];
console.log(`最高点: ${findMax(scores)}`); // 96

// 実践例: 文字列を逆順にする
function reverseString(str: string): string {
    let reversed = "";
    for (let i = str.length - 1; i >= 0; i--) {
        reversed += str[i];
    }
    return reversed;
}

console.log(`"Hello"を逆順: ${reverseString("Hello")}`); // "olleH"
```

---

## ループの入れ子を使おう

### 入れ子とは
入れ子は、**ループの中に別のループを書く**ことです。

### 入れ子の基本

```typescript
for (let i = 0; i < 3; i++) {
    for (let j = 0; j < 3; j++) {
        // 内側のループの処理
    }
}
```

### 実践例: ループの入れ子

```typescript
// src/nested-loops.ts
// 基本的な入れ子
console.log("=== 九九の表 ===");
for (let i = 1; i <= 9; i++) {
    let line = "";
    for (let j = 1; j <= 9; j++) {
        line += `${i * j}\t`;
    }
    console.log(line);
}

// 三角形を表示
console.log("\n=== 三角形 ===");
for (let i = 1; i <= 5; i++) {
    let stars = "";
    for (let j = 1; j <= i; j++) {
        stars += "*";
    }
    console.log(stars);
}

// 逆三角形を表示
console.log("\n=== 逆三角形 ===");
for (let i = 5; i >= 1; i--) {
    let stars = "";
    for (let j = 1; j <= i; j++) {
        stars += "*";
    }
    console.log(stars);
}

// ピラミッドを表示
console.log("\n=== ピラミッド ===");
const height = 5;
for (let i = 1; i <= height; i++) {
    let line = "";
    // 空白を表示
    for (let j = 1; j <= height - i; j++) {
        line += " ";
    }
    // 星を表示
    for (let j = 1; j <= 2 * i - 1; j++) {
        line += "*";
    }
    console.log(line);
}

// 2次元配列を処理
console.log("\n=== 2次元配列 ===");
const matrix = [
    [1, 2, 3],
    [4, 5, 6],
    [7, 8, 9]
];

for (let i = 0; i < matrix.length; i++) {
    for (let j = 0; j < matrix[i].length; j++) {
        console.log(`matrix[${i}][${j}] = ${matrix[i][j]}`);
    }
}

// 実践例: 2次元配列の合計を計算
function sumMatrix(matrix: number[][]): number {
    let sum = 0;
    for (let i = 0; i < matrix.length; i++) {
        for (let j = 0; j < matrix[i].length; j++) {
            sum += matrix[i][j];
        }
    }
    return sum;
}

const numbers = [
    [1, 2, 3],
    [4, 5, 6],
    [7, 8, 9]
];
console.log(`2次元配列の合計: ${sumMatrix(numbers)}`); // 45

// 実践例: 掛け算表を作成
function createMultiplicationTable(n: number): number[][] {
    const table: number[][] = [];
    for (let i = 1; i <= n; i++) {
        const row: number[] = [];
        for (let j = 1; j <= n; j++) {
            row.push(i * j);
        }
        table.push(row);
    }
    return table;
}

const table = createMultiplicationTable(5);
console.log("\n=== 5×5の掛け算表 ===");
for (let i = 0; i < table.length; i++) {
    console.log(table[i].join("\t"));
}
```

---

## 繰り返し処理whileを使おう

### while文とは
while文は、**条件がtrueの間、処理を繰り返す**構文です。

### while文の基本構文

```typescript
while (条件) {
    // 条件がtrueの間、繰り返し実行される処理
}
```

### for文とwhile文の違い

- **for文**: 繰り返し回数が明確な場合に適している
- **while文**: 繰り返し回数が不明確な場合に適している

### 実践例: while文

```typescript
// src/while-loop.ts
// 基本的なwhile文
console.log("=== 0から9まで ===");
let i = 0;
while (i < 10) {
    console.log(i);
    i++;
}

// 1から10まで表示
console.log("\n=== 1から10まで ===");
let count = 1;
while (count <= 10) {
    console.log(count);
    count++;
}

// 10から1まで逆順に表示
console.log("\n=== 10から1まで ===");
let num = 10;
while (num >= 1) {
    console.log(num);
    num--;
}

// 実践例: 合計を計算
function sumWithWhile(n: number): number {
    let sum = 0;
    let i = 1;
    while (i <= n) {
        sum += i;
        i++;
    }
    return sum;
}

console.log(`1から10までの合計: ${sumWithWhile(10)}`); // 55

// 実践例: 数値を逆順にする
function reverseNumber(num: number): number {
    let reversed = 0;
    while (num > 0) {
        reversed = reversed * 10 + (num % 10);
        num = Math.floor(num / 10);
    }
    return reversed;
}

console.log(`1234を逆順: ${reverseNumber(1234)}`); // 4321

// 実践例: カウントダウン
function countdown(seconds: number): void {
    while (seconds > 0) {
        console.log(`${seconds}秒...`);
        seconds--;
    }
    console.log("発射！");
}

countdown(5);

// 実践例: ユーザー入力のシミュレーション（条件が満たされるまで繰り返す）
function simulateUserInput(): void {
    let input = "";
    let attempts = 0;
    
    // "yes"が入力されるまで繰り返す（シミュレーション）
    while (input !== "yes" && attempts < 5) {
        attempts++;
        // 実際のアプリケーションでは、ユーザーからの入力を待つ
        // ここではシミュレーションとして、3回目に"yes"を返す
        if (attempts === 3) {
            input = "yes";
        } else {
            input = "no";
        }
        console.log(`試行${attempts}: ${input}`);
    }
    
    if (input === "yes") {
        console.log("承認されました！");
    } else {
        console.log("最大試行回数に達しました");
    }
}

simulateUserInput();

// 注意: 無限ループに注意
// 以下のコードは実行しないでください（コメントアウト）
/*
let x = 0;
while (x < 10) {
    // xを増やさないと無限ループになる
    console.log(x);
}
*/
```

---

## 繰り返し処理do whileを使おう

### do-while文とは
do-while文は、**最低1回は処理を実行し、その後条件をチェックする**構文です。

### do-while文の基本構文

```typescript
do {
    // 最低1回は実行される処理
} while (条件);
```

### while文とdo-while文の違い

- **while文**: 条件をチェックしてから処理を実行（0回実行の可能性がある）
- **do-while文**: 処理を実行してから条件をチェック（最低1回は実行される）

### 実践例: do-while文

```typescript
// src/do-while-loop.ts
// 基本的なdo-while文
console.log("=== 0から9まで ===");
let i = 0;
do {
    console.log(i);
    i++;
} while (i < 10);

// 条件が最初からfalseの場合でも1回は実行される
console.log("\n=== 条件が最初からfalse ===");
let j = 10;
do {
    console.log(j); // 1回は実行される
    j++;
} while (j < 10); // 条件はfalseだが、1回は実行される

// 実践例: メニュー選択のシミュレーション
function showMenu(): void {
    let choice = "";
    let attempts = 0;
    
    do {
        attempts++;
        // 実際のアプリケーションでは、ユーザーからの入力を待つ
        // ここではシミュレーションとして、3回目に"exit"を返す
        if (attempts === 3) {
            choice = "exit";
        } else {
            choice = "continue";
        }
        
        console.log(`選択: ${choice}`);
        
        if (choice === "continue") {
            console.log("処理を続けます...");
        }
    } while (choice !== "exit" && attempts < 5);
    
    console.log("プログラムを終了します");
}

showMenu();

// 実践例: パスワード生成（最低1回は生成）
function generatePassword(length: number): string {
    let password = "";
    let attempts = 0;
    
    do {
        attempts++;
        password = "";
        for (let i = 0; i < length; i++) {
            const randomChar = String.fromCharCode(97 + Math.floor(Math.random() * 26));
            password += randomChar;
        }
        console.log(`試行${attempts}: ${password}`);
    } while (password.length < length && attempts < 10);
    
    return password;
}

console.log(`\n生成されたパスワード: ${generatePassword(8)}`);

// 実践例: 数値の検証（最低1回は入力を受け付ける）
function validateNumber(): number {
    let num = 0;
    let isValid = false;
    
    do {
        // 実際のアプリケーションでは、ユーザーからの入力を待つ
        // ここではシミュレーションとして、3回目に有効な値を返す
        const attempts = Math.floor(Math.random() * 3) + 1;
        if (attempts === 3) {
            num = 10;
            isValid = true;
        } else {
            num = -1;
            isValid = false;
        }
        
        if (!isValid) {
            console.log("無効な値です。再度入力してください。");
        }
    } while (!isValid);
    
    console.log(`有効な値が入力されました: ${num}`);
    return num;
}

validateNumber();
```

---

## 繰り返し処理for...ofを使おう

### for...of文とは
for...of文は、**配列や文字列などの反復可能オブジェクトの要素を順番に処理する**構文です。

### for...of文の基本構文

```typescript
for (const 要素 of 配列) {
    // 各要素に対する処理
}
```

### for文とfor...of文の違い

- **for文**: インデックスを使って要素にアクセス
- **for...of文**: 要素を直接取得（インデックスは取得できない）

### 実践例: for...of文

```typescript
// src/for-of-loop.ts
// 基本的なfor...of文
console.log("=== 配列の要素を表示 ===");
const fruits = ["りんご", "バナナ", "オレンジ", "ぶどう"];
for (const fruit of fruits) {
    console.log(fruit);
}

// 文字列の各文字を処理
console.log("\n=== 文字列の各文字 ===");
const text = "Hello";
for (const char of text) {
    console.log(char);
}

// 実践例: 配列の合計を計算
function sumArray(numbers: number[]): number {
    let sum = 0;
    for (const num of numbers) {
        sum += num;
    }
    return sum;
}

const scores = [85, 92, 78, 96, 88];
console.log(`合計: ${sumArray(scores)}`); // 439

// 実践例: 最大値を求める
function findMax(numbers: number[]): number {
    if (numbers.length === 0) {
        throw new Error("配列が空です");
    }
    
    let max = numbers[0];
    for (const num of numbers) {
        if (num > max) {
            max = num;
        }
    }
    return max;
}

console.log(`最高点: ${findMax(scores)}`); // 96

// 実践例: 文字列内の特定の文字をカウント
function countChar(str: string, target: string): number {
    let count = 0;
    for (const char of str) {
        if (char === target) {
            count++;
        }
    }
    return count;
}

console.log(`"Hello"の中の"l"の数: ${countChar("Hello", "l")}`); // 2

// 実践例: 配列をフィルタリング
function filterEven(numbers: number[]): number[] {
    const evens: number[] = [];
    for (const num of numbers) {
        if (num % 2 === 0) {
            evens.push(num);
        }
    }
    return evens;
}

const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
console.log(`偶数: ${filterEven(numbers)}`); // [2, 4, 6, 8, 10]

// 実践例: オブジェクトの配列を処理
interface Person {
    name: string;
    age: number;
}

const people: Person[] = [
    { name: "太郎", age: 25 },
    { name: "花子", age: 30 },
    { name: "次郎", age: 20 }
];

console.log("\n=== 人物リスト ===");
for (const person of people) {
    console.log(`${person.name}: ${person.age}歳`);
}

// 実践例: 文字列を単語に分割して処理
function processWords(sentence: string): void {
    const words = sentence.split(" ");
    for (const word of words) {
        console.log(`単語: ${word} (長さ: ${word.length})`);
    }
}

processWords("Hello TypeScript World");

// インデックスも必要な場合は、entries()を使う
console.log("\n=== インデックス付きで処理 ===");
for (const [index, fruit] of fruits.entries()) {
    console.log(`${index}: ${fruit}`);
}
```

---

## continueとbreak

### continueとは
continueは、**現在のループの処理をスキップして、次のループに進む**文です。

### breakとは
breakは、**ループを途中で終了する**文です。

### 実践例: continueとbreak

```typescript
// src/continue-break.ts
// continueの使用例
console.log("=== continue: 偶数をスキップ ===");
for (let i = 1; i <= 10; i++) {
    if (i % 2 === 0) {
        continue; // 偶数の場合はスキップ
    }
    console.log(i); // 奇数だけが表示される
}

// breakの使用例
console.log("\n=== break: 5でループを終了 ===");
for (let i = 1; i <= 10; i++) {
    if (i === 5) {
        break; // 5になったらループを終了
    }
    console.log(i); // 1から4まで表示
}

// 実践例: 配列から特定の値を見つける
function findValue(numbers: number[], target: number): number | null {
    for (const num of numbers) {
        if (num === target) {
            return num; // 見つかったら即座に返す
        }
    }
    return null; // 見つからなかった
}

const numbers = [1, 3, 5, 7, 9];
console.log(`5を検索: ${findValue(numbers, 5)}`);   // 5
console.log(`4を検索: ${findValue(numbers, 4)}`);   // null

// 実践例: 配列から条件に合う最初の要素を見つける
function findFirstEven(numbers: number[]): number | null {
    for (const num of numbers) {
        if (num % 2 === 0) {
            return num; // 最初の偶数を見つけたら即座に返す
        }
    }
    return null;
}

console.log(`最初の偶数: ${findFirstEven([1, 3, 4, 5, 6])}`); // 4

// 実践例: ネストされたループでのbreak
console.log("\n=== ネストされたループでのbreak ===");
outer: for (let i = 1; i <= 3; i++) {
    for (let j = 1; j <= 3; j++) {
        if (i === 2 && j === 2) {
            break outer; // 外側のループも終了
        }
        console.log(`i=${i}, j=${j}`);
    }
}

// 実践例: continueで特定の条件をスキップ
function processNumbers(numbers: number[]): void {
    for (const num of numbers) {
        if (num < 0) {
            continue; // 負の数はスキップ
        }
        if (num === 0) {
            continue; // 0もスキップ
        }
        console.log(`処理中: ${num}`);
    }
}

processNumbers([-1, 0, 1, 2, 3, -2, 4]); // 1, 2, 3, 4だけが表示される

// 実践例: 最大試行回数を設定
function findWithLimit(numbers: number[], target: number, maxAttempts: number): number | null {
    let attempts = 0;
    for (const num of numbers) {
        attempts++;
        if (attempts > maxAttempts) {
            break; // 最大試行回数を超えたら終了
        }
        if (num === target) {
            return num;
        }
    }
    return null;
}

console.log(`制限付き検索: ${findWithLimit([1, 2, 3, 4, 5], 3, 2)}`); // null（2回目までしか検索しない）
```

---

## まとめ

この章では、TypeScriptの繰り返し処理について学びました。

### 学んだこと
- for文: 繰り返し回数が明確な場合に使用
- ループの入れ子: 2次元配列や複雑な処理に使用
- while文: 繰り返し回数が不明確な場合に使用
- do-while文: 最低1回は実行したい場合に使用
- for...of文: 配列や文字列の要素を直接取得
- continue: 現在のループをスキップ
- break: ループを途中で終了

### 重要なポイント
1. **for文**: 最も一般的なループ構文
2. **while文**: 条件が満たされるまで繰り返す
3. **do-while文**: 最低1回は実行される
4. **for...of文**: 配列の要素を直接取得できる
5. **continue/break**: ループの制御に便利

### 次のステップ
次の章では、関数について詳しく学びます。

---

## 演習問題

### 問題1: for文
1から100までの数値の合計を計算してください。

<details>
<summary>解答例</summary>

```typescript
let sum = 0;
for (let i = 1; i <= 100; i++) {
    sum += i;
}
console.log(`合計: ${sum}`); // 5050
```
</details>

### 問題2: ループの入れ子
九九の表を表示してください。

<details>
<summary>解答例</summary>

```typescript
for (let i = 1; i <= 9; i++) {
    let line = "";
    for (let j = 1; j <= 9; j++) {
        line += `${i * j}\t`;
    }
    console.log(line);
}
```
</details>

### 問題3: while文
1から10までの数値をwhile文で表示してください。

<details>
<summary>解答例</summary>

```typescript
let i = 1;
while (i <= 10) {
    console.log(i);
    i++;
}
```
</details>

### 問題4: for...of文
配列`[1, 2, 3, 4, 5]`の各要素を2倍にして表示してください。

<details>
<summary>解答例</summary>

```typescript
const numbers = [1, 2, 3, 4, 5];
for (const num of numbers) {
    console.log(num * 2);
}
```
</details>

### 問題5: continueとbreak
1から20までの数値のうち、3の倍数はスキップし、15以上になったらループを終了してください。

<details>
<summary>解答例</summary>

```typescript
for (let i = 1; i <= 20; i++) {
    if (i >= 15) {
        break;
    }
    if (i % 3 === 0) {
        continue;
    }
    console.log(i);
}
// 1, 2, 4, 5, 7, 8, 10, 11, 13, 14が表示される
```
</details>

---

お疲れ様でした！次の章に進みましょう。

