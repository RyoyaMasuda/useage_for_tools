# 2-5. 関数

この章では、処理をまとめて再利用できる「関数」について学びます。関数を理解することで、コードを整理し、効率的にプログラムを作成できるようになります。

---

## 目次

- [関数とは](#関数とは)
- [関数の定義と呼び出し](#関数の定義と呼び出し)
- [関数の具体例](#関数の具体例)
- [引数と戻り値 (デフォルト引数、コールバック関数)](#引数と戻り値-デフォルト引数コールバック関数)
- [関数の引数](#関数の引数)
- [戻り値](#戻り値)
- [関数を新しく定義する](#関数を新しく定義する)
- [関数の定義1 関数宣言](#関数の定義1-関数宣言)
- [関数に引数を設定する](#関数に引数を設定する)
- [関数の定義2 関数式](#関数の定義2-関数式)
- [関数宣言と関数式の違い](#関数宣言と関数式の違い)
- [アロー関数の記法](#アロー関数の記法)
- [デフォルト引数](#デフォルト引数)
- [コールバック関数](#コールバック関数)
- [メソッドとラッパーオブジェクト](#メソッドとラッパーオブジェクト)
- [高階関数とreduceメソッド](#高階関数とreduceメソッド)
- [まとめ](#まとめ)
- [演習問題](#演習問題)

---

## 関数とは

### 関数の概念
関数（function）は、**処理をまとめて、何度でも使えるようにする**仕組みです。

### 日常生活での例
- **レシピ**: 料理の手順をまとめたもの（関数）を、何度でも使える
- **型紙**: 服を作る手順をまとめたもの（関数）を、何度でも使える
- **マニュアル**: 作業手順をまとめたもの（関数）を、何度でも使える

### プログラミングでの例
```javascript
// 挨拶をする関数
function greet() {
    console.log('こんにちは！');
}

// 関数を呼び出す（何度でも使える）
greet(); // こんにちは！
greet(); // こんにちは！
greet(); // こんにちは！
```

### 関数を使う理由
1. **コードの再利用**: 同じ処理を何度も書かなくてよい
2. **コードの整理**: 処理をまとめて、読みやすくなる
3. **修正が簡単**: 1箇所を修正するだけで、すべてに反映される
4. **テストが容易**: 関数単位でテストできる

### 実践例: 関数の基本概念

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>関数とは</title>
</head>
<body>
    <h1>関数の基本概念</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        let results = [];
        
        // 関数を使わない場合（同じ処理を何度も書く）
        results.push('<h2>関数を使わない場合</h2>');
        results.push('<p>同じ処理を何度も書く必要がある</p>');
        results.push('<p>こんにちは！</p>');
        results.push('<p>こんにちは！</p>');
        results.push('<p>こんにちは！</p>');
        
        // 関数を使う場合（処理をまとめて再利用）
        results.push('<h2>関数を使う場合</h2>');
        results.push('<p>処理をまとめて、何度でも使える</p>');
        
        function greet() {
            return 'こんにちは！';
        }
        
        results.push(`<p>${greet()}</p>`);
        results.push(`<p>${greet()}</p>`);
        results.push(`<p>${greet()}</p>`);
        
        output.innerHTML = results.join('');
        
        // コンソールで確認
        console.log('=== 関数の基本 ===');
        console.log('関数を使うことで、コードを再利用できます');
    </script>
</body>
</html>
```

---

## 関数の定義と呼び出し

関数を使うには、まず関数を**定義**して、その後**呼び出す**必要があります。

### 関数の定義

```javascript
function 関数名() {
    // 実行したい処理
}
```

### 関数の呼び出し

```javascript
関数名();  // 関数を呼び出す
```

### 基本的な流れ

```javascript
// 1. 関数を定義
function sayHello() {
    console.log('こんにちは！');
}

// 2. 関数を呼び出す
sayHello(); // こんにちは！
sayHello(); // こんにちは！
```

### 実践例: 関数の定義と呼び出し

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>関数の定義と呼び出し</title>
</head>
<body>
    <h1>関数の定義と呼び出し</h1>
    <button id="callBtn">関数を呼び出す</button>
    <div id="output"></div>
    
    <script>
        // 関数の定義
        function greet() {
            console.log('こんにちは！');
            return 'こんにちは！';
        }
        
        function showTime() {
            const now = new Date();
            console.log('現在の時刻:', now);
            return now.toString();
        }
        
        const callBtn = document.getElementById('callBtn');
        const output = document.getElementById('output');
        
        callBtn.addEventListener('click', function() {
            // 関数の呼び出し
            const greeting = greet();
            const time = showTime();
            
            output.innerHTML = `
                <p>${greeting}</p>
                <p>${time}</p>
            `;
        });
        
        // ページ読み込み時に実行
        greet();
        showTime();
        
        // コンソールで確認
        console.log('=== 関数の定義と呼び出し ===');
        console.log('関数を定義してから呼び出します');
    </script>
</body>
</html>
```

---

## 関数の具体例

実際の関数の例を見て、関数の使い方を理解しましょう。

### 例1: 挨拶をする関数

```javascript
function greet() {
    console.log('こんにちは！');
}

greet(); // こんにちは！
```

### 例2: 計算をする関数

```javascript
function calculateSum() {
    const a = 10;
    const b = 20;
    const sum = a + b;
    console.log('合計:', sum);
}

calculateSum(); // 合計: 30
```

### 例3: 日付を表示する関数

```javascript
function showDate() {
    const today = new Date();
    console.log('今日は', today);
}

showDate();
```

### 実践例: 様々な関数の例

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>関数の具体例</title>
</head>
<body>
    <h1>関数の具体例</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        let results = [];
        
        // 例1: 挨拶をする関数
        function greet() {
            return 'こんにちは！';
        }
        
        results.push('<h2>例1: 挨拶をする関数</h2>');
        results.push(`<p>${greet()}</p>`);
        
        // 例2: 計算をする関数
        function calculateSum() {
            const a = 10;
            const b = 20;
            return a + b;
        }
        
        results.push('<h2>例2: 計算をする関数</h2>');
        results.push(`<p>10 + 20 = ${calculateSum()}</p>`);
        
        // 例3: 日付を表示する関数
        function showDate() {
            const today = new Date();
            return today.toLocaleDateString('ja-JP');
        }
        
        results.push('<h2>例3: 日付を表示する関数</h2>');
        results.push(`<p>今日は: ${showDate()}</p>`);
        
        // 例4: ランダムな数を生成する関数
        function getRandomNumber() {
            return Math.floor(Math.random() * 100);
        }
        
        results.push('<h2>例4: ランダムな数を生成する関数</h2>');
        results.push(`<p>ランダムな数: ${getRandomNumber()}</p>`);
        results.push(`<p>ランダムな数: ${getRandomNumber()}</p>`);
        results.push(`<p>ランダムな数: ${getRandomNumber()}</p>`);
        
        output.innerHTML = results.join('');
        
        // コンソールで確認
        console.log('=== 関数の具体例 ===');
        console.log('様々な処理を関数として定義できます');
    </script>
</body>
</html>
```

---

## 引数と戻り値 (デフォルト引数、コールバック関数)

関数は、**引数（パラメータ）**を受け取り、**戻り値（返り値）**を返すことができます。

### 引数とは
関数に渡す値のことです。関数を呼び出すときに、値を渡すことができます。

### 戻り値とは
関数が処理の結果として返す値のことです。`return`文を使って値を返します。

### 基本的な構文

```javascript
function 関数名(引数1, 引数2) {
    // 処理
    return 戻り値;
}

// 関数の呼び出し
const result = 関数名(値1, 値2);
```

### 実践例: 引数と戻り値

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>引数と戻り値</title>
</head>
<body>
    <h1>引数と戻り値</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        let results = [];
        
        // 引数を受け取る関数
        function greet(name) {
            return `こんにちは、${name}さん！`;
        }
        
        results.push('<h2>引数を受け取る関数</h2>');
        results.push(`<p>${greet('太郎')}</p>`);
        results.push(`<p>${greet('花子')}</p>`);
        
        // 戻り値を返す関数
        function add(a, b) {
            return a + b;
        }
        
        results.push('<h2>戻り値を返す関数</h2>');
        results.push(`<p>10 + 20 = ${add(10, 20)}</p>`);
        results.push(`<p>5 + 3 = ${add(5, 3)}</p>`);
        
        // 引数と戻り値の組み合わせ
        function calculateArea(width, height) {
            return width * height;
        }
        
        results.push('<h2>引数と戻り値の組み合わせ</h2>');
        results.push(`<p>幅5、高さ10の長方形の面積: ${calculateArea(5, 10)}</p>`);
        
        output.innerHTML = results.join('');
        
        // コンソールで確認
        console.log('=== 引数と戻り値 ===');
        console.log('関数に値を渡して、結果を受け取れます');
    </script>
</body>
</html>
```

---

## 関数の引数

関数に値を渡すには、**引数（パラメータ）**を使います。

### 引数の基本

```javascript
function greet(name) {
    console.log('こんにちは、' + name + 'さん！');
}

greet('太郎'); // こんにちは、太郎さん！
greet('花子'); // こんにちは、花子さん！
```

### 複数の引数

```javascript
function introduce(name, age) {
    console.log(`私は${name}です。${age}歳です。`);
}

introduce('太郎', 25); // 私は太郎です。25歳です。
```

### 引数の順序

引数は、定義した順番で渡す必要があります。

```javascript
function calculate(a, b, c) {
    return a + b * c;
}

calculate(10, 2, 3); // 10 + 2 * 3 = 16
```

### 実践例: 関数の引数

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>関数の引数</title>
</head>
<body>
    <h1>関数の引数</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        let results = [];
        
        // 1つの引数
        function greet(name) {
            return `こんにちは、${name}さん！`;
        }
        
        results.push('<h2>1つの引数</h2>');
        results.push(`<p>${greet('太郎')}</p>`);
        results.push(`<p>${greet('花子')}</p>`);
        
        // 複数の引数
        function introduce(name, age, city) {
            return `私は${name}です。${age}歳で、${city}に住んでいます。`;
        }
        
        results.push('<h2>複数の引数</h2>');
        results.push(`<p>${introduce('太郎', 25, '東京')}</p>`);
        results.push(`<p>${introduce('花子', 30, '大阪')}</p>`);
        
        // 計算に使う引数
        function calculate(a, b, operation) {
            if (operation === '+') {
                return a + b;
            } else if (operation === '-') {
                return a - b;
            } else if (operation === '*') {
                return a * b;
            } else if (operation === '/') {
                return a / b;
            }
        }
        
        results.push('<h2>計算に使う引数</h2>');
        results.push(`<p>10 + 5 = ${calculate(10, 5, '+')}</p>`);
        results.push(`<p>10 - 5 = ${calculate(10, 5, '-')}</p>`);
        results.push(`<p>10 × 5 = ${calculate(10, 5, '*')}</p>`);
        results.push(`<p>10 ÷ 5 = ${calculate(10, 5, '/')}</p>`);
        
        output.innerHTML = results.join('');
        
        // コンソールで確認
        console.log('=== 関数の引数 ===');
        console.log('関数に値を渡すことができます');
    </script>
</body>
</html>
```

---

## 戻り値

関数が処理の結果を返すには、**`return`文**を使います。

### return文の基本

```javascript
function add(a, b) {
    return a + b;  // 値を返す
}

const result = add(10, 20);
console.log(result); // 30
```

### return文の特徴

1. **関数の実行を終了する**: `return`文に到達すると、関数の実行が終了します
2. **値を返す**: `return`の後に書いた値が、関数の呼び出し元に返されます
3. **戻り値がない場合**: `return`を書かない、または`return`だけを書くと、`undefined`が返されます

### return文の例

```javascript
// 値を返す
function getGreeting() {
    return 'こんにちは！';
}

// 戻り値がない（undefinedが返される）
function sayHello() {
    console.log('こんにちは！');
    // returnがない
}

// 早期リターン（条件によって途中で終了）
function checkAge(age) {
    if (age < 0) {
        return '無効な年齢です';
    }
    if (age >= 20) {
        return '成人です';
    }
    return '未成年です';
}
```

### 実践例: 戻り値

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>戻り値</title>
</head>
<body>
    <h1>戻り値</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        let results = [];
        
        // 値を返す関数
        function add(a, b) {
            return a + b;
        }
        
        results.push('<h2>値を返す関数</h2>');
        const sum = add(10, 20);
        results.push(`<p>10 + 20 = ${sum}</p>`);
        
        // 複数の値を返す（オブジェクトや配列を使う）
        function getUserInfo(name, age) {
            return {
                name: name,
                age: age,
                isAdult: age >= 20
            };
        }
        
        results.push('<h2>オブジェクトを返す関数</h2>');
        const user = getUserInfo('太郎', 25);
        results.push(`<p>名前: ${user.name}, 年齢: ${user.age}歳, 成人: ${user.isAdult ? 'はい' : 'いいえ'}</p>`);
        
        // 早期リターン
        function checkScore(score) {
            if (score < 0 || score > 100) {
                return '無効な点数です';
            }
            if (score >= 90) {
                return '優秀です';
            }
            if (score >= 70) {
                return '良好です';
            }
            return '要努力です';
        }
        
        results.push('<h2>早期リターン</h2>');
        results.push(`<p>点数95点: ${checkScore(95)}</p>`);
        results.push(`<p>点数85点: ${checkScore(85)}</p>`);
        results.push(`<p>点数55点: ${checkScore(55)}</p>`);
        results.push(`<p>点数-10点: ${checkScore(-10)}</p>`);
        
        // 戻り値がない場合
        function sayHello() {
            console.log('こんにちは！');
            // returnがない
        }
        
        results.push('<h2>戻り値がない場合</h2>');
        const result = sayHello();
        results.push(`<p>戻り値: ${result}（undefined）</p>`);
        
        output.innerHTML = results.join('');
        
        // コンソールで確認
        console.log('=== 戻り値 ===');
        console.log('return文で値を返すことができます');
    </script>
</body>
</html>
```

---

## 関数を新しく定義する

関数を定義する方法は複数あります。それぞれの特徴を理解しましょう。

### 関数定義の方法

1. **関数宣言**: `function`キーワードを使う
2. **関数式**: 変数に代入する
3. **アロー関数**: `=>`を使う（後で詳しく説明）

### 基本的な流れ

```javascript
// 1. 関数を定義する
function myFunction() {
    // 処理
}

// 2. 関数を呼び出す
myFunction();
```

---

## 関数の定義1 関数宣言

関数宣言は、`function`キーワードを使って関数を定義する方法です。

### 関数宣言の構文

```javascript
function 関数名() {
    // 処理
}
```

### 基本的な使い方

```javascript
function greet() {
    console.log('こんにちは！');
}

greet(); // こんにちは！
```

### 関数宣言の特徴

1. **ホイスティング**: 関数宣言は、コードの実行前に定義される
2. **どこからでも呼び出せる**: 定義の前でも呼び出せる

```javascript
// 定義の前でも呼び出せる（ホイスティング）
greet(); // こんにちは！

function greet() {
    console.log('こんにちは！');
}
```

### 実践例: 関数宣言

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>関数宣言</title>
</head>
<body>
    <h1>関数宣言</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        let results = [];
        
        // 基本的な関数宣言
        function greet() {
            return 'こんにちは！';
        }
        
        results.push('<h2>基本的な関数宣言</h2>');
        results.push(`<p>${greet()}</p>`);
        
        // 引数を受け取る関数宣言
        function introduce(name, age) {
            return `私は${name}です。${age}歳です。`;
        }
        
        results.push('<h2>引数を受け取る関数宣言</h2>');
        results.push(`<p>${introduce('太郎', 25)}</p>`);
        
        // 戻り値を返す関数宣言
        function calculate(a, b) {
            return a + b;
        }
        
        results.push('<h2>戻り値を返す関数宣言</h2>');
        results.push(`<p>10 + 20 = ${calculate(10, 20)}</p>`);
        
        // ホイスティングの例（定義の前でも呼び出せる）
        results.push('<h2>ホイスティング</h2>');
        results.push('<p>関数宣言は、定義の前でも呼び出せます</p>');
        
        // 定義の前に呼び出し（エラーにならない）
        const result = sayHello();
        results.push(`<p>${result}</p>`);
        
        function sayHello() {
            return 'こんにちは！（定義の前に呼び出されました）';
        }
        
        output.innerHTML = results.join('');
        
        // コンソールで確認
        console.log('=== 関数宣言 ===');
        console.log('functionキーワードで関数を定義します');
    </script>
</body>
</html>
```

---

## 関数に引数を設定する

関数に引数を設定することで、関数をより柔軟に使えます。

### 引数の設定方法

```javascript
function 関数名(引数1, 引数2, 引数3) {
    // 引数を使った処理
}
```

### 引数の使い方

```javascript
function greet(name) {
    console.log('こんにちは、' + name + 'さん！');
}

greet('太郎'); // こんにちは、太郎さん！
greet('花子'); // こんにちは、花子さん！
```

### 複数の引数

```javascript
function calculate(a, b, operation) {
    if (operation === '+') {
        return a + b;
    } else if (operation === '-') {
        return a - b;
    }
}

console.log(calculate(10, 5, '+')); // 15
console.log(calculate(10, 5, '-')); // 5
```

### 実践例: 関数に引数を設定する

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>関数に引数を設定する</title>
</head>
<body>
    <h1>関数に引数を設定する</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        let results = [];
        
        // 1つの引数
        function double(number) {
            return number * 2;
        }
        
        results.push('<h2>1つの引数</h2>');
        results.push(`<p>5の2倍: ${double(5)}</p>`);
        results.push(`<p>10の2倍: ${double(10)}</p>`);
        
        // 複数の引数
        function createFullName(firstName, lastName) {
            return `${firstName} ${lastName}`;
        }
        
        results.push('<h2>複数の引数</h2>');
        results.push(`<p>${createFullName('太郎', '山田')}</p>`);
        results.push(`<p>${createFullName('花子', '佐藤')}</p>`);
        
        // 引数を使った計算
        function calculateRectangleArea(width, height) {
            return width * height;
        }
        
        results.push('<h2>引数を使った計算</h2>');
        results.push(`<p>幅5、高さ10の長方形の面積: ${calculateRectangleArea(5, 10)}</p>`);
        results.push(`<p>幅8、高さ6の長方形の面積: ${calculateRectangleArea(8, 6)}</p>`);
        
        // 引数の順序が重要
        function introduce(name, age, city) {
            return `私は${name}です。${age}歳で、${city}に住んでいます。`;
        }
        
        results.push('<h2>引数の順序</h2>');
        results.push(`<p>${introduce('太郎', 25, '東京')}</p>`);
        results.push(`<p>${introduce('花子', 30, '大阪')}</p>`);
        
        output.innerHTML = results.join('');
        
        // コンソールで確認
        console.log('=== 関数に引数を設定する ===');
        console.log('引数を使うことで、関数を柔軟に使えます');
    </script>
</body>
</html>
```

---

## 関数の定義2 関数式

関数式は、変数に代入する形で関数を定義する方法です。

### 関数式の構文

```javascript
const 変数名 = function() {
    // 処理
};
```

### 基本的な使い方

```javascript
const greet = function() {
    console.log('こんにちは！');
};

greet(); // こんにちは！
```

### 関数式の特徴

1. **ホイスティングされない**: 定義の前では呼び出せない
2. **変数に代入**: 変数として扱える

```javascript
// エラーになる（定義の前では呼び出せない）
// greet(); // ReferenceError

const greet = function() {
    console.log('こんにちは！');
};

greet(); // こんにちは！（定義の後なら呼び出せる）
```

### 実践例: 関数式

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>関数式</title>
</head>
<body>
    <h1>関数式</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        let results = [];
        
        // 基本的な関数式
        const greet = function() {
            return 'こんにちは！';
        };
        
        results.push('<h2>基本的な関数式</h2>');
        results.push(`<p>${greet()}</p>`);
        
        // 引数を受け取る関数式
        const introduce = function(name, age) {
            return `私は${name}です。${age}歳です。`;
        };
        
        results.push('<h2>引数を受け取る関数式</h2>');
        results.push(`<p>${introduce('太郎', 25)}</p>`);
        
        // 戻り値を返す関数式
        const add = function(a, b) {
            return a + b;
        };
        
        results.push('<h2>戻り値を返す関数式</h2>');
        results.push(`<p>10 + 20 = ${add(10, 20)}</p>`);
        
        // 関数式を変数に再代入
        results.push('<h2>関数式を変数に再代入</h2>');
        
        let calculate = function(a, b) {
            return a + b;
        };
        results.push(`<p>足し算: ${calculate(10, 5)}</p>`);
        
        calculate = function(a, b) {
            return a * b;
        };
        results.push(`<p>掛け算: ${calculate(10, 5)}</p>`);
        
        output.innerHTML = results.join('');
        
        // コンソールで確認
        console.log('=== 関数式 ===');
        console.log('変数に代入する形で関数を定義します');
        console.log('定義の前では呼び出せません（ホイスティングされない）');
    </script>
</body>
</html>
```

---

## 関数宣言と関数式の違い

関数宣言と関数式には、いくつかの違いがあります。

### 主な違い

| 項目 | 関数宣言 | 関数式 |
|------|---------|--------|
| **構文** | `function name() {}` | `const name = function() {}` |
| **ホイスティング** | される（定義前でも呼び出せる） | されない（定義後でないと呼び出せない） |
| **再代入** | できない | できる |

### ホイスティングの違い

```javascript
// 関数宣言: 定義の前でも呼び出せる
greet(); // こんにちは！（エラーにならない）

function greet() {
    console.log('こんにちは！');
}

// 関数式: 定義の前では呼び出せない
// sayHello(); // ReferenceError（エラーになる）

const sayHello = function() {
    console.log('こんにちは！');
};

sayHello(); // こんにちは！（定義の後なら呼び出せる）
```

### 実践例: 関数宣言と関数式の違い

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>関数宣言と関数式の違い</title>
</head>
<body>
    <h1>関数宣言と関数式の違い</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        let results = [];
        
        // ホイスティングの違い
        results.push('<h2>ホイスティングの違い</h2>');
        
        // 関数宣言: 定義の前でも呼び出せる
        const result1 = functionDeclaration();
        results.push(`<p>関数宣言（定義前）: ${result1}</p>`);
        
        function functionDeclaration() {
            return '関数宣言は定義前でも呼び出せます';
        }
        
        // 関数式: 定義の前では呼び出せない（コメントアウト）
        // const result2 = functionExpression(); // ReferenceError
        
        const functionExpression = function() {
            return '関数式は定義後でないと呼び出せません';
        };
        
        const result2 = functionExpression();
        results.push(`<p>関数式（定義後）: ${result2}</p>`);
        
        // 再代入の違い
        results.push('<h2>再代入の違い</h2>');
        
        // 関数式は再代入できる
        let myFunction = function() {
            return '最初の関数';
        };
        results.push(`<p>関数式（最初）: ${myFunction()}</p>`);
        
        myFunction = function() {
            return '再代入された関数';
        };
        results.push(`<p>関数式（再代入後）: ${myFunction()}</p>`);
        
        output.innerHTML = results.join('');
        
        // コンソールで確認
        console.log('=== 関数宣言と関数式の違い ===');
        console.log('関数宣言: ホイスティングされる');
        console.log('関数式: ホイスティングされない');
    </script>
</body>
</html>
```

---

## アロー関数の記法

アロー関数は、関数をより簡潔に書くことができる記法です。

### アロー関数の基本構文

```javascript
// 通常の関数式
const greet = function() {
    return 'こんにちは！';
};

// アロー関数
const greet = () => {
    return 'こんにちは！';
};
```

### 様々な書き方

#### 1. 引数がない場合
```javascript
const greet = () => {
    return 'こんにちは！';
};
```

#### 2. 引数が1つの場合（括弧を省略可能）
```javascript
const double = (n) => {
    return n * 2;
};

// 括弧を省略
const double = n => {
    return n * 2;
};
```

#### 3. 引数が複数の場合
```javascript
const add = (a, b) => {
    return a + b;
};
```

#### 4. 処理が1行の場合（returnを省略可能）
```javascript
const add = (a, b) => a + b;
```

### 実践例: アロー関数

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>アロー関数</title>
</head>
<body>
    <h1>アロー関数</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        let results = [];
        
        // 引数がない場合
        const greet = () => {
            return 'こんにちは！';
        };
        
        results.push('<h2>引数がない場合</h2>');
        results.push(`<p>${greet()}</p>`);
        
        // 引数が1つの場合
        const double = (n) => {
            return n * 2;
        };
        
        results.push('<h2>引数が1つの場合</h2>');
        results.push(`<p>5の2倍: ${double(5)}</p>`);
        
        // 引数が複数の場合
        const add = (a, b) => {
            return a + b;
        };
        
        results.push('<h2>引数が複数の場合</h2>');
        results.push(`<p>10 + 20 = ${add(10, 20)}</p>`);
        
        // 処理が1行の場合（returnを省略）
        const multiply = (a, b) => a * b;
        
        results.push('<h2>処理が1行の場合（returnを省略）</h2>');
        results.push(`<p>10 × 5 = ${multiply(10, 5)}</p>`);
        
        // 実践例: 配列の処理
        results.push('<h2>実践例: 配列の処理</h2>');
        
        const numbers = [1, 2, 3, 4, 5];
        const doubled = numbers.map(n => n * 2);
        
        results.push(`<p>元の配列: [${numbers.join(', ')}]</p>`);
        results.push(`<p>2倍にした配列: [${doubled.join(', ')}]</p>`);
        
        output.innerHTML = results.join('');
        
        // コンソールで確認
        console.log('=== アロー関数 ===');
        console.log('関数をより簡潔に書けます');
    </script>
</body>
</html>
```

---

## デフォルト引数

デフォルト引数は、引数が渡されなかった場合のデフォルト値を設定できます。

### デフォルト引数の基本

```javascript
function greet(name = 'ゲスト') {
    console.log('こんにちは、' + name + 'さん！');
}

greet('太郎');  // こんにちは、太郎さん！
greet();        // こんにちは、ゲストさん！（デフォルト値が使われる）
```

### 複数のデフォルト引数

```javascript
function introduce(name = 'ゲスト', age = 0) {
    console.log(`私は${name}です。${age}歳です。`);
}

introduce('太郎', 25);  // 私は太郎です。25歳です。
introduce('太郎');      // 私は太郎です。0歳です。
introduce();            // 私はゲストです。0歳です。
```

### 実践例: デフォルト引数

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>デフォルト引数</title>
</head>
<body>
    <h1>デフォルト引数</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        let results = [];
        
        // 基本的なデフォルト引数
        function greet(name = 'ゲスト') {
            return `こんにちは、${name}さん！`;
        }
        
        results.push('<h2>基本的なデフォルト引数</h2>');
        results.push(`<p>${greet('太郎')}</p>`);
        results.push(`<p>${greet()}（引数なし）</p>`);
        
        // 複数のデフォルト引数
        function introduce(name = 'ゲスト', age = 0) {
            return `私は${name}です。${age}歳です。`;
        }
        
        results.push('<h2>複数のデフォルト引数</h2>');
        results.push(`<p>${introduce('太郎', 25)}</p>`);
        results.push(`<p>${introduce('太郎')}（ageがデフォルト値）</p>`);
        results.push(`<p>${introduce()}（両方デフォルト値）</p>`);
        
        // 実践例: 計算関数
        function calculate(a, b, operation = '+') {
            if (operation === '+') {
                return a + b;
            } else if (operation === '-') {
                return a - b;
            } else if (operation === '*') {
                return a * b;
            } else if (operation === '/') {
                return a / b;
            }
        }
        
        results.push('<h2>実践例: 計算関数</h2>');
        results.push(`<p>10 + 5 = ${calculate(10, 5)}（デフォルトは+）</p>`);
        results.push(`<p>10 - 5 = ${calculate(10, 5, '-')}</p>`);
        results.push(`<p>10 × 5 = ${calculate(10, 5, '*')}</p>`);
        
        output.innerHTML = results.join('');
        
        // コンソールで確認
        console.log('=== デフォルト引数 ===');
        console.log('引数が渡されなかった場合のデフォルト値を設定できます');
    </script>
</body>
</html>
```

---

## コールバック関数

コールバック関数は、他の関数に引数として渡される関数です。

### コールバック関数の基本

```javascript
function greet(name, callback) {
    console.log('こんにちは、' + name + 'さん！');
    callback();  // コールバック関数を呼び出す
}

function sayGoodbye() {
    console.log('さようなら！');
}

greet('太郎', sayGoodbye);
// こんにちは、太郎さん！
// さようなら！
```

### 実践例: コールバック関数

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>コールバック関数</title>
</head>
<body>
    <h1>コールバック関数</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        let results = [];
        
        // 基本的なコールバック関数
        function processData(data, callback) {
            const result = data * 2;
            callback(result);
        }
        
        function showResult(result) {
            results.push(`<p>結果: ${result}</p>`);
        }
        
        results.push('<h2>基本的なコールバック関数</h2>');
        processData(10, showResult);
        
        // アロー関数をコールバックとして使う
        results.push('<h2>アロー関数をコールバックとして使う</h2>');
        
        const numbers = [1, 2, 3, 4, 5];
        const doubled = numbers.map(n => n * 2);
        results.push(`<p>元の配列: [${numbers.join(', ')}]</p>`);
        results.push(`<p>2倍にした配列: [${doubled.join(', ')}]</p>`);
        
        // 実践例: 配列のフィルタリング
        results.push('<h2>実践例: 配列のフィルタリング</h2>');
        
        const scores = [85, 90, 45, 78, 92, 55];
        const passed = scores.filter(score => score >= 60);
        
        results.push(`<p>全点数: [${scores.join(', ')}]</p>`);
        results.push(`<p>合格点（60点以上）: [${passed.join(', ')}]</p>`);
        
        // 実践例: 非同期処理のシミュレーション
        results.push('<h2>実践例: 非同期処理のシミュレーション</h2>');
        
        function fetchData(callback) {
            setTimeout(() => {
                const data = 'データを取得しました';
                callback(data);
            }, 1000);
        }
        
        fetchData((data) => {
            results.push(`<p>${data}</p>`);
            output.innerHTML = results.join('');
        });
        
        // 即座に表示（非同期処理の結果は後で追加される）
        output.innerHTML = results.join('');
        
        // コンソールで確認
        console.log('=== コールバック関数 ===');
        console.log('関数を引数として渡すことができます');
    </script>
</body>
</html>
```

---

## メソッドとラッパーオブジェクト

メソッドは、オブジェクトに属する関数です。

### メソッドの基本

```javascript
const person = {
    name: '太郎',
    age: 25,
    greet: function() {
        console.log('こんにちは、' + this.name + 'さん！');
    }
};

person.greet(); // こんにちは、太郎さん！
```

### ラッパーオブジェクト

JavaScriptでは、プリミティブ型（文字列、数値など）も、一時的にオブジェクトとして扱われます。

```javascript
const str = 'Hello';
console.log(str.length);        // 5
console.log(str.toUpperCase()); // 'HELLO'
```

### 実践例: メソッドとラッパーオブジェクト

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>メソッドとラッパーオブジェクト</title>
</head>
<body>
    <h1>メソッドとラッパーオブジェクト</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        let results = [];
        
        // オブジェクトのメソッド
        const person = {
            name: '太郎',
            age: 25,
            greet: function() {
                return `こんにちは、${this.name}さん！`;
            },
            getAge: function() {
                return `${this.age}歳です`;
            }
        };
        
        results.push('<h2>オブジェクトのメソッド</h2>');
        results.push(`<p>${person.greet()}</p>`);
        results.push(`<p>${person.getAge()}</p>`);
        
        // 文字列のメソッド（ラッパーオブジェクト）
        results.push('<h2>文字列のメソッド</h2>');
        
        const text = 'Hello, World!';
        results.push(`<p>元の文字列: ${text}</p>`);
        results.push(`<p>長さ: ${text.length}</p>`);
        results.push(`<p>大文字: ${text.toUpperCase()}</p>`);
        results.push(`<p>小文字: ${text.toLowerCase()}</p>`);
        results.push(`<p>置換: ${text.replace('World', 'JavaScript')}</p>`);
        
        // 数値のメソッド（ラッパーオブジェクト）
        results.push('<h2>数値のメソッド</h2>');
        
        const num = 3.14159;
        results.push(`<p>元の数値: ${num}</p>`);
        results.push(`<p>固定小数点: ${num.toFixed(2)}</p>`);
        results.push(`<p>指数表記: ${num.toExponential(2)}</p>`);
        
        // 配列のメソッド
        results.push('<h2>配列のメソッド</h2>');
        
        const arr = [1, 2, 3, 4, 5];
        results.push(`<p>元の配列: [${arr.join(', ')}]</p>`);
        results.push(`<p>長さ: ${arr.length}</p>`);
        results.push(`<p>最初の要素: ${arr[0]}</p>`);
        results.push(`<p>最後の要素: ${arr[arr.length - 1]}</p>`);
        
        output.innerHTML = results.join('');
        
        // コンソールで確認
        console.log('=== メソッドとラッパーオブジェクト ===');
        console.log('オブジェクトに属する関数をメソッドと呼びます');
        console.log('プリミティブ型も一時的にオブジェクトとして扱われます');
    </script>
</body>
</html>
```

---

## 高階関数とreduceメソッド

高階関数は、関数を引数として受け取る、または関数を返す関数です。

### 高階関数の例

```javascript
// map: 各要素を変換
const numbers = [1, 2, 3, 4, 5];
const doubled = numbers.map(n => n * 2);
console.log(doubled); // [2, 4, 6, 8, 10]

// filter: 条件に合う要素を抽出
const evens = numbers.filter(n => n % 2 === 0);
console.log(evens); // [2, 4]

// reduce: 配列を1つの値に集約
const sum = numbers.reduce((acc, n) => acc + n, 0);
console.log(sum); // 15
```

### reduceメソッドの詳細

`reduce`メソッドは、配列を1つの値に集約します。

```javascript
配列.reduce((累積値, 現在の値) => {
    return 累積値と現在の値を使った計算;
}, 初期値);
```

### 実践例: 高階関数とreduceメソッド

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>高階関数とreduceメソッド</title>
</head>
<body>
    <h1>高階関数とreduceメソッド</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        let results = [];
        
        const numbers = [1, 2, 3, 4, 5];
        
        // map: 各要素を変換
        results.push('<h2>map: 各要素を変換</h2>');
        const doubled = numbers.map(n => n * 2);
        results.push(`<p>元の配列: [${numbers.join(', ')}]</p>`);
        results.push(`<p>2倍にした配列: [${doubled.join(', ')}]</p>`);
        
        // filter: 条件に合う要素を抽出
        results.push('<h2>filter: 条件に合う要素を抽出</h2>');
        const evens = numbers.filter(n => n % 2 === 0);
        results.push(`<p>元の配列: [${numbers.join(', ')}]</p>`);
        results.push(`<p>偶数のみ: [${evens.join(', ')}]</p>`);
        
        // reduce: 配列を1つの値に集約
        results.push('<h2>reduce: 配列を1つの値に集約</h2>');
        
        // 合計を計算
        const sum = numbers.reduce((acc, n) => acc + n, 0);
        results.push(`<p>合計: ${sum}</p>`);
        
        // 最大値を求める
        const max = numbers.reduce((acc, n) => n > acc ? n : acc, numbers[0]);
        results.push(`<p>最大値: ${max}</p>`);
        
        // 実践例: オブジェクトの配列を処理
        results.push('<h2>実践例: オブジェクトの配列を処理</h2>');
        
        const items = [
            { name: 'りんご', price: 100 },
            { name: 'バナナ', price: 150 },
            { name: 'オレンジ', price: 120 }
        ];
        
        // 合計金額を計算
        const total = items.reduce((acc, item) => acc + item.price, 0);
        results.push(`<p>商品の合計金額: ${total}円</p>`);
        
        // 商品名のリストを作成
        const names = items.map(item => item.name);
        results.push(`<p>商品名: ${names.join(', ')}</p>`);
        
        output.innerHTML = results.join('');
        
        // コンソールで確認
        console.log('=== 高階関数とreduceメソッド ===');
        console.log('関数を引数として受け取る関数を高階関数と呼びます');
        console.log('reduceメソッドで配列を1つの値に集約できます');
    </script>
</body>
</html>
```

---

## まとめ

この章では、関数について学びました。

### 学んだこと
- 関数の概念と使い方
- 関数の定義と呼び出し
- 引数と戻り値
- 関数宣言と関数式の違い
- アロー関数の記法
- デフォルト引数
- コールバック関数
- メソッドとラッパーオブジェクト
- 高階関数とreduceメソッド

### 重要なポイント
1. **関数でコードを再利用**: 同じ処理を何度も書かなくてよい
2. **引数で柔軟に**: 関数に値を渡して、様々な処理ができる
3. **戻り値で結果を受け取る**: `return`文で値を返す
4. **アロー関数で簡潔に**: 関数をより簡潔に書ける
5. **高階関数で配列を処理**: `map`, `filter`, `reduce`など

### 次のステップ
次の章では、スコープについて詳しく学びます。

---

## 演習問題

### 問題1: 基本的な関数
挨拶をする関数`greet`を作成し、呼び出してください。

<details>
<summary>解答例</summary>

```javascript
function greet() {
    console.log('こんにちは！');
}

greet(); // こんにちは！
```
</details>

### 問題2: 引数を受け取る関数
2つの数値を受け取り、その合計を返す関数`add`を作成してください。

<details>
<summary>解答例</summary>

```javascript
function add(a, b) {
    return a + b;
}

console.log(add(10, 20)); // 30
```
</details>

### 問題3: アロー関数
数値を2倍にする関数を、アロー関数で作成してください。

<details>
<summary>解答例</summary>

```javascript
const double = (n) => n * 2;

console.log(double(5)); // 10
```
</details>

### 問題4: デフォルト引数
名前を受け取り、挨拶をする関数を作成してください。名前が渡されない場合は「ゲスト」をデフォルト値として使ってください。

<details>
<summary>解答例</summary>

```javascript
function greet(name = 'ゲスト') {
    return `こんにちは、${name}さん！`;
}

console.log(greet('太郎')); // こんにちは、太郎さん！
console.log(greet());       // こんにちは、ゲストさん！
```
</details>

### 問題5: 高階関数
配列`[1, 2, 3, 4, 5]`の各要素を2倍にして、新しい配列を作成してください。`map`メソッドを使います。

<details>
<summary>解答例</summary>

```javascript
const numbers = [1, 2, 3, 4, 5];
const doubled = numbers.map(n => n * 2);

console.log(doubled); // [2, 4, 6, 8, 10]
```
</details>

---

お疲れ様でした！次の章に進みましょう。

