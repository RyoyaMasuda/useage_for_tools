# 3-1. ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ä»•çµ„ã¿

ã“ã®ç« ã§ã¯ã€Next.jsã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ä»•çµ„ã¿ã«ã¤ã„ã¦å­¦ã³ã¾ã™ã€‚Server Componentã¨Client Componentã®é•ã„ã‚’ç†è§£ã—ã€é©åˆ‡ã«ä½¿ã„åˆ†ã‘ã‚‹ã“ã¨ã§ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®é«˜ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚

---

## ç›®æ¬¡

- [ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¨ã¯](#ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¨ã¯)
- [Server Componentã¨Client Componentã®é•ã„ã¨ä½¿ã„åˆ†ã‘](#server-componentã¨client-componentã®é•ã„ã¨ä½¿ã„åˆ†ã‘)
- [å¢ƒç•Œç·š (Boundary) ã®è¨­è¨ˆ](#å¢ƒç•Œç·š-boundary-ã®è¨­è¨ˆ)
- [Routeã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ—ãƒ­ã‚»ã‚¹](#routeã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ—ãƒ­ã‚»ã‚¹)
- [ã¾ã¨ã‚](#ã¾ã¨ã‚)
- [æ¼”ç¿’å•é¡Œ](#æ¼”ç¿’å•é¡Œ)

---

## ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¨ã¯

### ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¨ã¯
ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¯ã€**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’HTMLã«å¤‰æ›ã™ã‚‹å‡¦ç†**ã§ã™ã€‚Next.jsã§ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®ä¸¡æ–¹ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒè¡Œã‚ã‚Œã¾ã™ã€‚

### ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ç¨®é¡

#### 1. ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° (SSR)
ã‚µãƒ¼ãƒãƒ¼ã§HTMLã‚’ç”Ÿæˆã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã—ã¾ã™ã€‚

#### 2. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° (CSR)
ãƒ–ãƒ©ã‚¦ã‚¶ã§JavaScriptã‚’å®Ÿè¡Œã—ã€HTMLã‚’ç”Ÿæˆã—ã¾ã™ã€‚

#### 3. é™çš„ã‚µã‚¤ãƒˆç”Ÿæˆ (SSG)
ãƒ“ãƒ«ãƒ‰æ™‚ã«HTMLã‚’ç”Ÿæˆã—ã€äº‹å‰ã«ç”¨æ„ã•ã‚ŒãŸHTMLã‚’é…ä¿¡ã—ã¾ã™ã€‚

### Next.jsã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æˆ¦ç•¥
Next.jsã§ã¯ã€**Server Componentã¨Client Componentã‚’çµ„ã¿åˆã‚ã›ã‚‹**ã“ã¨ã§ã€æœ€é©ãªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æˆ¦ç•¥ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

---

## Server Componentã¨Client Componentã®é•ã„ã¨ä½¿ã„åˆ†ã‘

### Server Componentã¨ã¯
Server Componentã¯ã€**ã‚µãƒ¼ãƒãƒ¼ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**ã§ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€ã™ã¹ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯Server Componentã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚

#### Server Componentã®ç‰¹å¾´
- **ã‚µãƒ¼ãƒãƒ¼ã§å®Ÿè¡Œ**: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã®ã¿å®Ÿè¡Œã•ã‚Œã‚‹
- **ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã«å«ã¾ã‚Œãªã„**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã•ã‚Œãªã„ãŸã‚ã€ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºãŒå°ã•ããªã‚‹
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹**: ã‚µãƒ¼ãƒãƒ¼ã§ç›´æ¥ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹
- **APIã‚­ãƒ¼ã®ä½¿ç”¨**: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã®ã¿ä½¿ç”¨ã•ã‚Œã‚‹APIã‚­ãƒ¼ã‚’ä½¿ç”¨ã§ãã‚‹
- **ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªæ©Ÿèƒ½ã¯ä½¿ç”¨ä¸å¯**: ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚„useStateãªã©ã®ãƒ•ãƒƒã‚¯ã¯ä½¿ç”¨ã§ããªã„

### Client Componentã¨ã¯
Client Componentã¯ã€**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**ã§ã™ã€‚`'use client'`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’ä½¿ç”¨ã—ã¦æ˜ç¤ºçš„ã«æŒ‡å®šã—ã¾ã™ã€‚

#### Client Componentã®ç‰¹å¾´
- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§å®Ÿè¡Œ**: ãƒ–ãƒ©ã‚¦ã‚¶ã§JavaScriptãŒå®Ÿè¡Œã•ã‚Œã‚‹
- **ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã«å«ã¾ã‚Œã‚‹**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã•ã‚Œã‚‹ãŸã‚ã€ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãããªã‚‹
- **ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªæ©Ÿèƒ½ãŒä½¿ç”¨å¯èƒ½**: ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚„useStateãªã©ã®ãƒ•ãƒƒã‚¯ãŒä½¿ç”¨ã§ãã‚‹
- **ãƒ–ãƒ©ã‚¦ã‚¶APIã®ä½¿ç”¨**: windowã€localStorageãªã©ã®ãƒ–ãƒ©ã‚¦ã‚¶APIãŒä½¿ç”¨ã§ãã‚‹

### Server Componentã®å®Ÿè·µä¾‹

```typescript
// src/app/users/page.tsx
// Server Componentï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
import prisma from '@/lib/prisma'

// ã‚µãƒ¼ãƒãƒ¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
async function getUsers() {
  const users = await prisma.user.findMany()
  return users
}

export default async function UsersPage() {
  // ã‚µãƒ¼ãƒãƒ¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  const users = await getUsers()

  return (
    <div>
      <h1>Users</h1>
      <ul>
        {users.map((user) => (
          <li key={user.id}>
            {user.name} ({user.email})
          </li>
        ))}
      </ul>
    </div>
  )
}
```

### Client Componentã®å®Ÿè·µä¾‹

```typescript
// src/components/Counter.tsx
'use client'  // Client Componentã¨ã—ã¦æ˜ç¤º

import { useState } from 'react'

export default function Counter() {
  const [count, setCount] = useState(0)

  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={() => setCount(count + 1)}>
        Increment
      </button>
    </div>
  )
}
```

### ä½¿ã„åˆ†ã‘ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

#### Server Componentã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ
- **ãƒ‡ãƒ¼ã‚¿å–å¾—**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹
- **æ©Ÿå¯†æƒ…å ±ã®å‡¦ç†**: APIã‚­ãƒ¼ã‚„èªè¨¼æƒ…å ±ã‚’æ‰±ã†
- **å¤§ããªä¾å­˜é–¢ä¿‚**: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã®ã¿ä½¿ç”¨ã•ã‚Œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹
- **é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„**: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªæ©Ÿèƒ½ãŒä¸è¦ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„

#### Client Componentã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ
- **ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªæ©Ÿèƒ½**: ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã€ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ãªã©ã®ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
- **çŠ¶æ…‹ç®¡ç†**: useStateã€useReducerãªã©ã®ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹
- **ãƒ–ãƒ©ã‚¦ã‚¶API**: windowã€localStorageã€navigatorãªã©ã®ãƒ–ãƒ©ã‚¦ã‚¶APIã‚’ä½¿ç”¨ã™ã‚‹
- **ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ**: useEffectã€useLayoutEffectãªã©ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹

### å®Ÿè·µä¾‹: Server Componentã¨Client Componentã®çµ„ã¿åˆã‚ã›

```typescript
// src/app/posts/page.tsx
// Server Component
import prisma from '@/lib/prisma'
import SearchBar from '@/components/SearchBar'
import PostList from '@/components/PostList'

async function getPosts() {
  const posts = await prisma.post.findMany({
    include: {
      author: true,
    },
  })
  return posts
}

export default async function PostsPage() {
  // ã‚µãƒ¼ãƒãƒ¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  const posts = await getPosts()

  return (
    <div>
      <h1>Posts</h1>
      {/* Client Componentã‚’ä½¿ç”¨ */}
      <SearchBar />
      {/* Server Componentã«ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ */}
      <PostList initialPosts={posts} />
    </div>
  )
}
```

```typescript
// src/components/SearchBar.tsx
'use client'  // Client Component

import { useState } from 'react'

export default function SearchBar() {
  const [query, setQuery] = useState('')

  return (
    <input
      type="text"
      value={query}
      onChange={(e) => setQuery(e.target.value)}
      placeholder="Search posts..."
    />
  )
}
```

```typescript
// src/components/PostList.tsx
// Server Componentï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
interface Post {
  id: number
  title: string
  content: string
  author: {
    name: string
  }
}

interface PostListProps {
  initialPosts: Post[]
}

export default function PostList({ initialPosts }: PostListProps) {
  return (
    <ul>
      {initialPosts.map((post) => (
        <li key={post.id}>
          <h2>{post.title}</h2>
          <p>{post.content}</p>
          <p>By {post.author.name}</p>
        </li>
      ))}
    </ul>
  )
}
```

### å®Ÿè·µä¾‹: ãƒ‡ãƒ¼ã‚¿å–å¾—ã®æ¯”è¼ƒ

#### Server Componentã§ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆæ¨å¥¨ï¼‰

```typescript
// src/app/products/page.tsx
// Server Component
import prisma from '@/lib/prisma'

export default async function ProductsPage() {
  // ã‚µãƒ¼ãƒãƒ¼ã§ç›´æ¥ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹
  const products = await prisma.product.findMany()

  return (
    <div>
      <h1>Products</h1>
      <ul>
        {products.map((product) => (
          <li key={product.id}>{product.name}</li>
        ))}
      </ul>
    </div>
  )
}
```

#### Client Componentã§ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆéæ¨å¥¨ï¼‰

```typescript
// src/app/products/page.tsx
'use client'  // Client Component

import { useEffect, useState } from 'react'

export default function ProductsPage() {
  const [products, setProducts] = useState([])

  useEffect(() => {
    // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰APIã‚’å‘¼ã³å‡ºã™ï¼ˆéåŠ¹ç‡ï¼‰
    fetch('/api/products')
      .then((res) => res.json())
      .then((data) => setProducts(data))
  }, [])

  return (
    <div>
      <h1>Products</h1>
      <ul>
        {products.map((product) => (
          <li key={product.id}>{product.name}</li>
        ))}
      </ul>
    </div>
  )
}
```

---

## å¢ƒç•Œç·š (Boundary) ã®è¨­è¨ˆ

### å¢ƒç•Œç·šã¨ã¯
å¢ƒç•Œç·šï¼ˆBoundaryï¼‰ã¯ã€**Server Componentã¨Client Componentã®å¢ƒç•Œ**ã§ã™ã€‚é©åˆ‡ã«å¢ƒç•Œç·šã‚’è¨­è¨ˆã™ã‚‹ã“ã¨ã§ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€é©åŒ–ã§ãã¾ã™ã€‚

### å¢ƒç•Œç·šã®è¨­è¨ˆåŸå‰‡

#### 1. Client Componentã‚’æœ€å°é™ã«
Client Componentã¯å¿…è¦æœ€å°é™ã«ã—ã€**ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªéƒ¨åˆ†ã®ã¿ã‚’Client Componentã«ã™ã‚‹**ã“ã¨ãŒé‡è¦ã§ã™ã€‚

#### 2. å¢ƒç•Œç·šã‚’ä¸‹ã«é…ç½®
Client Componentã¯ã€**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ„ãƒªãƒ¼ã®ä¸‹ã®æ–¹ã«é…ç½®**ã™ã‚‹ã“ã¨ã§ã€Server Componentã®ç¯„å›²ã‚’æœ€å¤§åŒ–ã§ãã¾ã™ã€‚

#### 3. ãƒ‡ãƒ¼ã‚¿å–å¾—ã¯Server Componentã§
ãƒ‡ãƒ¼ã‚¿å–å¾—ã¯**Server Componentã§è¡Œã„ã€Client Componentã«ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™**ã‚ˆã†ã«ã—ã¾ã™ã€‚

### å®Ÿè·µä¾‹: è‰¯ã„å¢ƒç•Œç·šã®è¨­è¨ˆ

```typescript
// src/app/dashboard/page.tsx
// Server Component
import prisma from '@/lib/prisma'
import UserProfile from '@/components/UserProfile'
import InteractiveChart from '@/components/InteractiveChart'

async function getDashboardData() {
  const [users, posts, stats] = await Promise.all([
    prisma.user.findMany(),
    prisma.post.findMany(),
    prisma.post.aggregate({
      _count: true,
    }),
  ])

  return { users, posts, stats }
}

export default async function DashboardPage() {
  // ã‚µãƒ¼ãƒãƒ¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  const { users, posts, stats } = await getDashboardData()

  return (
    <div>
      <h1>Dashboard</h1>
      {/* Server Component: ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º */}
      <UserProfile users={users} />
      {/* Client Component: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªæ©Ÿèƒ½ */}
      <InteractiveChart data={stats} />
    </div>
  )
}
```

```typescript
// src/components/UserProfile.tsx
// Server Componentï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
interface User {
  id: number
  name: string
  email: string
}

interface UserProfileProps {
  users: User[]
}

export default function UserProfile({ users }: UserProfileProps) {
  return (
    <div>
      <h2>Users</h2>
      <ul>
        {users.map((user) => (
          <li key={user.id}>
            {user.name} ({user.email})
          </li>
        ))}
      </ul>
    </div>
  )
}
```

```typescript
// src/components/InteractiveChart.tsx
'use client'  // Client Component

import { useState } from 'react'

interface InteractiveChartProps {
  data: {
    _count: number
  }
}

export default function InteractiveChart({ data }: InteractiveChartProps) {
  const [selectedPeriod, setSelectedPeriod] = useState('week')

  return (
    <div>
      <select
        value={selectedPeriod}
        onChange={(e) => setSelectedPeriod(e.target.value)}
      >
        <option value="week">Week</option>
        <option value="month">Month</option>
        <option value="year">Year</option>
      </select>
      <p>Total Posts: {data._count}</p>
    </div>
  )
}
```

### å®Ÿè·µä¾‹: æ‚ªã„å¢ƒç•Œç·šã®è¨­è¨ˆï¼ˆéæ¨å¥¨ï¼‰

```typescript
// âŒ æ‚ªã„ä¾‹: å…¨ä½“ã‚’Client Componentã«ã™ã‚‹
'use client'

import { useEffect, useState } from 'react'

export default function DashboardPage() {
  const [data, setData] = useState(null)

  useEffect(() => {
    fetch('/api/dashboard')
      .then((res) => res.json())
      .then((data) => setData(data))
  }, [])

  if (!data) return <div>Loading...</div>

  return (
    <div>
      <h1>Dashboard</h1>
      {/* ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã§ãªã„éƒ¨åˆ†ã‚‚Client Componentã«ãªã£ã¦ã„ã‚‹ */}
      <UserList users={data.users} />
      <InteractiveChart data={data.stats} />
    </div>
  )
}
```

### å®Ÿè·µä¾‹: è‰¯ã„å¢ƒç•Œç·šã®è¨­è¨ˆï¼ˆæ¨å¥¨ï¼‰

```typescript
// âœ… è‰¯ã„ä¾‹: Server Componentã¨Client Componentã‚’é©åˆ‡ã«åˆ†é›¢
// src/app/dashboard/page.tsx
// Server Component
import prisma from '@/lib/prisma'
import UserList from '@/components/UserList'
import InteractiveChart from '@/components/InteractiveChart'

async function getDashboardData() {
  const [users, stats] = await Promise.all([
    prisma.user.findMany(),
    prisma.post.aggregate({
      _count: true,
    }),
  ])

  return { users, stats }
}

export default async function DashboardPage() {
  const { users, stats } = await getDashboardData()

  return (
    <div>
      <h1>Dashboard</h1>
      {/* Server Component: ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º */}
      <UserList users={users} />
      {/* Client Component: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªæ©Ÿèƒ½ã®ã¿ */}
      <InteractiveChart data={stats} />
    </div>
  )
}
```

### å®Ÿè·µä¾‹: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆ†å‰²

```typescript
// src/components/ProductCard.tsx
// Server Componentï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
interface Product {
  id: number
  name: string
  price: number
  description: string
}

interface ProductCardProps {
  product: Product
}

export default function ProductCard({ product }: ProductCardProps) {
  return (
    <div>
      <h3>{product.name}</h3>
      <p>{product.description}</p>
      <p>Price: ${product.price}</p>
      {/* Client Component: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªéƒ¨åˆ†ã®ã¿ */}
      <AddToCartButton productId={product.id} />
    </div>
  )
}
```

```typescript
// src/components/AddToCartButton.tsx
'use client'  // Client Component

import { useState } from 'react'

interface AddToCartButtonProps {
  productId: number
}

export default function AddToCartButton({ productId }: AddToCartButtonProps) {
  const [isAdding, setIsAdding] = useState(false)

  const handleAddToCart = async () => {
    setIsAdding(true)
    // ã‚«ãƒ¼ãƒˆã«è¿½åŠ ã™ã‚‹å‡¦ç†
    await fetch('/api/cart', {
      method: 'POST',
      body: JSON.stringify({ productId }),
    })
    setIsAdding(false)
  }

  return (
    <button onClick={handleAddToCart} disabled={isAdding}>
      {isAdding ? 'Adding...' : 'Add to Cart'}
    </button>
  )
}
```

---

## Routeã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ—ãƒ­ã‚»ã‚¹

### Routeã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ—ãƒ­ã‚»ã‚¹ã¨ã¯
Routeã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ—ãƒ­ã‚»ã‚¹ã¯ã€**Next.jsãŒãƒšãƒ¼ã‚¸ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹éš›ã®å‡¦ç†ã®æµã‚Œ**ã§ã™ã€‚

### ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ—ãƒ­ã‚»ã‚¹ã®æµã‚Œ

#### 1. ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å—ä¿¡
ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚

#### 2. Routeã®è§£æ±º
Next.jsãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸURLã«å¯¾å¿œã™ã‚‹Routeã‚’è§£æ±ºã—ã¾ã™ã€‚

#### 3. Server Componentã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
Server ComponentãŒã‚µãƒ¼ãƒãƒ¼ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã€HTMLãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

#### 4. Client Componentã®ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
Client ComponentãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã•ã‚Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ°´åŒ–ï¼‰ãŒè¡Œã‚ã‚Œã¾ã™ã€‚

### å®Ÿè·µä¾‹: ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ—ãƒ­ã‚»ã‚¹ã®å¯è¦–åŒ–

```typescript
// src/app/products/page.tsx
// Server Component
import prisma from '@/lib/prisma'
import ProductList from '@/components/ProductList'
import SearchBar from '@/components/SearchBar'

async function getProducts() {
  console.log('ğŸ”µ Server: ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...')
  const products = await prisma.product.findMany()
  console.log('ğŸ”µ Server: ãƒ‡ãƒ¼ã‚¿å–å¾—å®Œäº†')
  return products
}

export default async function ProductsPage() {
  console.log('ğŸ”µ Server: ProductsPage ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–‹å§‹')
  
  // ã‚µãƒ¼ãƒãƒ¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  const products = await getProducts()

  console.log('ğŸ”µ Server: ProductsPage ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å®Œäº†')

  return (
    <div>
      <h1>Products</h1>
      {/* Client Component */}
      <SearchBar />
      {/* Server Component */}
      <ProductList products={products} />
    </div>
  )
}
```

```typescript
// src/components/SearchBar.tsx
'use client'  // Client Component

import { useState, useEffect } from 'react'

export default function SearchBar() {
  const [query, setQuery] = useState('')

  useEffect(() => {
    console.log('ğŸŸ¢ Client: SearchBar ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†')
  }, [])

  return (
    <input
      type="text"
      value={query}
      onChange={(e) => setQuery(e.target.value)}
      placeholder="Search products..."
    />
  )
}
```

### å®Ÿè·µä¾‹: ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ç¢ºèª

```typescript
// src/app/example/page.tsx
// Server Component
export default async function ExamplePage() {
  // ã‚µãƒ¼ãƒãƒ¼ã§å®Ÿè¡Œã•ã‚Œã‚‹
  const serverTime = new Date().toISOString()

  return (
    <div>
      <h1>Example Page</h1>
      <p>Server Time: {serverTime}</p>
      <ClientTime />
    </div>
  )
}
```

```typescript
// src/components/ClientTime.tsx
'use client'  // Client Component

import { useState, useEffect } from 'react'

export default function ClientTime() {
  const [clientTime, setClientTime] = useState<string>('')

  useEffect(() => {
    // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§å®Ÿè¡Œã•ã‚Œã‚‹
    setClientTime(new Date().toISOString())
  }, [])

  return <p>Client Time: {clientTime}</p>
}
```

### å®Ÿè·µä¾‹: ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®æœ€é©åŒ–

```typescript
// src/app/optimized/page.tsx
// Server Component
import { Suspense } from 'react'
import prisma from '@/lib/prisma'
import UserList from '@/components/UserList'
import PostList from '@/components/PostList'

async function getUsers() {
  await new Promise((resolve) => setTimeout(resolve, 1000))
  return await prisma.user.findMany()
}

async function getPosts() {
  await new Promise((resolve) => setTimeout(resolve, 2000))
  return await prisma.post.findMany()
}

export default async function OptimizedPage() {
  return (
    <div>
      <h1>Optimized Page</h1>
      {/* Suspenseã‚’ä½¿ç”¨ã—ã¦ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° */}
      <Suspense fallback={<div>Loading users...</div>}>
        <UserListWrapper />
      </Suspense>
      <Suspense fallback={<div>Loading posts...</div>}>
        <PostListWrapper />
      </Suspense>
    </div>
  )
}

async function UserListWrapper() {
  const users = await getUsers()
  return <UserList users={users} />
}

async function PostListWrapper() {
  const posts = await getPosts()
  return <PostList posts={posts} />
}
```

---

## ã¾ã¨ã‚

ã“ã®ç« ã§ã¯ã€Next.jsã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ä»•çµ„ã¿ã«ã¤ã„ã¦å­¦ã³ã¾ã—ãŸã€‚

### å­¦ã‚“ã ã“ã¨
- Server Componentã¨Client Componentã®é•ã„ã¨ä½¿ã„åˆ†ã‘: ã‚µãƒ¼ãƒãƒ¼ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®é•ã„
- å¢ƒç•Œç·š (Boundary) ã®è¨­è¨ˆ: Server Componentã¨Client Componentã®é©åˆ‡ãªåˆ†é›¢
- Routeã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ—ãƒ­ã‚»ã‚¹: Next.jsãŒãƒšãƒ¼ã‚¸ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹éš›ã®å‡¦ç†ã®æµã‚Œ

### é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ
1. **Server Component**: ã‚µãƒ¼ãƒãƒ¼ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã€ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã«å«ã¾ã‚Œãªã„
2. **Client Component**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªæ©Ÿèƒ½ãŒä½¿ç”¨å¯èƒ½
3. **å¢ƒç•Œç·šã®è¨­è¨ˆ**: Client Componentã‚’æœ€å°é™ã«ã—ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ„ãƒªãƒ¼ã®ä¸‹ã«é…ç½®
4. **ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ—ãƒ­ã‚»ã‚¹**: Server ComponentãŒå…ˆã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã€ãã®å¾ŒClient ComponentãŒãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚Œã‚‹

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
æ¬¡ã®ç« ã§ã¯ã€Server Componentã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã«ã¤ã„ã¦è©³ã—ãå­¦ã³ã¾ã™ã€‚

---

## æ¼”ç¿’å•é¡Œ

### å•é¡Œ1: Server Componentã¨Client Componentã®è­˜åˆ¥
ä»¥ä¸‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã€Server Componentã¨Client Componentã«åˆ†é¡ã—ã¦ãã ã•ã„ã€‚

```typescript
// Component A
export default function ComponentA() {
  return <div>Hello</div>
}

// Component B
'use client'
export default function ComponentB() {
  const [count, setCount] = useState(0)
  return <button onClick={() => setCount(count + 1)}>{count}</button>
}

// Component C
export default async function ComponentC() {
  const data = await fetch('https://api.example.com/data')
  return <div>{data}</div>
}
```

<details>
<summary>è§£ç­”ä¾‹</summary>

- **Component A**: Server Componentï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- **Component B**: Client Componentï¼ˆ'use client'ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã¨useStateã‚’ä½¿ç”¨ï¼‰
- **Component C**: Server Componentï¼ˆasyncé–¢æ•°ã§ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼‰
</details>

### å•é¡Œ2: Server Componentã§ã®ãƒ‡ãƒ¼ã‚¿å–å¾—
Server Componentã‚’ä½¿ç”¨ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’å–å¾—ã—ã€è¡¨ç¤ºã™ã‚‹ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

<details>
<summary>è§£ç­”ä¾‹</summary>

```typescript
// src/app/users/page.tsx
import prisma from '@/lib/prisma'

export default async function UsersPage() {
  const users = await prisma.user.findMany()

  return (
    <div>
      <h1>Users</h1>
      <ul>
        {users.map((user) => (
          <li key={user.id}>
            {user.name} ({user.email})
          </li>
        ))}
      </ul>
    </div>
  )
}
```
</details>

### å•é¡Œ3: Client Componentã®å®Ÿè£…
Client Componentã‚’ä½¿ç”¨ã—ã¦ã€ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

<details>
<summary>è§£ç­”ä¾‹</summary>

```typescript
// src/components/Counter.tsx
'use client'

import { useState } from 'react'

export default function Counter() {
  const [count, setCount] = useState(0)

  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={() => setCount(count + 1)}>Increment</button>
      <button onClick={() => setCount(count - 1)}>Decrement</button>
    </div>
  )
}
```
</details>

### å•é¡Œ4: å¢ƒç•Œç·šã®è¨­è¨ˆ
Server Componentã¨Client Componentã‚’é©åˆ‡ã«åˆ†é›¢ã—ãŸã€å•†å“ä¸€è¦§ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚å•†å“ãƒ‡ãƒ¼ã‚¿ã¯Server Componentã§å–å¾—ã—ã€æ¤œç´¢æ©Ÿèƒ½ã¯Client Componentã§å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

<details>
<summary>è§£ç­”ä¾‹</summary>

```typescript
// src/app/products/page.tsx
import prisma from '@/lib/prisma'
import ProductList from '@/components/ProductList'
import SearchBar from '@/components/SearchBar'

async function getProducts() {
  return await prisma.product.findMany()
}

export default async function ProductsPage() {
  const products = await getProducts()

  return (
    <div>
      <h1>Products</h1>
      <SearchBar />
      <ProductList products={products} />
    </div>
  )
}
```

```typescript
// src/components/SearchBar.tsx
'use client'

import { useState } from 'react'

export default function SearchBar() {
  const [query, setQuery] = useState('')

  return (
    <input
      type="text"
      value={query}
      onChange={(e) => setQuery(e.target.value)}
      placeholder="Search products..."
    />
  )
}
```

```typescript
// src/components/ProductList.tsx
interface Product {
  id: number
  name: string
  price: number
}

interface ProductListProps {
  products: Product[]
}

export default function ProductList({ products }: ProductListProps) {
  return (
    <ul>
      {products.map((product) => (
        <li key={product.id}>
          {product.name} - ${product.price}
        </li>
      ))}
    </ul>
  )
}
```
</details>

### å•é¡Œ5: ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ—ãƒ­ã‚»ã‚¹ã®ç†è§£
Server Componentã¨Client Componentã‚’çµ„ã¿åˆã‚ã›ãŸãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

<details>
<summary>è§£ç­”ä¾‹</summary>

```typescript
// src/app/example/page.tsx
export default async function ExamplePage() {
  const serverTime = new Date().toISOString()

  return (
    <div>
      <h1>Example Page</h1>
      <p>Server Time: {serverTime}</p>
      <ClientTime />
    </div>
  )
}
```

```typescript
// src/components/ClientTime.tsx
'use client'

import { useState, useEffect } from 'react'

export default function ClientTime() {
  const [clientTime, setClientTime] = useState<string>('')

  useEffect(() => {
    setClientTime(new Date().toISOString())
  }, [])

  return <p>Client Time: {clientTime}</p>
}
```
</details>

---

ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼æ¬¡ã®ç« ã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚

