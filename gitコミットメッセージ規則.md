# Gitコミットメッセージの書き方

## 基本構造

コミットメッセージは以下の3つの部分から構成されます：

```
<件名>

<本文>

<フッター>
```

各セクションは空行で区切ります。

## 件名（1行目）

### ルール
1. **50文字以内**に収める
2. **何を変更したか**を簡潔に記述
3. **プレフィックス**をつけると分かりやすい

### 良い例
```
[追加] ユーザー認証機能を実装
[修正] ログイン時のnullエラーを解消
[更新] READMEにインストール手順を追加
[削除] 非推奨のAPI呼び出しを削除
[改善] 画像処理のパフォーマンスを向上
```

### 悪い例
```
修正  （何を修正したか不明）
ファイルを更新しました  （曖昧すぎる）
バグを直した  （どのバグか不明）
色々変更  （情報不足）
```

## 本文（2行目以降）

### ルール
1. **何を変更したか**（What）よりも**なぜ変更したか**（Why）と**どのように変更したか**（How）を説明
2. 箇条書きを使用しても良い
3. 必要に応じて背景や影響範囲も記載

### 例
```
[修正] 画像処理モジュールのメモリリークを解消

以前の実装では処理済み画像への参照がメモリに残り続け、
長時間の使用でメモリが圧迫される問題がありました。

変更内容：
- 処理後に画像キャッシュをクリアするよう修正
- 一時保存に弱参照を使用
- 明示的なガベージコレクションのヒントを追加

この修正により、長時間動作時のメモリ使用量が約60%削減されます。
```

## フッター

### 使用例
- **関連するIssueの参照**
- **破壊的変更の明示**
- **レビュアーや共同作成者の記載**

### 例
```
関連Issue: #123
Closes #456
破壊的変更: APIのレスポンス形式を変更
```

## プレフィックスの種類

| プレフィックス | 説明 | 使用例 |
|--------------|------|--------|
| `[追加]` | 新機能、ファイルの追加 | `[追加] パスワードリセット機能` |
| `[修正]` | バグ修正 | `[修正] ログインエラーの解消` |
| `[更新]` | 機能の更新、改善 | `[更新] ユーザー画面のUI改善` |
| `[削除]` | 機能、ファイルの削除 | `[削除] 未使用のライブラリを削除` |
| `[変更]` | 仕様変更 | `[変更] API仕様の変更` |
| `[改善]` | パフォーマンス改善など | `[改善] データベースクエリの最適化` |
| `[リファクタリング]` | コードの整理 | `[リファクタリング] 認証ロジックの整理` |
| `[ドキュメント]` | ドキュメントのみの変更 | `[ドキュメント] API仕様書を更新` |
| `[テスト]` | テストの追加や修正 | `[テスト] ユーザー登録のテストを追加` |
| `[スタイル]` | コードフォーマットのみの変更 | `[スタイル] インデントを統一` |

## 実践例

### 例1：機能追加
```
[追加] OAuth2によるソーシャルログイン機能

GoogleとGitHubアカウントでのログインに対応しました。
ユーザーは既存のアカウントを使用して簡単にログインできます。

実装内容：
- OAuth2認証フローの実装
- Google、GitHub連携機能の追加
- ユーザー情報の自動取得と登録

Closes #234
```

### 例2：バグ修正
```
[修正] ユーザー情報取得APIのnull参照エラー

ユーザーデータが存在しない場合にnullポインタ例外が
発生する問題を修正しました。

- null チェックの追加
- 適切なエラーレスポンスを返すよう変更
- エラーログの出力を改善

Fixes #567
```

### 例3：リファクタリング
```
[リファクタリング] データベースクエリビルダーの簡素化

複雑になっていたクエリビルダーのロジックを整理し、
可読性とメンテナンス性を向上させました。

- 重複コードの削減
- メソッドの責務を明確化
- テストケースの追加
```

### 例4：ドキュメント更新
```
[ドキュメント] インストール手順にDocker環境の説明を追加

Docker を使用した開発環境のセットアップ手順と
よくあるトラブルシューティングを追加しました。
```

### 例5：パフォーマンス改善
```
[改善] トップページの読み込み速度を40%改善

画像の遅延読み込みとキャッシュの最適化により
初回読み込み時間を大幅に短縮しました。

変更内容：
- 画像の遅延読み込み（lazy loading）の実装
- ブラウザキャッシュの有効活用
- 不要なJavaScriptの削除
```

## コミットのベストプラクティス

### 1. 小さく、論理的な単位でコミット
- 関連する変更をまとめる
- 一度に大量の変更をコミットしない
- 後から特定の変更を追跡しやすくする

### 2. コミットメッセージは明確に
- 後から見返したときに何を変更したか分かるように
- 「修正」「更新」だけでなく具体的な内容を記載
- 未来の自分やチームメンバーに優しく

### 3. 一貫性を保つ
- プロジェクト内で統一されたフォーマットを使用
- プレフィックスのルールを決めて守る
- チーム全体で同じ書き方を共有

### 4. レビューしやすいコミット
- コードレビューがしやすいように論理的な単位で分割
- 複数の機能を一つのコミットに混ぜない
- テストコードも一緒にコミット

### 5. 適切な粒度
```
❌ 悪い例：
「色々修正」（50ファイル変更）

✅ 良い例：
「[修正] ログイン画面のバリデーション」（3ファイル変更）
「[追加] パスワード強度チェック機能」（5ファイル変更）
「[テスト] ログイン機能のテストを追加」（2ファイル変更）
```

## コミットメッセージの修正方法

### 直前のコミットメッセージを修正
```bash
git commit --amend
```

エディタが開くので、メッセージを修正して保存します。

### コミットメッセージと変更内容を両方修正
```bash
# ファイルを修正した後
git add .
git commit --amend
```

### 過去のコミットメッセージを修正（インタラクティブリベース）
```bash
# 直近3つのコミットを修正する場合
git rebase -i HEAD~3
```

エディタで修正したいコミットの`pick`を`reword`に変更して保存します。

### 注意事項
- **既にpushしたコミットの修正は避ける**（他の人に影響を与える可能性）
- pushする前であれば自由に修正可能
- どうしても修正が必要な場合はチームに連絡

## よくある質問

### Q1: 日本語と英語、どちらで書くべき？
**A:** プロジェクトのルールに従いましょう。日本人のみのチームなら日本語でも問題ありません。国際的なプロジェクトやOSSでは英語が一般的です。

### Q2: プレフィックスは必須？
**A:** 必須ではありませんが、あると変更の種類が一目で分かり便利です。チーム内で統一すると効果的です。

### Q3: 本文は必ず書かないとダメ？
**A:** 簡単な変更であれば件名だけでも構いません。ただし、複雑な変更やバグ修正の理由は本文に書くべきです。

### Q4: コミットの粒度はどのくらいが適切？
**A:** 「一つの論理的な変更」が目安です。後から特定の変更だけを取り消せる程度の粒度が理想的です。

### Q5: タイポを見つけた場合、別コミットにすべき？
**A:** 開発中なら直前のコミットに`--amend`で追加してもOK。既にpushした後なら別コミットにします。

## チェックリスト

コミット前に確認しましょう：

- [ ] 件名は50文字以内で簡潔か？
- [ ] 何を変更したか明確に分かるか？
- [ ] 必要に応じて本文で理由を説明しているか？
- [ ] 一つの論理的な変更単位になっているか？
- [ ] 関係のない変更が混ざっていないか？
- [ ] テストは通っているか？
- [ ] プロジェクトの規約に従っているか？

## まとめ

### 良いコミットメッセージの特徴
- ✅ 簡潔で明確
- ✅ 変更の理由を説明している
- ✅ 一貫したフォーマット
- ✅ 将来の自分やチームメンバーに優しい
- ✅ 検索しやすい

### 避けるべきコミットメッセージ
- ❌ 「修正」「更新」だけ（何を修正・更新したか不明）
- ❌ 「WIP」「てすと」「あああ」（意味不明）
- ❌ 情報不足で後から分からない
- ❌ 複数の無関係な変更が混在
- ❌ フォーマットがバラバラ

良いコミットメッセージは、プロジェクトの履歴を理解しやすくし、チーム開発をスムーズにします。最初は面倒に感じるかもしれませんが、習慣化すると自然に書けるようになります！

