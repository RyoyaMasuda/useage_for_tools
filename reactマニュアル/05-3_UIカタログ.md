# 5-3. スタイリングとコンポーネント設計（UIカタログ - Storybook）

この章では、コンポーネントを独立して開発・テスト・ドキュメント化するための「Storybook」について学びます。Storybookを理解することで、コンポーネントを効率的に開発し、チーム全体で共有できるようになります。

---

## 目次

- [Storybookの導入](#storybookの導入)
- [ストーリーの作成と管理](#ストーリーの作成と管理)
- [まとめ](#まとめ)
- [演習問題](#演習問題)

---

## Storybookの導入

### Storybookとは
Storybookは、**コンポーネントを独立して開発・テスト・ドキュメント化するためのツール**です。アプリケーション全体を起動せずに、個別のコンポーネントを開発・確認できます。

### 日常生活での例
- **カタログ**: 商品カタログ（Storybook）を見て、各商品（コンポーネント）の詳細を確認する
- **見本帳**: 見本帳（Storybook）を見て、各見本（コンポーネント）の特徴を確認する
- **展示会**: 展示会（Storybook）で、各展示物（コンポーネント）を個別に確認する

### Storybookの特徴
1. **独立した開発**: アプリケーション全体を起動せずにコンポーネントを開発できる
2. **視覚的な確認**: コンポーネントの見た目を視覚的に確認できる
3. **ドキュメント化**: コンポーネントの使用方法をドキュメントとして残せる
4. **テスト**: コンポーネントの動作をテストできる
5. **チーム共有**: デザイナーと開発者が同じコンポーネントを確認できる

### Storybookのインストール

```bash
# ViteプロジェクトにStorybookを追加
npx storybook@latest init

# インストールが完了すると、以下のコマンドが使用可能になります
npm run storybook  # Storybookを起動
npm run build-storybook  # Storybookをビルド
```

### インストール後の構成

```
my-app/
├── .storybook/          # Storybookの設定ファイル
│   ├── main.js          # Storybookのメイン設定
│   └── preview.js       # Storybookのプレビュー設定
├── src/
│   └── components/
│       └── Button.stories.jsx  # ストーリーファイル
└── package.json
```

### 実践例: Storybookの基本設定

```javascript
// .storybook/main.js
export default {
    stories: ['../src/**/*.stories.@(js|jsx|ts|tsx|mdx)'],
    addons: [
        '@storybook/addon-links',
        '@storybook/addon-essentials',
        '@storybook/addon-interactions',
    ],
    framework: {
        name: '@storybook/react-vite',
        options: {},
    },
    docs: {
        autodocs: 'tag',
    },
};

// .storybook/preview.js
export const parameters = {
    actions: { argTypesRegex: '^on[A-Z].*' },
    controls: {
        matchers: {
            color: /(background|color)$/i,
            date: /Date$/,
        },
    },
};
```

### Storybookの起動

```bash
# 開発モードで起動
npm run storybook

# ブラウザで http://localhost:6006 が開きます
```

### 実践例: 基本的なストーリーの確認

```jsx
// src/components/Button.jsx
function Button({ label, onClick, variant = 'primary', disabled = false }) {
    return (
        <button
            onClick={onClick}
            disabled={disabled}
            style={{
                padding: '10px 20px',
                backgroundColor: variant === 'primary' ? '#007bff' : '#6c757d',
                color: 'white',
                border: 'none',
                borderRadius: '4px',
                cursor: disabled ? 'not-allowed' : 'pointer',
                opacity: disabled ? 0.6 : 1,
            }}
        >
            {label}
        </button>
    );
}

export default Button;

// src/components/Button.stories.jsx（自動生成される）
import Button from './Button';

export default {
    title: 'Example/Button',
    component: Button,
    tags: ['autodocs'],
    argTypes: {
        variant: {
            control: { type: 'select' },
            options: ['primary', 'secondary'],
        },
        disabled: {
            control: { type: 'boolean' },
        },
    },
};

export const Primary = {
    args: {
        label: 'ボタン',
        variant: 'primary',
    },
};

export const Secondary = {
    args: {
        label: 'ボタン',
        variant: 'secondary',
    },
};

export const Disabled = {
    args: {
        label: 'ボタン',
        disabled: true,
    },
};
```

### Storybookのアドオン

Storybookには、様々な機能を追加するアドオンがあります。

```bash
# よく使われるアドオン
npm install @storybook/addon-a11y        # アクセシビリティチェック
npm install @storybook/addon-viewport    # ビューポートの変更
npm install @storybook/addon-backgrounds # 背景色の変更
```

### 実践例: アドオンの設定

```javascript
// .storybook/main.js
export default {
    stories: ['../src/**/*.stories.@(js|jsx|ts|tsx|mdx)'],
    addons: [
        '@storybook/addon-links',
        '@storybook/addon-essentials',
        '@storybook/addon-interactions',
        '@storybook/addon-a11y',        // アクセシビリティチェック
        '@storybook/addon-viewport',    // ビューポートの変更
        '@storybook/addon-backgrounds', // 背景色の変更
    ],
    framework: {
        name: '@storybook/react-vite',
        options: {},
    },
};
```

---

## ストーリーの作成と管理

### ストーリーとは
ストーリーは、**コンポーネントの特定の状態を記述したもの**です。1つのコンポーネントに対して、複数のストーリーを作成できます。

### ストーリーの基本構造

```jsx
// Component.stories.jsx
import Component from './Component';

export default {
    title: 'カテゴリ/コンポーネント名',
    component: Component,
};

export const StoryName = {
    args: {
        // コンポーネントに渡すProps
    },
};
```

### 実践例: 基本的なストーリーの作成

```jsx
// src/components/Button.jsx
function Button({ label, onClick, variant = 'primary', size = 'medium', disabled = false }) {
    const baseStyle = {
        padding: size === 'small' ? '5px 10px' : size === 'large' ? '15px 30px' : '10px 20px',
        backgroundColor: variant === 'primary' ? '#007bff' : variant === 'secondary' ? '#6c757d' : '#28a745',
        color: 'white',
        border: 'none',
        borderRadius: '4px',
        cursor: disabled ? 'not-allowed' : 'pointer',
        opacity: disabled ? 0.6 : 1,
        fontSize: size === 'small' ? '12px' : size === 'large' ? '18px' : '14px',
    };

    return (
        <button onClick={onClick} disabled={disabled} style={baseStyle}>
            {label}
        </button>
    );
}

export default Button;

// src/components/Button.stories.jsx
import Button from './Button';

export default {
    title: 'Components/Button',
    component: Button,
    tags: ['autodocs'],
    argTypes: {
        variant: {
            control: { type: 'select' },
            options: ['primary', 'secondary', 'success'],
            description: 'ボタンのバリアント',
        },
        size: {
            control: { type: 'select' },
            options: ['small', 'medium', 'large'],
            description: 'ボタンのサイズ',
        },
        disabled: {
            control: { type: 'boolean' },
            description: 'ボタンを無効化するか',
        },
        onClick: {
            action: 'clicked',
            description: 'クリック時のイベントハンドラー',
        },
    },
};

export const Primary = {
    args: {
        label: 'プライマリーボタン',
        variant: 'primary',
    },
};

export const Secondary = {
    args: {
        label: 'セカンダリーボタン',
        variant: 'secondary',
    },
};

export const Success = {
    args: {
        label: '成功ボタン',
        variant: 'success',
    },
};

export const Small = {
    args: {
        label: '小さいボタン',
        size: 'small',
    },
};

export const Large = {
    args: {
        label: '大きいボタン',
        size: 'large',
    },
};

export const Disabled = {
    args: {
        label: '無効なボタン',
        disabled: true,
    },
};
```

### 実践例: 複数のストーリー

```jsx
// src/components/Card.jsx
function Card({ title, content, image, footer }) {
    return (
        <div style={{
            border: '1px solid #ddd',
            borderRadius: '8px',
            padding: '20px',
            maxWidth: '300px',
            boxShadow: '0 2px 4px rgba(0,0,0,0.1)',
        }}>
            {image && (
                <img 
                    src={image} 
                    alt={title}
                    style={{
                        width: '100%',
                        borderRadius: '4px',
                        marginBottom: '10px',
                    }}
                />
            )}
            <h3 style={{ margin: '0 0 10px 0' }}>{title}</h3>
            <p style={{ margin: '0 0 10px 0', color: '#666' }}>{content}</p>
            {footer && (
                <div style={{ marginTop: '10px', paddingTop: '10px', borderTop: '1px solid #eee' }}>
                    {footer}
                </div>
            )}
        </div>
    );
}

export default Card;

// src/components/Card.stories.jsx
import Card from './Card';
import Button from './Button';

export default {
    title: 'Components/Card',
    component: Card,
    tags: ['autodocs'],
};

export const Default = {
    args: {
        title: 'カードタイトル',
        content: 'これはカードの内容です。',
    },
};

export const WithImage = {
    args: {
        title: '画像付きカード',
        content: '画像が含まれたカードです。',
        image: 'https://via.placeholder.com/300',
    },
};

export const WithFooter = {
    args: {
        title: 'フッター付きカード',
        content: 'フッターが含まれたカードです。',
        footer: <Button label="アクション" />,
    },
};

export const LongContent = {
    args: {
        title: '長いコンテンツのカード',
        content: 'これは非常に長いコンテンツを含むカードです。' +
            '複数行にわたるテキストが含まれています。' +
            'カードがどのように表示されるかを確認できます。',
    },
};

export const Empty = {
    args: {
        title: '空のカード',
        content: '',
    },
};
```

### 実践例: インタラクティブなストーリー

```jsx
// src/components/Button.stories.jsx
import Button from './Button';
import { fn } from '@storybook/test';

export default {
    title: 'Components/Button',
    component: Button,
};

export const WithClick = {
    args: {
        label: 'クリックしてください',
        onClick: fn(), // Storybookのテスト用関数
    },
};

// インタラクションテスト
import { expect, userEvent, within } from '@storybook/test';

export const ClickTest = {
    args: {
        label: 'クリックしてください',
        onClick: fn(),
    },
    play: async ({ canvasElement, args }) => {
        const canvas = within(canvasElement);
        const button = canvas.getByRole('button');
        await userEvent.click(button);
        await expect(args.onClick).toHaveBeenCalled();
    },
};
```

### 実践例: ストーリーの組織化

```jsx
// src/components/atoms/Button.stories.jsx
import Button from './Button';

export default {
    title: 'Atoms/Button',  // Atomsカテゴリに分類
    component: Button,
};

// src/components/molecules/SearchBar.stories.jsx
import SearchBar from './SearchBar';

export default {
    title: 'Molecules/SearchBar',  // Moleculesカテゴリに分類
    component: SearchBar,
};

// src/components/organisms/Header.stories.jsx
import Header from './Header';

export default {
    title: 'Organisms/Header',  // Organismsカテゴリに分類
    component: Header,
};
```

### 実践例: デコレーターの使用

```javascript
// .storybook/preview.js
import { withA11y } from '@storybook/addon-a11y';

export const decorators = [
    (Story) => (
        <div style={{ padding: '20px' }}>
            <Story />
        </div>
    ),
];

export const parameters = {
    backgrounds: {
        values: [
            { name: 'light', value: '#ffffff' },
            { name: 'dark', value: '#333333' },
        ],
    },
};
```

### 実践例: 複雑なコンポーネントのストーリー

```jsx
// src/components/UserForm.stories.jsx
import UserForm from './UserForm';
import { userEvent, within } from '@storybook/test';

export default {
    title: 'Forms/UserForm',
    component: UserForm,
    tags: ['autodocs'],
};

export const Default = {
    args: {
        onSubmit: (data) => {
            console.log('送信されたデータ:', data);
        },
    },
};

export const WithInitialValues = {
    args: {
        initialValues: {
            name: '太郎',
            email: 'taro@example.com',
            age: 25,
        },
        onSubmit: (data) => {
            console.log('送信されたデータ:', data);
        },
    },
};

export const FilledForm = {
    args: {
        onSubmit: (data) => {
            console.log('送信されたデータ:', data);
        },
    },
    play: async ({ canvasElement }) => {
        const canvas = within(canvasElement);
        
        // フォームに値を入力
        await userEvent.type(canvas.getByLabelText('名前'), '太郎');
        await userEvent.type(canvas.getByLabelText('メールアドレス'), 'taro@example.com');
        await userEvent.type(canvas.getByLabelText('年齢'), '25');
        
        // 送信ボタンをクリック
        await userEvent.click(canvas.getByRole('button', { name: '送信' }));
    },
};
```

### 実践例: ストーリーのドキュメント化

```jsx
// src/components/Button.stories.jsx
import Button from './Button';

export default {
    title: 'Components/Button',
    component: Button,
    tags: ['autodocs'],
    parameters: {
        docs: {
            description: {
                component: 'ボタンコンポーネントです。様々なバリアントとサイズをサポートしています。',
            },
        },
    },
};

/**
 * プライマリーボタンは、主要なアクションに使用します。
 */
export const Primary = {
    args: {
        label: 'プライマリーボタン',
        variant: 'primary',
    },
    parameters: {
        docs: {
            description: {
                story: '主要なアクションに使用するボタンです。',
            },
        },
    },
};
```

### ストーリーの管理のベストプラクティス
1. **階層構造**: カテゴリごとにストーリーを整理する
2. **命名規則**: ストーリー名は明確で分かりやすくする
3. **ドキュメント化**: コンポーネントの使用方法をドキュメント化する
4. **テスト**: インタラクションテストを含める
5. **一貫性**: プロジェクト全体で同じスタイルのストーリーを作成する

---

## まとめ

この章では、Storybookについて以下のことを学びました。

### Storybookの導入
- Storybookは、コンポーネントを独立して開発・テスト・ドキュメント化するためのツール
- `npx storybook@latest init`でインストールできる
- `.storybook/main.js`と`.storybook/preview.js`で設定を管理する
- 様々なアドオンを追加して機能を拡張できる

### ストーリーの作成と管理
- **ストーリー**: コンポーネントの特定の状態を記述したもの
- **基本構造**: `export default`でメタデータを定義し、`export const`で個別のストーリーを定義
- **複数のストーリー**: 1つのコンポーネントに対して複数のストーリーを作成できる
- **インタラクティブ**: イベントハンドラーやインタラクションテストを含められる
- **組織化**: 階層構造でストーリーを管理できる

### Storybookのメリット
- **独立した開発**: アプリケーション全体を起動せずにコンポーネントを開発できる
- **視覚的な確認**: コンポーネントの見た目を視覚的に確認できる
- **ドキュメント化**: コンポーネントの使用方法をドキュメントとして残せる
- **テスト**: コンポーネントの動作をテストできる
- **チーム共有**: デザイナーと開発者が同じコンポーネントを確認できる

### 次のステップ
Storybookを理解したら、次のトピックに進みましょう：
- パフォーマンス最適化とメモ化（6章）
- ルーティング（7章）

---

## 演習問題

以下の問題を解いて、Storybookの理解を深めましょう。

### 問題1: Storybookのインストール
ViteプロジェクトにStorybookをインストールし、起動してください。

<details>
<summary>解答例</summary>

```bash
# Storybookをインストール
npx storybook@latest init

# Storybookを起動
npm run storybook
```
</details>

### 問題2: 基本的なストーリーの作成
`Button`コンポーネントの基本的なストーリーを作成してください。

<details>
<summary>解答例</summary>

```jsx
// src/components/Button.stories.jsx
import Button from './Button';

export default {
    title: 'Components/Button',
    component: Button,
};

export const Default = {
    args: {
        label: 'ボタン',
    },
};
```
</details>

### 問題3: 複数のストーリー
`Card`コンポーネントに対して、複数のストーリー（Default、WithImage、Empty）を作成してください。

<details>
<summary>解答例</summary>

```jsx
// src/components/Card.stories.jsx
import Card from './Card';

export default {
    title: 'Components/Card',
    component: Card,
};

export const Default = {
    args: {
        title: 'カードタイトル',
        content: 'カードの内容',
    },
};

export const WithImage = {
    args: {
        title: '画像付きカード',
        content: '画像が含まれたカード',
        image: 'https://via.placeholder.com/300',
    },
};

export const Empty = {
    args: {
        title: '空のカード',
        content: '',
    },
};
```
</details>

### 問題4: インタラクティブなストーリー
`Button`コンポーネントにクリックイベントを含むストーリーを作成してください。

<details>
<summary>解答例</summary>

```jsx
// src/components/Button.stories.jsx
import Button from './Button';
import { fn } from '@storybook/test';

export default {
    title: 'Components/Button',
    component: Button,
};

export const WithClick = {
    args: {
        label: 'クリックしてください',
        onClick: fn(),
    },
};
```
</details>

### 問題5: ストーリーの組織化
`Input`コンポーネントのストーリーを`Forms/Input`という階層で作成してください。

<details>
<summary>解答例</summary>

```jsx
// src/components/Input.stories.jsx
import Input from './Input';

export default {
    title: 'Forms/Input',
    component: Input,
};

export const Default = {
    args: {
        label: '名前',
        placeholder: '名前を入力してください',
    },
};
```
</details>

---

お疲れ様でした！次の章に進みましょう。

