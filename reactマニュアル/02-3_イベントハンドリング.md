# 2-3. イベントハンドリング

この章では、Reactでのイベントハンドリングについて学びます。イベントハンドリングを理解することで、ユーザーの操作に応じたインタラクティブなアプリケーションを作成できるようになります。

---

## 目次

- [イベントオブジェクトの扱い](#イベントオブジェクトの扱い)
- [フォーム入力の基本 (onChange)](#フォーム入力の基本-onchange)
- [子から親へのデータ伝達 (コールバック関数)](#子から親へのデータ伝達-コールバック関数)
- [まとめ](#まとめ)
- [演習問題](#演習問題)

---

## イベントオブジェクトの扱い

### イベントオブジェクトとは
イベントオブジェクトは、**イベントが発生したときの情報を含むオブジェクト**です。クリック、入力、フォーカスなどのイベントに関する情報が含まれます。

### 基本的なイベントハンドリング

```jsx
function Button() {
  const handleClick = (event) => {
    console.log('クリックされました', event)
  }
  
  return <button onClick={handleClick}>クリック</button>
}
```

### 実践例: 基本的なイベントハンドリング

```jsx
// src/components/Button.jsx
function Button() {
  const handleClick = (event) => {
    console.log('ボタンがクリックされました')
    console.log('イベント:', event)
    console.log('ターゲット:', event.target)
  }
  
  return (
    <button onClick={handleClick}>
      クリックしてください
    </button>
  )
}

export default Button
```

### 実践例: イベントオブジェクトの情報を取得

```jsx
// src/components/ClickInfo.jsx
import { useState } from 'react'

function ClickInfo() {
  const [clickInfo, setClickInfo] = useState(null)
  
  const handleClick = (event) => {
    setClickInfo({
      type: event.type,
      target: event.target.tagName,
      clientX: event.clientX,
      clientY: event.clientY,
      timestamp: new Date().toISOString()
    })
  }
  
  return (
    <div>
      <button onClick={handleClick}>
        クリックして情報を表示
      </button>
      {clickInfo && (
        <div>
          <p>イベントタイプ: {clickInfo.type}</p>
          <p>ターゲット: {clickInfo.target}</p>
          <p>X座標: {clickInfo.clientX}</p>
          <p>Y座標: {clickInfo.clientY}</p>
          <p>タイムスタンプ: {clickInfo.timestamp}</p>
        </div>
      )}
    </div>
  )
}

export default ClickInfo
```

### 実践例: イベントの伝播を制御

```jsx
// src/components/EventPropagation.jsx
function EventPropagation() {
  const handleParentClick = (event) => {
    console.log('親要素がクリックされました')
  }
  
  const handleChildClick = (event) => {
    console.log('子要素がクリックされました')
    // イベントの伝播を停止
    event.stopPropagation()
  }
  
  return (
    <div
      onClick={handleParentClick}
      style={{
        padding: '20px',
        backgroundColor: 'lightblue',
        cursor: 'pointer'
      }}
    >
      <p>親要素（ここをクリック）</p>
      <div
        onClick={handleChildClick}
        style={{
          padding: '10px',
          backgroundColor: 'lightgreen',
          cursor: 'pointer'
        }}
      >
        子要素（ここをクリック）
      </div>
    </div>
  )
}

export default EventPropagation
```

### 実践例: デフォルト動作の防止

```jsx
// src/components/Form.jsx
function Form() {
  const handleSubmit = (event) => {
    // フォームのデフォルト送信動作を防止
    event.preventDefault()
    console.log('フォームが送信されました')
  }
  
  return (
    <form onSubmit={handleSubmit}>
      <input type="text" placeholder="名前" />
      <button type="submit">送信</button>
    </form>
  )
}

export default Form
```

### 実践例: キーボードイベント

```jsx
// src/components/KeyboardEvents.jsx
import { useState } from 'react'

function KeyboardEvents() {
  const [keyInfo, setKeyInfo] = useState(null)
  
  const handleKeyDown = (event) => {
    setKeyInfo({
      key: event.key,
      code: event.code,
      keyCode: event.keyCode,
      ctrlKey: event.ctrlKey,
      shiftKey: event.shiftKey,
      altKey: event.altKey
    })
  }
  
  return (
    <div>
      <input
        type="text"
        onKeyDown={handleKeyDown}
        placeholder="キーを押してください"
      />
      {keyInfo && (
        <div>
          <p>押されたキー: {keyInfo.key}</p>
          <p>キーコード: {keyInfo.code}</p>
          <p>Ctrlキー: {keyInfo.ctrlKey ? '押されている' : '押されていない'}</p>
          <p>Shiftキー: {keyInfo.shiftKey ? '押されている' : '押されていない'}</p>
        </div>
      )}
    </div>
  )
}

export default KeyboardEvents
```

---

## フォーム入力の基本 (onChange)

### onChangeイベントとは
`onChange`イベントは、**入力フィールドの値が変更されたときに発生する**イベントです。

### 基本的な使い方

```jsx
function Input() {
  const [value, setValue] = useState('')
  
  const handleChange = (event) => {
    setValue(event.target.value)
  }
  
  return (
    <input
      type="text"
      value={value}
      onChange={handleChange}
    />
  )
}
```

### 実践例: 基本的な入力フィールド

```jsx
// src/components/BasicInput.jsx
import { useState } from 'react'

function BasicInput() {
  const [value, setValue] = useState('')
  
  const handleChange = (event) => {
    setValue(event.target.value)
  }
  
  return (
    <div>
      <input
        type="text"
        value={value}
        onChange={handleChange}
        placeholder="入力してください"
      />
      <p>入力値: {value}</p>
    </div>
  )
}

export default BasicInput
```

### 実践例: 複数の入力フィールド

```jsx
// src/components/MultiInput.jsx
import { useState } from 'react'

function MultiInput() {
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    message: ''
  })
  
  const handleChange = (event) => {
    const { name, value } = event.target
    setFormData({
      ...formData,
      [name]: value
    })
  }
  
  return (
    <form>
      <div>
        <label>名前</label>
        <input
          type="text"
          name="name"
          value={formData.name}
          onChange={handleChange}
        />
      </div>
      <div>
        <label>メールアドレス</label>
        <input
          type="email"
          name="email"
          value={formData.email}
          onChange={handleChange}
        />
      </div>
      <div>
        <label>メッセージ</label>
        <textarea
          name="message"
          value={formData.message}
          onChange={handleChange}
        />
      </div>
      <div>
        <p>名前: {formData.name}</p>
        <p>メール: {formData.email}</p>
        <p>メッセージ: {formData.message}</p>
      </div>
    </form>
  )
}

export default MultiInput
```

### 実践例: 入力値の検証

```jsx
// src/components/ValidatedInput.jsx
import { useState } from 'react'

function ValidatedInput() {
  const [email, setEmail] = useState('')
  const [error, setError] = useState('')
  
  const handleChange = (event) => {
    const value = event.target.value
    setEmail(value)
    
    // メールアドレスの検証
    if (value && !value.includes('@')) {
      setError('有効なメールアドレスを入力してください')
    } else {
      setError('')
    }
  }
  
  return (
    <div>
      <input
        type="email"
        value={email}
        onChange={handleChange}
        placeholder="メールアドレス"
      />
      {error && <p style={{ color: 'red' }}>{error}</p>}
    </div>
  )
}

export default ValidatedInput
```

### 実践例: リアルタイム検索

```jsx
// src/components/SearchBox.jsx
import { useState } from 'react'

const items = [
  'りんご', 'バナナ', 'オレンジ', 'ぶどう', 'いちご',
  'メロン', 'スイカ', 'パイナップル', 'マンゴー', 'キウイ'
]

function SearchBox() {
  const [query, setQuery] = useState('')
  
  const handleChange = (event) => {
    setQuery(event.target.value)
  }
  
  const filteredItems = items.filter(item =>
    item.includes(query)
  )
  
  return (
    <div>
      <input
        type="text"
        value={query}
        onChange={handleChange}
        placeholder="検索..."
      />
      <ul>
        {filteredItems.map((item, index) => (
          <li key={index}>{item}</li>
        ))}
      </ul>
    </div>
  )
}

export default SearchBox
```

### 実践例: 数値入力の制限

```jsx
// src/components/NumberInput.jsx
import { useState } from 'react'

function NumberInput() {
  const [value, setValue] = useState('')
  
  const handleChange = (event) => {
    const inputValue = event.target.value
    // 数値のみを許可
    if (inputValue === '' || /^\d+$/.test(inputValue)) {
      setValue(inputValue)
    }
  }
  
  return (
    <div>
      <input
        type="text"
        value={value}
        onChange={handleChange}
        placeholder="数値を入力"
      />
      <p>入力値: {value || '未入力'}</p>
    </div>
  )
}

export default NumberInput
```

---

## 子から親へのデータ伝達 (コールバック関数)

### コールバック関数とは
コールバック関数は、**親コンポーネントから子コンポーネントに渡される関数**です。子コンポーネントでこの関数を呼び出すことで、親コンポーネントにデータを伝達できます。

### データの流れ

```
親コンポーネント
  ↓ (Propsでコールバック関数を渡す)
子コンポーネント
  ↓ (コールバック関数を呼び出す)
親コンポーネント (状態を更新)
```

### 実践例: 基本的なコールバック関数

```jsx
// src/components/Counter.jsx
import { useState } from 'react'
import CounterButton from './CounterButton'

function Counter() {
  const [count, setCount] = useState(0)
  
  // コールバック関数: 子コンポーネントから呼び出される
  const handleIncrement = () => {
    setCount(count + 1)
  }
  
  const handleDecrement = () => {
    setCount(count - 1)
  }
  
  return (
    <div>
      <h1>カウント: {count}</h1>
      <CounterButton 
        label="増やす"
        onClick={handleIncrement}
      />
      <CounterButton 
        label="減らす"
        onClick={handleDecrement}
      />
    </div>
  )
}

export default Counter
```

```jsx
// src/components/CounterButton.jsx
function CounterButton({ label, onClick }) {
  return (
    <button onClick={onClick}>
      {label}
    </button>
  )
}

export default CounterButton
```

### 実践例: フォーム入力の親への伝達

```jsx
// src/components/Form.jsx
import { useState } from 'react'
import InputField from './InputField'

function Form() {
  const [formData, setFormData] = useState({
    name: '',
    email: ''
  })
  
  // フォームデータを更新するコールバック
  const handleInputChange = (field, value) => {
    setFormData({
      ...formData,
      [field]: value
    })
  }
  
  const handleSubmit = (e) => {
    e.preventDefault()
    console.log('送信されたデータ:', formData)
  }
  
  return (
    <form onSubmit={handleSubmit}>
      <InputField
        label="名前"
        value={formData.name}
        onChange={(value) => handleInputChange('name', value)}
      />
      <InputField
        label="メールアドレス"
        value={formData.email}
        onChange={(value) => handleInputChange('email', value)}
      />
      <button type="submit">送信</button>
    </form>
  )
}

export default Form
```

```jsx
// src/components/InputField.jsx
function InputField({ label, value, onChange }) {
  const handleChange = (e) => {
    // 親コンポーネントに値を伝達
    onChange(e.target.value)
  }
  
  return (
    <div>
      <label>{label}</label>
      <input
        type="text"
        value={value}
        onChange={handleChange}
      />
    </div>
  )
}

export default InputField
```

### 実践例: タスクリストアプリ

```jsx
// src/components/TaskApp.jsx
import { useState } from 'react'
import TaskForm from './TaskForm'
import TaskList from './TaskList'

function TaskApp() {
  const [tasks, setTasks] = useState([])
  
  // タスクを追加するコールバック
  const handleAddTask = (taskText) => {
    const newTask = {
      id: Date.now(),
      text: taskText,
      completed: false
    }
    setTasks([...tasks, newTask])
  }
  
  // タスクを削除するコールバック
  const handleDeleteTask = (taskId) => {
    setTasks(tasks.filter(task => task.id !== taskId))
  }
  
  // タスクの完了状態を切り替えるコールバック
  const handleToggleTask = (taskId) => {
    setTasks(tasks.map(task =>
      task.id === taskId
        ? { ...task, completed: !task.completed }
        : task
    ))
  }
  
  return (
    <div>
      <h1>タスクリスト</h1>
      <TaskForm onAddTask={handleAddTask} />
      <TaskList
        tasks={tasks}
        onDeleteTask={handleDeleteTask}
        onToggleTask={handleToggleTask}
      />
    </div>
  )
}

export default TaskApp
```

```jsx
// src/components/TaskForm.jsx
import { useState } from 'react'

function TaskForm({ onAddTask }) {
  const [input, setInput] = useState('')
  
  const handleSubmit = (e) => {
    e.preventDefault()
    if (input.trim()) {
      onAddTask(input)
      setInput('')
    }
  }
  
  return (
    <form onSubmit={handleSubmit}>
      <input
        type="text"
        value={input}
        onChange={(e) => setInput(e.target.value)}
        placeholder="新しいタスクを入力"
      />
      <button type="submit">追加</button>
    </form>
  )
}

export default TaskForm
```

```jsx
// src/components/TaskList.jsx
import TaskItem from './TaskItem'

function TaskList({ tasks, onDeleteTask, onToggleTask }) {
  return (
    <ul>
      {tasks.map(task => (
        <TaskItem
          key={task.id}
          task={task}
          onDelete={onDeleteTask}
          onToggle={onToggleTask}
        />
      ))}
    </ul>
  )
}

export default TaskList
```

```jsx
// src/components/TaskItem.jsx
function TaskItem({ task, onDelete, onToggle }) {
  return (
    <li>
      <input
        type="checkbox"
        checked={task.completed}
        onChange={() => onToggle(task.id)}
      />
      <span style={{
        textDecoration: task.completed ? 'line-through' : 'none'
      }}>
        {task.text}
      </span>
      <button onClick={() => onDelete(task.id)}>削除</button>
    </li>
  )
}

export default TaskItem
```

### 実践例: 検索機能

```jsx
// src/components/SearchApp.jsx
import { useState } from 'react'
import SearchBox from './SearchBox'

const items = [
  'りんご', 'バナナ', 'オレンジ', 'ぶどう', 'いちご',
  'メロン', 'スイカ', 'パイナップル', 'マンゴー', 'キウイ'
]

function SearchApp() {
  const [query, setQuery] = useState('')
  
  // 検索クエリを更新するコールバック
  const handleSearch = (searchQuery) => {
    setQuery(searchQuery)
  }
  
  const filteredItems = items.filter(item =>
    item.includes(query)
  )
  
  return (
    <div>
      <h1>検索アプリ</h1>
      <SearchBox onSearch={handleSearch} />
      <ul>
        {filteredItems.map((item, index) => (
          <li key={index}>{item}</li>
        ))}
      </ul>
    </div>
  )
}

export default SearchApp
```

```jsx
// src/components/SearchBox.jsx
function SearchBox({ onSearch }) {
  const handleChange = (e) => {
    // 親コンポーネントに検索クエリを伝達
    onSearch(e.target.value)
  }
  
  return (
    <input
      type="text"
      onChange={handleChange}
      placeholder="検索..."
    />
  )
}

export default SearchBox
```

---

## まとめ

この章では、Reactでのイベントハンドリングについて学びました。

### 学んだこと
- イベントオブジェクトの扱い: イベント情報の取得と制御
- フォーム入力の基本: onChangeイベントを使用した入力処理
- 子から親へのデータ伝達: コールバック関数を使用したデータ伝達

### 重要なポイント
1. **イベントオブジェクト**: イベントに関する情報を含む
2. **onChange**: 入力値の変更を検知
3. **コールバック関数**: 子から親へデータを伝達
4. **event.preventDefault()**: デフォルト動作を防止
5. **event.stopPropagation()**: イベントの伝播を停止

### 次のステップ
次の章では、副作用とフック（Hooks）の基本について詳しく学びます。

---

## 演習問題

### 問題1: 基本的なイベントハンドリング
ボタンをクリックすると、アラートを表示するコンポーネントを作成してください。

<details>
<summary>解答例</summary>

```jsx
// src/components/AlertButton.jsx
function AlertButton() {
  const handleClick = () => {
    alert('ボタンがクリックされました！')
  }
  
  return (
    <button onClick={handleClick}>
      クリックしてください
    </button>
  )
}

export default AlertButton
```
</details>

### 問題2: 入力フィールドの値の表示
入力フィールドに入力した値をリアルタイムで表示するコンポーネントを作成してください。

<details>
<summary>解答例</summary>

```jsx
// src/components/InputDisplay.jsx
import { useState } from 'react'

function InputDisplay() {
  const [value, setValue] = useState('')
  
  const handleChange = (e) => {
    setValue(e.target.value)
  }
  
  return (
    <div>
      <input
        type="text"
        value={value}
        onChange={handleChange}
        placeholder="入力してください"
      />
      <p>入力値: {value}</p>
    </div>
  )
}

export default InputDisplay
```
</details>

### 問題3: フォーム送信の処理
フォーム送信時に、入力値をコンソールに表示するコンポーネントを作成してください。

<details>
<summary>解答例</summary>

```jsx
// src/components/SubmitForm.jsx
import { useState } from 'react'

function SubmitForm() {
  const [name, setName] = useState('')
  
  const handleSubmit = (e) => {
    e.preventDefault()
    console.log('送信された名前:', name)
  }
  
  return (
    <form onSubmit={handleSubmit}>
      <input
        type="text"
        value={name}
        onChange={(e) => setName(e.target.value)}
        placeholder="名前を入力"
      />
      <button type="submit">送信</button>
    </form>
  )
}

export default SubmitForm
```
</details>

### 問題4: コールバック関数
親コンポーネントでカウントを管理し、子コンポーネントのボタンでカウントを増やすコンポーネントを作成してください。

<details>
<summary>解答例</summary>

```jsx
// src/components/Counter.jsx
import { useState } from 'react'
import IncrementButton from './IncrementButton'

function Counter() {
  const [count, setCount] = useState(0)
  
  const handleIncrement = () => {
    setCount(count + 1)
  }
  
  return (
    <div>
      <p>カウント: {count}</p>
      <IncrementButton onIncrement={handleIncrement} />
    </div>
  )
}

export default Counter
```

```jsx
// src/components/IncrementButton.jsx
function IncrementButton({ onIncrement }) {
  return (
    <button onClick={onIncrement}>
      増やす
    </button>
  )
}

export default IncrementButton
```
</details>

### 問題5: 複数の入力フィールド
名前、メールアドレス、メッセージを入力するフォームを作成し、送信時にすべての値を表示してください。

<details>
<summary>解答例</summary>

```jsx
// src/components/ContactForm.jsx
import { useState } from 'react'

function ContactForm() {
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    message: ''
  })
  
  const handleChange = (e) => {
    const { name, value } = e.target
    setFormData({
      ...formData,
      [name]: value
    })
  }
  
  const handleSubmit = (e) => {
    e.preventDefault()
    console.log('送信されたデータ:', formData)
  }
  
  return (
    <form onSubmit={handleSubmit}>
      <div>
        <label>名前</label>
        <input
          type="text"
          name="name"
          value={formData.name}
          onChange={handleChange}
        />
      </div>
      <div>
        <label>メールアドレス</label>
        <input
          type="email"
          name="email"
          value={formData.email}
          onChange={handleChange}
        />
      </div>
      <div>
        <label>メッセージ</label>
        <textarea
          name="message"
          value={formData.message}
          onChange={handleChange}
        />
      </div>
      <button type="submit">送信</button>
    </form>
  )
}

export default ContactForm
```
</details>

---

お疲れ様でした！次の章に進みましょう。

