# 5-3. ストーリーの作成と管理

この章では、Storybookでストーリーを作成し、管理する方法について学びます。ストーリーを理解することで、コンポーネントを効率的に開発・テストできるようになります。

---

## 目次

- [ストーリーとは](#ストーリーとは)
- [基本的なストーリーの作成](#基本的なストーリーの作成)
- [ストーリーのバリエーション](#ストーリーのバリエーション)
- [ストーリーの管理と組織化](#ストーリーの管理と組織化)
- [実践例: 様々なコンポーネントのストーリー](#実践例-様々なコンポーネントのストーリー)
- [まとめ](#まとめ)
- [演習問題](#演習問題)

---

## ストーリーとは

### ストーリーの概念
ストーリーは、**コンポーネントの特定の状態を記述したもの**です。1つのコンポーネントに対して、複数のストーリーを作成できます。

### ストーリーの特徴
- **コンポーネントの状態を記述**: 様々な状態を視覚的に確認できる
- **独立した開発**: アプリケーション全体を起動せずにコンポーネントを開発できる
- **ドキュメント化**: コンポーネントの使用方法をドキュメントとして残せる
- **テスト**: コンポーネントの動作をテストできる

### ストーリーの基本構造

```jsx
// Button.stories.jsx
import Button from './Button'

export default {
  title: 'Components/Button',
  component: Button,
}

export const Primary = {
  args: {
    label: 'ボタン',
    variant: 'primary',
  },
}
```

---

## 基本的なストーリーの作成

### ステップ1: コンポーネントの作成

まず、ストーリーを作成するコンポーネントを用意します。

```jsx
// src/components/Button.jsx
function Button({ label, onClick, variant = 'primary', disabled = false }) {
  return (
    <button
      onClick={onClick}
      disabled={disabled}
      style={{
        padding: '10px 20px',
        backgroundColor: variant === 'primary' ? '#007bff' : '#6c757d',
        color: 'white',
        border: 'none',
        borderRadius: '4px',
        cursor: disabled ? 'not-allowed' : 'pointer',
        opacity: disabled ? 0.6 : 1,
      }}
    >
      {label}
    </button>
  )
}

export default Button
```

### ステップ2: ストーリーファイルの作成

コンポーネントと同じディレクトリに、`.stories.jsx`（または`.stories.js`）という拡張子のファイルを作成します。

```jsx
// src/components/Button.stories.jsx
import Button from './Button'

export default {
  title: 'Components/Button',
  component: Button,
  tags: ['autodocs'],
}

export const Primary = {
  args: {
    label: 'プライマリーボタン',
    variant: 'primary',
  },
}

export const Secondary = {
  args: {
    label: 'セカンダリーボタン',
    variant: 'secondary',
  },
}

export const Disabled = {
  args: {
    label: '無効なボタン',
    variant: 'primary',
    disabled: true,
  },
}
```

### 実践例: 基本的なストーリー

```jsx
// src/components/Button.stories.jsx
import Button from './Button'

export default {
  title: 'Components/Button',
  component: Button,
  tags: ['autodocs'],
  argTypes: {
    variant: {
      control: { type: 'select' },
      options: ['primary', 'secondary'],
    },
    disabled: {
      control: { type: 'boolean' },
    },
  },
}

export const Default = {
  args: {
    label: 'ボタン',
    variant: 'primary',
    disabled: false,
  },
}

export const Primary = {
  args: {
    label: 'プライマリーボタン',
    variant: 'primary',
  },
}

export const Secondary = {
  args: {
    label: 'セカンダリーボタン',
    variant: 'secondary',
  },
}

export const Disabled = {
  args: {
    label: '無効なボタン',
    disabled: true,
  },
}
```

---

## ストーリーのバリエーション

### 複数のストーリーを作成

1つのコンポーネントに対して、複数のストーリーを作成することで、様々な状態を確認できます。

### 実践例: ストーリーのバリエーション

```jsx
// src/components/Card.stories.jsx
import Card from './Card'

export default {
  title: 'Components/Card',
  component: Card,
}

export const Default = {
  args: {
    title: 'カードタイトル',
    content: 'これはカードの内容です。',
  },
}

export const WithImage = {
  args: {
    title: '画像付きカード',
    content: '画像が含まれたカードです。',
    image: 'https://via.placeholder.com/300',
  },
}

export const LongContent = {
  args: {
    title: '長いコンテンツのカード',
    content: 'これは非常に長いコンテンツを含むカードです。' +
      '複数行にわたるテキストが含まれています。' +
      'カードがどのように表示されるかを確認できます。',
  },
}

export const Empty = {
  args: {
    title: '空のカード',
    content: '',
  },
}
```

### インタラクティブなストーリー

イベントハンドラーを含むストーリーを作成できます。

```jsx
// src/components/Button.stories.jsx
import Button from './Button'

export default {
  title: 'Components/Button',
  component: Button,
}

export const WithClick = {
  args: {
    label: 'クリックしてください',
    onClick: () => {
      alert('ボタンがクリックされました！')
    },
  },
}
```

---

## ストーリーの管理と組織化

### ストーリーの階層構造

ストーリーは階層構造で組織化できます。

```jsx
export default {
  title: 'Components/Button', // Components/Button という階層
  component: Button,
}
```

### 実践例: ストーリーの組織化

```jsx
// src/components/Button.stories.jsx
import Button from './Button'

export default {
  title: 'Components/Button',
  component: Button,
}

export const Primary = {
  args: {
    label: 'プライマリーボタン',
    variant: 'primary',
  },
}
```

```jsx
// src/components/Input.stories.jsx
import Input from './Input'

export default {
  title: 'Components/Input',
  component: Input,
}

export const Default = {
  args: {
    placeholder: '入力してください',
  },
}
```

```jsx
// src/components/Modal.stories.jsx
import Modal from './Modal'

export default {
  title: 'Components/Modal',
  component: Modal,
}

export const Default = {
  args: {
    isOpen: true,
    title: 'モーダルタイトル',
    children: 'モーダルの内容',
  },
}
```

### ストーリーのグループ化

関連するストーリーをグループ化できます。

```jsx
// src/components/Form.stories.jsx
import Form from './Form'
import Input from './Input'
import Button from './Button'

export default {
  title: 'Forms',
  component: Form,
}

export const LoginForm = {
  render: () => (
    <Form>
      <Input placeholder="ユーザー名" />
      <Input type="password" placeholder="パスワード" />
      <Button label="ログイン" />
    </Form>
  ),
}

export const RegistrationForm = {
  render: () => (
    <Form>
      <Input placeholder="名前" />
      <Input type="email" placeholder="メールアドレス" />
      <Input type="password" placeholder="パスワード" />
      <Button label="登録" />
    </Form>
  ),
}
```

---

## 実践例: 様々なコンポーネントのストーリー

### 実践例1: ボタンコンポーネント

```jsx
// src/components/Button.jsx
function Button({ label, onClick, variant = 'primary', size = 'medium', disabled = false }) {
  const baseStyle = {
    padding: size === 'small' ? '5px 10px' : size === 'large' ? '15px 30px' : '10px 20px',
    backgroundColor: variant === 'primary' ? '#007bff' : variant === 'secondary' ? '#6c757d' : '#28a745',
    color: 'white',
    border: 'none',
    borderRadius: '4px',
    cursor: disabled ? 'not-allowed' : 'pointer',
    opacity: disabled ? 0.6 : 1,
    fontSize: size === 'small' ? '12px' : size === 'large' ? '18px' : '14px',
  }

  return (
    <button onClick={onClick} disabled={disabled} style={baseStyle}>
      {label}
    </button>
  )
}

export default Button
```

```jsx
// src/components/Button.stories.jsx
import Button from './Button'

export default {
  title: 'Components/Button',
  component: Button,
  argTypes: {
    variant: {
      control: { type: 'select' },
      options: ['primary', 'secondary', 'success'],
    },
    size: {
      control: { type: 'select' },
      options: ['small', 'medium', 'large'],
    },
    disabled: {
      control: { type: 'boolean' },
    },
  },
}

export const Primary = {
  args: {
    label: 'プライマリーボタン',
    variant: 'primary',
  },
}

export const Secondary = {
  args: {
    label: 'セカンダリーボタン',
    variant: 'secondary',
  },
}

export const Small = {
  args: {
    label: '小さいボタン',
    size: 'small',
  },
}

export const Large = {
  args: {
    label: '大きいボタン',
    size: 'large',
  },
}

export const Disabled = {
  args: {
    label: '無効なボタン',
    disabled: true,
  },
}
```

### 実践例2: カードコンポーネント

```jsx
// src/components/Card.jsx
function Card({ title, content, image, footer }) {
  return (
    <div style={{
      border: '1px solid #ddd',
      borderRadius: '8px',
      padding: '20px',
      maxWidth: '300px',
      boxShadow: '0 2px 4px rgba(0,0,0,0.1)',
    }}>
      {image && (
        <img 
          src={image} 
          alt={title}
          style={{
            width: '100%',
            borderRadius: '4px',
            marginBottom: '10px',
          }}
        />
      )}
      <h3 style={{ margin: '0 0 10px 0' }}>{title}</h3>
      <p style={{ margin: '0 0 10px 0', color: '#666' }}>{content}</p>
      {footer && (
        <div style={{ marginTop: '10px', paddingTop: '10px', borderTop: '1px solid #eee' }}>
          {footer}
        </div>
      )}
    </div>
  )
}

export default Card
```

```jsx
// src/components/Card.stories.jsx
import Card from './Card'

export default {
  title: 'Components/Card',
  component: Card,
}

export const Default = {
  args: {
    title: 'カードタイトル',
    content: 'これはカードの内容です。',
  },
}

export const WithImage = {
  args: {
    title: '画像付きカード',
    content: '画像が含まれたカードです。',
    image: 'https://via.placeholder.com/300',
  },
}

export const WithFooter = {
  args: {
    title: 'フッター付きカード',
    content: 'フッターが含まれたカードです。',
    footer: <button>アクション</button>,
  },
}
```

### 実践例3: 入力フィールドコンポーネント

```jsx
// src/components/Input.jsx
function Input({ label, type = 'text', placeholder, value, onChange, error }) {
  return (
    <div>
      {label && <label style={{ display: 'block', marginBottom: '5px' }}>{label}</label>}
      <input
        type={type}
        placeholder={placeholder}
        value={value}
        onChange={onChange}
        style={{
          width: '100%',
          padding: '10px',
          border: error ? '1px solid red' : '1px solid #ddd',
          borderRadius: '4px',
          fontSize: '14px',
        }}
      />
      {error && <span style={{ color: 'red', fontSize: '12px' }}>{error}</span>}
    </div>
  )
}

export default Input
```

```jsx
// src/components/Input.stories.jsx
import Input from './Input'

export default {
  title: 'Components/Input',
  component: Input,
}

export const Default = {
  args: {
    label: '名前',
    placeholder: '名前を入力してください',
  },
}

export const Email = {
  args: {
    label: 'メールアドレス',
    type: 'email',
    placeholder: 'example@mail.com',
  },
}

export const Password = {
  args: {
    label: 'パスワード',
    type: 'password',
    placeholder: 'パスワードを入力してください',
  },
}

export const WithError = {
  args: {
    label: 'メールアドレス',
    type: 'email',
    placeholder: 'example@mail.com',
    error: '有効なメールアドレスを入力してください',
  },
}
```

### 実践例4: モーダルコンポーネント

```jsx
// src/components/Modal.jsx
function Modal({ isOpen, title, children, onClose }) {
  if (!isOpen) return null

  return (
    <div style={{
      position: 'fixed',
      top: 0,
      left: 0,
      right: 0,
      bottom: 0,
      backgroundColor: 'rgba(0, 0, 0, 0.5)',
      display: 'flex',
      justifyContent: 'center',
      alignItems: 'center',
      zIndex: 1000,
    }}>
      <div style={{
        backgroundColor: 'white',
        borderRadius: '8px',
        padding: '20px',
        maxWidth: '500px',
        width: '90%',
      }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '10px' }}>
          <h2 style={{ margin: 0 }}>{title}</h2>
          {onClose && (
            <button onClick={onClose} style={{ border: 'none', background: 'none', fontSize: '24px', cursor: 'pointer' }}>
              ×
            </button>
          )}
        </div>
        <div>{children}</div>
      </div>
    </div>
  )
}

export default Modal
```

```jsx
// src/components/Modal.stories.jsx
import Modal from './Modal'

export default {
  title: 'Components/Modal',
  component: Modal,
}

export const Default = {
  args: {
    isOpen: true,
    title: 'モーダルタイトル',
    children: 'これはモーダルの内容です。',
  },
}

export const WithLongContent = {
  args: {
    isOpen: true,
    title: '長いコンテンツのモーダル',
    children: 'これは非常に長いコンテンツを含むモーダルです。' +
      '複数行にわたるテキストが含まれています。' +
      'モーダルがどのように表示されるかを確認できます。',
  },
}
```

### 実践例5: リストコンポーネント

```jsx
// src/components/List.jsx
function List({ items, renderItem }) {
  return (
    <ul style={{ listStyle: 'none', padding: 0 }}>
      {items.map((item, index) => (
        <li key={index} style={{ padding: '10px', borderBottom: '1px solid #eee' }}>
          {renderItem ? renderItem(item) : item}
        </li>
      ))}
    </ul>
  )
}

export default List
```

```jsx
// src/components/List.stories.jsx
import List from './List'

export default {
  title: 'Components/List',
  component: List,
}

export const Simple = {
  args: {
    items: ['項目1', '項目2', '項目3'],
  },
}

export const WithCustomRender = {
  args: {
    items: [
      { id: 1, name: '太郎', age: 25 },
      { id: 2, name: '花子', age: 30 },
      { id: 3, name: '次郎', age: 20 },
    ],
    renderItem: (item) => (
      <div>
        <strong>{item.name}</strong> ({item.age}歳)
      </div>
    ),
  },
}
```

---

## まとめ

この章では、Storybookでストーリーを作成し、管理する方法について学びました。

### 学んだこと
- ストーリーの概念: コンポーネントの特定の状態を記述
- 基本的なストーリーの作成: `.stories.jsx`ファイルの作成
- ストーリーのバリエーション: 複数のストーリーの作成
- ストーリーの管理と組織化: 階層構造での組織化

### 重要なポイント
1. **ストーリーファイル**: `.stories.jsx`という拡張子で作成
2. **export default**: ストーリーのメタデータを定義
3. **export const**: 個別のストーリーを定義
4. **args**: コンポーネントに渡すPropsを定義
5. **組織化**: 階層構造でストーリーを管理

### 次のステップ
次の章では、パフォーマンス最適化とメモ化について詳しく学びます。

---

## 演習問題

### 問題1: 基本的なストーリー
`Button`コンポーネントの基本的なストーリーを作成してください。

<details>
<summary>解答例</summary>

```jsx
// src/components/Button.stories.jsx
import Button from './Button'

export default {
  title: 'Components/Button',
  component: Button,
}

export const Default = {
  args: {
    label: 'ボタン',
  },
}
```
</details>

### 問題2: 複数のストーリー
`Card`コンポーネントに対して、複数のストーリー（Default、WithImage、Empty）を作成してください。

<details>
<summary>解答例</summary>

```jsx
// src/components/Card.stories.jsx
import Card from './Card'

export default {
  title: 'Components/Card',
  component: Card,
}

export const Default = {
  args: {
    title: 'カードタイトル',
    content: 'カードの内容',
  },
}

export const WithImage = {
  args: {
    title: '画像付きカード',
    content: '画像が含まれたカード',
    image: 'https://via.placeholder.com/300',
  },
}

export const Empty = {
  args: {
    title: '空のカード',
    content: '',
  },
}
```
</details>

### 問題3: インタラクティブなストーリー
`Button`コンポーネントにクリックイベントを含むストーリーを作成してください。

<details>
<summary>解答例</summary>

```jsx
// src/components/Button.stories.jsx
import Button from './Button'

export default {
  title: 'Components/Button',
  component: Button,
}

export const WithClick = {
  args: {
    label: 'クリックしてください',
    onClick: () => {
      alert('ボタンがクリックされました！')
    },
  },
}
```
</details>

### 問題4: ストーリーの組織化
`Input`コンポーネントのストーリーを`Forms/Input`という階層で作成してください。

<details>
<summary>解答例</summary>

```jsx
// src/components/Input.stories.jsx
import Input from './Input'

export default {
  title: 'Forms/Input',
  component: Input,
}

export const Default = {
  args: {
    label: '名前',
    placeholder: '名前を入力してください',
  },
}
```
</details>

### 問題5: カスタムレンダリング
`List`コンポーネントに対して、カスタムレンダリング関数を使用するストーリーを作成してください。

<details>
<summary>解答例</summary>

```jsx
// src/components/List.stories.jsx
import List from './List'

export default {
  title: 'Components/List',
  component: List,
}

export const WithCustomRender = {
  args: {
    items: [
      { name: '太郎', age: 25 },
      { name: '花子', age: 30 },
    ],
    renderItem: (item) => (
      <div>
        <strong>{item.name}</strong> ({item.age}歳)
      </div>
    ),
  },
}
```
</details>

---

お疲れ様でした！次の章に進みましょう。

