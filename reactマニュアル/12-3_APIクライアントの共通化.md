# 12-3. APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å…±é€šåŒ–

ã“ã®ç« ã§ã¯ã€Axiosã‚’ä½¿ç”¨ã—ãŸAPIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å…±é€šåŒ–ã«ã¤ã„ã¦å­¦ã³ã¾ã™ã€‚å…±é€šåŒ–ã™ã‚‹ã“ã¨ã§ã€èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ä»˜ä¸ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®ç®¡ç†ãªã©ã‚’ä¸€å…ƒç®¡ç†ã§ãã¾ã™ã€‚

---

## ç›®æ¬¡

- [Axiosã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è¨­å®š (Interceptors)](#axiosã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è¨­å®š-interceptors)
- [ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å…±é€šå‡¦ç†](#ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å…±é€šå‡¦ç†)
- [ã¾ã¨ã‚](#ã¾ã¨ã‚)
- [æ¼”ç¿’å•é¡Œ](#æ¼”ç¿’å•é¡Œ)

---

## Axiosã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è¨­å®š (Interceptors)

### Axiosã¨ã¯
Axiosã¯ã€**HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç°¡å˜ã«é€ä¿¡ã§ãã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**ã§ã™ã€‚fetch APIã‚ˆã‚Šã‚‚ä½¿ã„ã‚„ã™ãã€ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install axios
```

### Axiosã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½œæˆ

Axiosã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€**å…±é€šã®è¨­å®šã‚’é©ç”¨**ã§ãã¾ã™ã€‚

#### åŸºæœ¬çš„ãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ

```typescript
import axios from 'axios'

const apiClient = axios.create({
  baseURL: 'https://api.example.com',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
  },
})
```

### ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã¨ã¯
ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã¯ã€**ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‰å¾Œã«å‡¦ç†ã‚’è¿½åŠ ã™ã‚‹**æ©Ÿèƒ½ã§ã™ã€‚

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼

ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã¯ã€**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã‚‹å‰ã«å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†**ã§ã™ã€‚

#### åŸºæœ¬çš„ãªä½¿ã„æ–¹

```typescript
apiClient.interceptors.request.use(
  (config) => {
    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡å‰ã®å‡¦ç†
    return config
  },
  (error) => {
    // ã‚¨ãƒ©ãƒ¼å‡¦ç†
    return Promise.reject(error)
  }
)
```

### å®Ÿè·µä¾‹: èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ä»˜ä¸

```typescript
// src/api/client.ts
import axios, { AxiosRequestConfig } from 'axios'

const apiClient = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || 'https://api.example.com',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
  },
})

// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼: èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä»˜ä¸
apiClient.interceptors.request.use(
  (config: AxiosRequestConfig) => {
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
    const token = localStorage.getItem('authToken')
    
    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`
    }
    
    return config
  },
  (error) => {
    return Promise.reject(error)
  }
)

export default apiClient
```

### å®Ÿè·µä¾‹: ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ­ã‚°ã®å‡ºåŠ›

```typescript
// src/api/client.ts
import axios, { AxiosRequestConfig } from 'axios'

const apiClient = axios.create({
  baseURL: 'https://api.example.com',
})

// é–‹ç™ºç’°å¢ƒã§ã®ã¿ãƒ­ã‚°ã‚’å‡ºåŠ›
const isDevelopment = import.meta.env.DEV

// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼: ãƒ­ã‚°å‡ºåŠ›
apiClient.interceptors.request.use(
  (config: AxiosRequestConfig) => {
    if (isDevelopment) {
      console.group(`ğŸš€ [API Request] ${config.method?.toUpperCase()} ${config.url}`)
      console.log('Headers:', config.headers)
      console.log('Data:', config.data)
      console.log('Params:', config.params)
      console.groupEnd()
    }
    return config
  },
  (error) => {
    if (isDevelopment) {
      console.error('âŒ [API Request Error]', error)
    }
    return Promise.reject(error)
  }
)

export default apiClient
```

### å®Ÿè·µä¾‹: ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã®ä»˜ä¸

```typescript
// src/api/client.ts
import axios, { AxiosRequestConfig } from 'axios'

const apiClient = axios.create({
  baseURL: 'https://api.example.com',
})

// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼: ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã‚’ä»˜ä¸
apiClient.interceptors.request.use(
  (config: AxiosRequestConfig) => {
    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã‚’ç”Ÿæˆ
    const requestId = `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`
    
    if (config.headers) {
      config.headers['X-Request-ID'] = requestId
    }
    
    return config
  },
  (error) => {
    return Promise.reject(error)
  }
)

export default apiClient
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã¯ã€**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ããŸå¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†**ã§ã™ã€‚

#### åŸºæœ¬çš„ãªä½¿ã„æ–¹

```typescript
apiClient.interceptors.response.use(
  (response) => {
    // ãƒ¬ã‚¹ãƒãƒ³ã‚¹æˆåŠŸæ™‚ã®å‡¦ç†
    return response
  },
  (error) => {
    // ã‚¨ãƒ©ãƒ¼å‡¦ç†
    return Promise.reject(error)
  }
)
```

### å®Ÿè·µä¾‹: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›

```typescript
// src/api/client.ts
import axios, { AxiosResponse } from 'axios'

const apiClient = axios.create({
  baseURL: 'https://api.example.com',
})

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼: ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›
apiClient.interceptors.response.use(
  (response: AxiosResponse) => {
    // APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒ { data: {...}, status: 200 } ã®å½¢å¼ã®å ´åˆ
    if (response.data && response.data.data) {
      return response.data.data
    }
    return response.data
  },
  (error) => {
    return Promise.reject(error)
  }
)

export default apiClient
```

### å®Ÿè·µä¾‹: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ­ã‚°ã®å‡ºåŠ›

```typescript
// src/api/client.ts
import axios, { AxiosResponse, AxiosError } from 'axios'

const apiClient = axios.create({
  baseURL: 'https://api.example.com',
})

const isDevelopment = import.meta.env.DEV

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼: ãƒ­ã‚°å‡ºåŠ›
apiClient.interceptors.response.use(
  (response: AxiosResponse) => {
    if (isDevelopment) {
      console.group(`âœ… [API Response] ${response.config.method?.toUpperCase()} ${response.config.url}`)
      console.log('Status:', response.status)
      console.log('Data:', response.data)
      console.groupEnd()
    }
    return response
  },
  (error: AxiosError) => {
    if (isDevelopment) {
      console.group(`âŒ [API Response Error] ${error.config?.method?.toUpperCase()} ${error.config?.url}`)
      if (error.response) {
        console.log('Status:', error.response.status)
        console.log('Data:', error.response.data)
      } else {
        console.log('Error:', error.message)
      }
      console.groupEnd()
    }
    return Promise.reject(error)
  }
)

export default apiClient
```

---

## ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å…±é€šå‡¦ç†

### å…±é€šå‡¦ç†ã®å¿…è¦æ€§
APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå‡¦ç†ã‚’æ¯å›å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
- **èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ä»˜ä¸**: ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¿½åŠ 
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®çµ±ä¸€çš„ãªå‡¦ç†
- **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹**: ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸­ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
- **ãƒªãƒˆãƒ©ã‚¤å‡¦ç†**: å¤±æ•—æ™‚ã®è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤

### å…±é€šå‡¦ç†ã®åˆ©ç‚¹
- **ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡å‰Šæ¸›**: åŒã˜å‡¦ç†ã‚’ä½•åº¦ã‚‚æ›¸ãå¿…è¦ãŒãªã„
- **ä¸€è²«æ€§**: ã™ã¹ã¦ã®APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã§åŒã˜å‡¦ç†ãŒé©ç”¨ã•ã‚Œã‚‹
- **ä¿å®ˆæ€§**: å¤‰æ›´ãŒå¿…è¦ãªå ´åˆã€1ç®‡æ‰€ã‚’ä¿®æ­£ã™ã‚‹ã ã‘ã§æ¸ˆã‚€
- **ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®çµ±ä¸€**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ä¸€å…ƒç®¡ç†ã§ãã‚‹

### å®Ÿè·µä¾‹: çµ±ä¸€çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```typescript
// src/api/client.ts
import axios, { AxiosError } from 'axios'

interface ApiError {
  status: number
  message: string
  data?: any
}

const apiClient = axios.create({
  baseURL: 'https://api.example.com',
})

// ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°
const errorMessages: Record<number, string> = {
  400: 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒä¸æ­£ã§ã™',
  401: 'èªè¨¼ãŒå¿…è¦ã§ã™',
  403: 'ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“',
  404: 'ãƒªã‚½ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
  500: 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',
  503: 'ã‚µãƒ¼ãƒ“ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“',
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
apiClient.interceptors.response.use(
  (response) => {
    return response
  },
  (error: AxiosError): Promise<ApiError> => {
    if (error.response) {
      const { status, data } = error.response
      
      // 401ã‚¨ãƒ©ãƒ¼ã®å ´åˆã€ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      if (status === 401) {
        localStorage.removeItem('authToken')
        window.location.href = '/login'
      }
      
      const message = 
        (data as any)?.message || 
        errorMessages[status] || 
        'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'
      
      return Promise.reject({
        status,
        message,
        data
      } as ApiError)
    } else if (error.request) {
      // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯é€ä¿¡ã•ã‚ŒãŸãŒã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ã“ãªã„
      return Promise.reject({
        status: 0,
        message: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',
      } as ApiError)
    } else {
      // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è¨­å®šä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ
      return Promise.reject({
        status: 0,
        message: error.message,
      } as ApiError)
    }
  }
)

export default apiClient
```

### å®Ÿè·µä¾‹: å®Œå…¨ãªAPIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

```typescript
// src/api/client.ts
import axios, { AxiosError, AxiosRequestConfig, AxiosResponse } from 'axios'

interface ApiError {
  status: number
  message: string
  data?: any
}

const apiClient = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || 'https://api.example.com',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
  },
})

// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼: èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ä»˜ä¸
apiClient.interceptors.request.use(
  (config: AxiosRequestConfig) => {
    const token = localStorage.getItem('authToken')
    
    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`
    }
    
    return config
  },
  (error) => {
    return Promise.reject(error)
  }
)

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
apiClient.interceptors.response.use(
  (response: AxiosResponse) => {
    return response.data
  },
  (error: AxiosError): Promise<ApiError> => {
    if (error.response) {
      const { status, data } = error.response
      
      // 401ã‚¨ãƒ©ãƒ¼ã®å ´åˆã€ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      if (status === 401) {
        localStorage.removeItem('authToken')
        window.location.href = '/login'
      }
      
      const message = (data as any)?.message || 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'
      
      return Promise.reject({
        status,
        message,
        data
      } as ApiError)
    }
    
    return Promise.reject({
      status: 0,
      message: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',
    } as ApiError)
  }
)

export default apiClient
```

### å®Ÿè·µä¾‹: ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ä»˜ãAPIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

```typescript
// src/api/client.ts
import axios, { AxiosError, AxiosRequestConfig, AxiosResponse } from 'axios'

const apiClient = axios.create({
  baseURL: 'https://api.example.com',
})

// ãƒªãƒˆãƒ©ã‚¤è¨­å®š
const MAX_RETRIES = 3
const RETRY_DELAY = 1000

// ãƒªãƒˆãƒ©ã‚¤å¯èƒ½ãªã‚¨ãƒ©ãƒ¼ã‹ã©ã†ã‹ã‚’åˆ¤å®š
const isRetryableError = (error: AxiosError): boolean => {
  if (!error.response) {
    return true // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã¯ãƒªãƒˆãƒ©ã‚¤å¯èƒ½
  }
  
  const status = error.response.status
  // 500ç•ªå°ã¨408ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰ã¯ãƒªãƒˆãƒ©ã‚¤å¯èƒ½
  return status >= 500 || status === 408
}

// ãƒªãƒˆãƒ©ã‚¤å‡¦ç†
const retryRequest = async (
  config: AxiosRequestConfig,
  retryCount: number = 0
): Promise<AxiosResponse> => {
  try {
    return await axios(config)
  } catch (error) {
    const axiosError = error as AxiosError
    
    if (isRetryableError(axiosError) && retryCount < MAX_RETRIES) {
      // ãƒªãƒˆãƒ©ã‚¤å‰ã«å¾…æ©Ÿ
      await new Promise(resolve => setTimeout(resolve, RETRY_DELAY * (retryCount + 1)))
      return retryRequest(config, retryCount + 1)
    }
    
    throw error
  }
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼: ãƒªãƒˆãƒ©ã‚¤å‡¦ç†
apiClient.interceptors.response.use(
  (response: AxiosResponse) => {
    return response
  },
  async (error: AxiosError) => {
    if (isRetryableError(error) && error.config) {
      try {
        return await retryRequest(error.config)
      } catch (retryError) {
        return Promise.reject(retryError)
      }
    }
    
    return Promise.reject(error)
  }
)

export default apiClient
```

### å®Ÿè·µä¾‹: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ç®¡ç†ä»˜ãAPIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

```typescript
// src/api/client.ts
import axios, { AxiosError, AxiosRequestConfig, AxiosResponse } from 'axios'

// ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹Storeï¼ˆZustandã®ä¾‹ï¼‰
import { useLoadingStore } from '../stores/loadingStore'

const apiClient = axios.create({
  baseURL: 'https://api.example.com',
})

// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°é–‹å§‹
apiClient.interceptors.request.use(
  (config: AxiosRequestConfig) => {
    useLoadingStore.getState().setLoading(true)
    return config
  },
  (error) => {
    useLoadingStore.getState().setLoading(false)
    return Promise.reject(error)
  }
)

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çµ‚äº†
apiClient.interceptors.response.use(
  (response: AxiosResponse) => {
    useLoadingStore.getState().setLoading(false)
    return response
  },
  (error: AxiosError) => {
    useLoadingStore.getState().setLoading(false)
    return Promise.reject(error)
  }
)

export default apiClient
```

### å®Ÿè·µä¾‹: APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä½¿ç”¨

```typescript
// src/api/users.ts
import apiClient from './client'

interface User {
  id: number
  name: string
  email: string
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’å–å¾—
export const getUsers = async (): Promise<User[]> => {
  const response = await apiClient.get<User[]>('/users')
  return response.data
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—
export const getUser = async (id: number): Promise<User> => {
  const response = await apiClient.get<User>(`/users/${id}`)
  return response.data
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
export const createUser = async (user: Omit<User, 'id'>): Promise<User> => {
  const response = await apiClient.post<User>('/users', user)
  return response.data
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ›´æ–°
export const updateUser = async (id: number, user: Partial<User>): Promise<User> => {
  const response = await apiClient.put<User>(`/users/${id}`, user)
  return response.data
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤
export const deleteUser = async (id: number): Promise<void> => {
  await apiClient.delete(`/users/${id}`)
}
```

```typescript
// src/components/UserList.tsx
import { useEffect, useState } from 'react'
import { getUsers, User } from '../api/users'

function UserList() {
  const [users, setUsers] = useState<User[]>([])
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState<string | null>(null)
  
  useEffect(() => {
    const fetchUsers = async () => {
      try {
        setLoading(true)
        const data = await getUsers()
        setUsers(data)
      } catch (err: any) {
        setError(err.message || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ')
      } finally {
        setLoading(false)
      }
    }
    
    fetchUsers()
  }, [])
  
  if (loading) return <p>èª­ã¿è¾¼ã¿ä¸­...</p>
  if (error) return <p>ã‚¨ãƒ©ãƒ¼: {error}</p>
  
  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>
          {user.name} - {user.email}
        </li>
      ))}
    </ul>
  )
}

export default UserList
```

---

## ã¾ã¨ã‚

ã“ã®ç« ã§ã¯ã€Axiosã‚’ä½¿ç”¨ã—ãŸAPIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å…±é€šåŒ–ã«ã¤ã„ã¦å­¦ã³ã¾ã—ãŸã€‚

### å­¦ã‚“ã ã“ã¨
- Axiosã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è¨­å®š: å…±é€šã®è¨­å®šã‚’é©ç”¨
- ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼: ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‰å¾Œã«å‡¦ç†ã‚’è¿½åŠ 
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å…±é€šå‡¦ç†: èªè¨¼ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç®¡ç†

### é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ
1. **Axiosã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹**: å…±é€šã®è¨­å®šã‚’é©ç”¨ã§ãã‚‹
2. **ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼**: èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ä»˜ä¸ã€ãƒ­ã‚°å‡ºåŠ›ãªã©
3. **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼**: ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãªã©
4. **å…±é€šå‡¦ç†**: ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡ã‚’å‰Šæ¸›ã—ã€ä¿å®ˆæ€§ã‚’å‘ä¸Š

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
æ¬¡ã®ç« ã§ã¯ã€UIãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®å…±é€šåŒ–ã«ã¤ã„ã¦è©³ã—ãå­¦ã³ã¾ã™ã€‚

---

## æ¼”ç¿’å•é¡Œ

### å•é¡Œ1: Axiosã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½œæˆ
`baseURL`ãŒ`https://api.example.com`ã®Axiosã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

<details>
<summary>è§£ç­”ä¾‹</summary>

```typescript
// src/api/client.ts
import axios from 'axios'

const apiClient = axios.create({
  baseURL: 'https://api.example.com',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
  },
})

export default apiClient
```
</details>

### å•é¡Œ2: èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ä»˜ä¸
ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã«ä»˜ä¸ã—ã¦ãã ã•ã„ã€‚

<details>
<summary>è§£ç­”ä¾‹</summary>

```typescript
// src/api/client.ts
import axios, { AxiosRequestConfig } from 'axios'

const apiClient = axios.create({
  baseURL: 'https://api.example.com',
})

apiClient.interceptors.request.use(
  (config: AxiosRequestConfig) => {
    const token = localStorage.getItem('authToken')
    
    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`
    }
    
    return config
  },
  (error) => {
    return Promise.reject(error)
  }
)

export default apiClient
```
</details>

### å•é¡Œ3: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€401ã‚¨ãƒ©ãƒ¼ã®å ´åˆã«ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

<details>
<summary>è§£ç­”ä¾‹</summary>

```typescript
// src/api/client.ts
import axios, { AxiosError } from 'axios'

const apiClient = axios.create({
  baseURL: 'https://api.example.com',
})

apiClient.interceptors.response.use(
  (response) => {
    return response
  },
  (error: AxiosError) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('authToken')
      window.location.href = '/login'
    }
    return Promise.reject(error)
  }
)

export default apiClient
```
</details>

### å•é¡Œ4: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›
ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®`data`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç›´æ¥è¿”ã™ã‚ˆã†ã«å¤‰æ›ã—ã¦ãã ã•ã„ã€‚

<details>
<summary>è§£ç­”ä¾‹</summary>

```typescript
// src/api/client.ts
import axios, { AxiosResponse } from 'axios'

const apiClient = axios.create({
  baseURL: 'https://api.example.com',
})

apiClient.interceptors.response.use(
  (response: AxiosResponse) => {
    return response.data
  },
  (error) => {
    return Promise.reject(error)
  }
)

export default apiClient
```
</details>

### å•é¡Œ5: å®Œå…¨ãªAPIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ä»˜ä¸ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›ã‚’å«ã‚€å®Œå…¨ãªAPIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

<details>
<summary>è§£ç­”ä¾‹</summary>

```typescript
// src/api/client.ts
import axios, { AxiosError, AxiosRequestConfig, AxiosResponse } from 'axios'

interface ApiError {
  status: number
  message: string
}

const apiClient = axios.create({
  baseURL: 'https://api.example.com',
  timeout: 10000,
})

// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼
apiClient.interceptors.request.use(
  (config: AxiosRequestConfig) => {
    const token = localStorage.getItem('authToken')
    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`
    }
    return config
  },
  (error) => Promise.reject(error)
)

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼
apiClient.interceptors.response.use(
  (response: AxiosResponse) => response.data,
  (error: AxiosError): Promise<ApiError> => {
    if (error.response?.status === 401) {
      localStorage.removeItem('authToken')
      window.location.href = '/login'
    }
    
    return Promise.reject({
      status: error.response?.status || 0,
      message: (error.response?.data as any)?.message || 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'
    } as ApiError)
  }
)

export default apiClient
```
</details>

---

ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼æ¬¡ã®ç« ã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚

